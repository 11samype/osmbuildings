(function(i){function u(P,z){var Q=P[0]-z[0],g=P[1]-z[1];return Q*Q+g*g}var wa=wa||Array,Da=Math.exp,Ea=Math.log,Fa=Math.tan,Ga=Math.atan,ka=Math.min,xa=Math.max,la=i.document,C=function(){function P(g,k,n){if(n<0)n+=1;if(n>1)n-=1;if(n<1/6)return g+(k-g)*6*n;if(n<0.5)return k;if(n<2/3)return g+(k-g)*(2/3-n)*6;return g}function z(g,k,n,o){this.r=g;this.g=k;this.b=n;this.a=arguments.length<4?1:o}var Q=z.prototype;Q.toString=function(){return"rgba("+[this.r,this.g,this.b,this.a.toFixed(2)].join(",")+
")"};Q.adjustLightness=function(g){var k=C.toHSLA(this);k.l*=g;k.l=Math.min(1,Math.max(0,k.l));var n,o;if(k.s===0)g=n=o=k.l;else{o=k.l<0.5?k.l*(1+k.s):k.l+k.s-k.l*k.s;var A=2*k.l-o;g=P(A,o,k.h+1/3);n=P(A,o,k.h);o=P(A,o,k.h-1/3)}return new C(g*255<<0,n*255<<0,o*255<<0,k.a)};Q.adjustAlpha=function(g){return new C(this.r,this.g,this.b,this.a*g)};z.parse=function(g){g+="";if(~g.indexOf("#")){g=g.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new C(parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],
16),g[4]?parseInt(g[4],16)/255:1)}if(g=g.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new C(parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10),g[4]?parseFloat(g[5],10):1)};z.toHSLA=function(g){var k=g.r/255,n=g.g/255,o=g.b/255,A=Math.max(k,n,o),D=Math.min(k,n,o),H,S=(A+D)/2,I;if(A===D)H=D=0;else{I=A-D;D=S>0.5?I/(2-A-D):I/(A+D);switch(A){case k:H=(n-o)/I+(n<o?6:0);break;case n:H=(o-k)/I+2;break;case o:H=(k-n)/I+4;break}H/=6}return{h:H,s:D,l:S,a:g.a}};return z}(),Z=Math.PI,ya=Z/2,
Ha=Z/4,Ia=180/Z,Ja=256,ma=14,na=400,za=na-50,$="latitude",aa="longitude",J=0,E=1,y=2,oa=3,ga=4;i.OSMBuildings=function(P){function z(a,d){var b={};a/=ba;d/=ba;b[$]=d<=0?90:d>=1?-90:Ia*(2*Ga(Da(Z*(1-2*d)))-ya);b[aa]=(a===1?1:(a%1+1)%1)*360-180;return b}function Q(a,d){return a.replace(/\{ *([\w_]+) *\}/g,function(b,c){return d[c]})}function g(a,d){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===4)!b.status||b.status<200||b.status>299||b.responseText&&d(JSON.parse(b.responseText))};
b.open("GET",a);b.send(null);return b}function k(){if(!(!pa||B<ma)){var a=z(W-ca,X-qa),d=z(W+T+ca,X+K+qa);ha&&ha.abort();ha=g(Q(pa,{w:a[aa],n:a[$],e:d[aa],s:d[$],z:B}),n)}}function n(a){var d,b,c,h=[],e=0,j=0;Y=ma;S(B);ha=null;if(!(!a||a.meta.z!==B)){c=a.meta;b=a.data;if(v&&w&&v.z===c.z){e=v.x-c.x;j=v.y-c.y;a=0;for(d=w.length;a<d;a++)h[a]=w[a][E][0]+e+","+(w[a][E][1]+j)}v=c;w=[];a=0;for(d=b.length;a<d;a++){var f=b[a][E];c=[];var m=void 0;m=void 0;var l=void 0;j=e=0;f=f;m=ra*ra;l=void 0;for(var p=
[f[0],f[1]],q=[f[0],f[1]],s=2,t=f.length-3;s<t;s+=2){l=[f[s],f[s+1]];if(u(l,p)>m){q.push(l[0],l[1]);p=l}}if(l[0]!==f[0]||l[1]!==f[1])q.push(f[0],f[1]);f=q;if(f.length<8)e=void 0;else{p=0;for(q=f.length-3;p<q;p+=2){m=f[p];l=f[p+1];e+=m;j+=l}m=(f.length-2)*2;c[E]=f;c[oa]=[e/m<<0,j/m<<0];e=c}if(e){e[J]=ka(b[a][J],za);c=e[E][0]+","+e[E][1];e[ga]=!(h&&~h.indexOf(c));w.push(e)}}I()}}function o(a,d){var b=[],c,h,e,j,f,m,l,p,q=sa-B;c=0;for(h=a.length;c<h;c++){f=a[c];m=f[E];l=new wa(m.length);e=0;for(j=m.length-
1;e<j;e+=2){p=m[e+1];var s=ka(1,xa(0,0.5-Ea(Fa(Ha+ya*m[e]/180))/Z/2));p={x:(p/360+0.5)*ba<<0,y:s*ba<<0};l[e]=p.x;l[e+1]=p.y}b[c]=[];b[c][J]=ka(f[J]>>q,za);b[c][E]=l;b[c][y]=f[y];b[c][ga]=d}return b}function A(a,d){if(typeof a==="object")H(a,!d);else{var b=la.documentElement,c=la.createElement("script");i.jsonpCallback=function(h){delete i.jsonpCallback;b.removeChild(c);H(h,!d)};b.insertBefore(c,b.lastChild).src=a.replace(/\{callback\}/,"jsonpCallback")}}function D(a,d,b){if(b===undefined)b=[];var c,
h,e,j=a[0]?a:a.features,f,m,l,p,q,s=d?1:0,t=d?0:1;if(j){c=0;for(a=j.length;c<a;c++)D(j[c],d,b);return b}if(a.type==="Feature"){h=a.geometry;c=a.properties}if(h.type==="Polygon")f=[h.coordinates];if(h.type==="MultiPolygon")f=h.coordinates;if(f){d=c.height;if(c.color||c.wallColor)p=C.parse(c.color||c.wallColor);if(c.roofColor)q=C.parse(c.roofColor);c=0;for(a=f.length;c<a;c++){m=f[c][0];j=[];h=l=0;for(e=m.length;h<e;h++){j.push(m[h][s],m[h][t]);l+=d||m[h][2]||0}if(l){h=[];h[J]=l/m.length<<0;m=E;l=void 0;
e=void 0;var M=void 0,N=void 0,F=0,G=void 0,da=void 0;G=0;for(da=j.length-3;G<da;G+=2){l=j[G];e=j[G+1];M=j[G+2];N=j[G+3];F+=l*N-M*e}if((F/2>0?"CW":"CCW")==="CW")j=j;else{l=[];for(e=j.length-2;e>=0;e-=2)l.push(j[e],j[e+1]);j=l}h[m]=j;if(p||q)h[y]=[p,q];b.push(h)}}}return b}function H(a,d){if(a){ea=D(a,d);Y=0;S(B);v={n:90,w:-180,s:-90,e:180,x:0,y:0,z:B};w=o(ea,true);I()}else{ea=null;R()}}function S(a){B=a;ba=Ja<<B;O=1-(B-Y)*0.3/(sa-Y);ra=xa(1,(B-Y)*2)+1}function I(){fa=0;clearInterval(ta);ta=setInterval(function(){fa+=
0.1;if(fa>1){clearInterval(ta);fa=1;for(var a=0,d=w.length;a<d;a++)w[a][ga]=0}R()},33)}function R(){r.clearRect(0,0,T,K);if(v&&w)if(!(B<Y||ua)){var a,d,b,c,h,e,j,f,m=W-v.x,l=X-v.y,p=[U+m,V+l],q,s,t,M,N,F,G=ia.adjustAlpha(O)+"",da=(va||ia.adjustLightness(1.2)).adjustAlpha(O)+"";if(ja)r.strokeStyle=Ka.adjustAlpha(O)+"";w.sort(function(Aa,Ba){return u(Ba[oa],p)/Ba[J]-u(Aa[oa],p)/Aa[J]});a=0;for(d=w.length;a<d;a++){h=w[a];t=false;e=h[E];q=[];b=0;for(c=e.length-1;b<c;b+=2){q[b]=j=e[b]-m;q[b+1]=f=e[b+1]-
l;t||(t=j>0&&j<T&&f>0&&f<K)}if(t){r.fillStyle=h[y]&&h[y][0]?h[y][0].adjustAlpha(O)+"":G;b=h[ga]?h[J]*fa:h[J];e=na/(na-b);j=[];s=[];b=0;for(c=q.length-3;b<c;b+=2){f=q[b];t=q[b+1];M=q[b+2];N=q[b+3];F={x:((f-U)*e+U<<0)+0.5,y:((t-V)*e+V<<0)+0.5};s={x:((M-U)*e+U<<0)+0.5,y:((N-V)*e+V<<0)+0.5};if((M-f)*(F.y-t)>(F.x-f)*(N-t)){s=[M+0.5,N+0.5,f+0.5,t+0.5,F.x,F.y,s.x,s.y];r.fillStyle=f<M&&t<N||f>M&&t>N?ia.adjustAlpha(O).adjustLightness(0.8)+"":h[y]&&h[y][0]?h[y][0].adjustAlpha(O)+"":G;Ca(s)}j[b]=F.x;j[b+1]=
F.y}r.fillStyle=!h[y]?da:h[y][1]?h[y][1].adjustAlpha(O)+"":va?da:h[y][0].adjustLightness(1.2).adjustAlpha(O)+"";Ca(j,ja)}}}}function Ca(a,d){if(a.length){r.beginPath();r.moveTo(a[0],a[1]);for(var b=2,c=a.length;b<c;b+=2)r.lineTo(a[b],a[b+1]);r.closePath();d&&r.stroke();r.fill()}}var T=0,K=0,ca=0,qa=0,W=0,X=0,B,ba,ha,x,r,pa,ja,ia=new C(200,190,180),va,Ka=new C(145,140,135),ea,v,w,O=1,ra=0,fa=1,ta,Y=ma,sa=20,U,V,ua;this.setStyle=function(a){a=(a=a)||{};ja=a.strokeRoofs!==undefined?a.strokeRoofs:ja;
if(a.color||a.wallColor)ia=C.parse(a.color||a.wallColor);if(a.roofColor!==undefined)va=C.parse(a.roofColor);R();return this};this.geoJSON=function(a,d){A(a,d);return this};this.setCamOffset=function(a,d){U=ca+a;V=K+d};this.setMaxZoom=function(a){sa=a};this.createCanvas=function(a){x=la.createElement("canvas");x.style.webkitTransform="translate3d(0,0,0)";x.style.imageRendering="optimizeSpeed";x.style.position="absolute";x.style.pointerEvents="none";x.style.left=0;x.style.top=0;a.appendChild(x);r=x.getContext("2d");
r.lineCap="round";r.lineJoin="round";r.lineWidth=1;try{r.mozImageSmoothingEnabled=false}catch(d){}return x};this.destroyCanvas=function(){x.parentNode.removeChild(x)};this.loadData=k;this.onMoveEnd=function(){var a=z(W,X),d=z(W+T,X+K);R();if(v&&(a[$]>v.n||a[aa]<v.w||d[$]<v.s||d[aa]>v.e))k()};this.onZoomEnd=function(a){ua=false;S(a.zoom);if(ea){w=o(ea);R()}else{R();k()}};this.onZoomStart=function(){ua=true;R()};this.render=R;this.setOrigin=function(a,d){W=a;X=d};this.setSize=function(a,d){T=a;K=d;
ca=T/2<<0;qa=K/2<<0;U=ca;V=K;x.width=T;x.height=K};this.setZoom=S;pa=P};i.OSMBuildings.VERSION="0.1.7a";i.OSMBuildings.ATTRIBUTION='&copy; <a href="http://osmbuildings.org">OSM Buildings</a>'})(this);
L.BuildingsLayer=L.Class.extend({map:null,osmb:null,canvas:null,blockMoveEvent:null,lastX:0,lastY:0,initialize:function(i){L.Util.setOptions(this,i)},onMove:function(){var i=L.DomUtil.getPosition(this.map._mapPane);this.osmb.setCamOffset(this.lastX-i.x,this.lastY-i.y);this.osmb.render()},onMoveEnd:function(){if(this.blockMoveEvent)this.blockMoveEvent=false;else{var i=L.DomUtil.getPosition(this.map._mapPane),u=this.map.getPixelOrigin();this.lastX=i.x;this.lastY=i.y;this.canvas.style.left=-i.x+"px";
this.canvas.style.top=-i.y+"px";this.osmb.setCamOffset(0,0);this.osmb.setSize(this.map._size.x,this.map._size.y);this.osmb.setOrigin(u.x-i.x,u.y-i.y);this.osmb.onMoveEnd()}},onZoomStart:function(){this.osmb.onZoomStart()},onZoomEnd:function(){var i=L.DomUtil.getPosition(this.map._mapPane),u=this.map.getPixelOrigin();this.osmb.setOrigin(u.x-i.x,u.y-i.y);this.osmb.onZoomEnd({zoom:this.map._zoom});this.blockMoveEvent=true},addTo:function(i){i.addLayer(this);return this},onAdd:function(i){this.map=i;
this.osmb=new OSMBuildings(this.options.url);this.canvas=this.osmb.createCanvas(this.map._panes.overlayPane);this.osmb.maxZoom=this.map._layersMaxZoom;i=L.DomUtil.getPosition(this.map._mapPane);var u=this.map.getPixelOrigin();this.osmb.setSize(this.map._size.x,this.map._size.y);this.osmb.setOrigin(u.x-i.x,u.y-i.y);this.osmb.setZoom(this.map._zoom);this.canvas.style.left=-i.x+"px";this.canvas.style.top=-i.y+"px";this.map.on({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd},
this);if(this.map.options.zoomAnimation)this.canvas.className="leaflet-zoom-animated";this.map.attributionControl.addAttribution(OSMBuildings.ATTRIBUTION);this.osmb.loadData();this.osmb.render()},onRemove:function(i){i.attributionControl.removeAttribution(OSMBuildings.ATTRIBUTION);i.off({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd},this);this.canvas=this.osmb.destroyCanvas();this.osmb=this.map=null},geoJSON:function(i,u){return this.osmb.geoJSON(i,u)},
setStyle:function(i){return this.osmb.setStyle(i)}});
