(function(i){function w(O,C){var P=O[0]-C[0],h=O[1]-C[1];return P*P+h*h}var ya=ya||Array,Ea=Math.exp,Fa=Math.log,Ga=Math.tan,Ha=Math.atan,ma=Math.min,Ia=Math.max,na=i.document,H=function(){function O(h,l,m){if(m<0)m+=1;if(m>1)m-=1;if(m<1/6)return h+(l-h)*6*m;if(m<0.5)return l;if(m<2/3)return h+(l-h)*(2/3-m)*6;return h}function C(h,l,m,q){this.r=h;this.g=l;this.b=m;this.a=arguments.length<4?1:q}var P=C.prototype;P.toString=function(){return"rgba("+[this.r,this.g,this.b,this.a.toFixed(2)].join(",")+
")"};P.adjustLightness=function(h){var l=H.toHSLA(this);l.l*=h;l.l=Math.min(1,Math.max(0,l.l));var m,q;if(l.s===0)h=m=q=l.l;else{q=l.l<0.5?l.l*(1+l.s):l.l+l.s-l.l*l.s;var D=2*l.l-q;h=O(D,q,l.h+1/3);m=O(D,q,l.h);q=O(D,q,l.h-1/3)}return new H(h*255<<0,m*255<<0,q*255<<0,l.a)};P.adjustAlpha=function(h){return new H(this.r,this.g,this.b,this.a*h)};C.parse=function(h){h+="";if(~h.indexOf("#")){h=h.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new H(parseInt(h[1],16),parseInt(h[2],16),parseInt(h[3],
16),h[4]?parseInt(h[4],16)/255:1)}if(h=h.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new H(parseInt(h[1],10),parseInt(h[2],10),parseInt(h[3],10),h[4]?parseFloat(h[5],10):1)};C.toHSLA=function(h){var l=h.r/255,m=h.g/255,q=h.b/255,D=Math.max(l,m,q),E=Math.min(l,m,q),J,S=(D+E)/2,K;if(D===E)J=E=0;else{K=D-E;E=S>0.5?K/(2-D-E):K/(D+E);switch(D){case l:J=(m-q)/K+(m<q?6:0);break;case m:J=(q-l)/K+2;break;case q:J=(l-m)/K+4;break}J/=6}return{h:J,s:E,l:S,a:h.a}};return C}(),$=Math.PI,za=$/2,
Ja=$/4,Ka=180/$,La=256,oa=14,pa=400,Aa=pa-50,aa="latitude",ba="longitude",M=0,I=1,X=2,qa=3,ia=4,Q=5;i.OSMBuildings=function(O){function C(a,d){var b={};a/=ca;d/=ca;b[aa]=d<=0?90:d>=1?-90:Ka*(2*Ha(Ea($*(1-2*d)))-za);b[ba]=(a===1?1:(a%1+1)%1)*360-180;return b}function P(a,d){return a.replace(/\{ *([\w_]+) *\}/g,function(b,c){return d[c]})}function h(a,d){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===4)!b.status||b.status<200||b.status>299||b.responseText&&d(JSON.parse(b.responseText))};
b.open("GET",a);b.send(null);return b}function l(){if(!(!ra||F<oa)){var a=C(Y-da,Z-sa),d=C(Y+T+da,Z+N+sa);ja&&ja.abort();ja=h(P(ra,{w:a[ba],n:a[aa],e:d[ba],s:d[aa],z:F}),m)}}function m(a){var d,b,c,g=[],f=0,j=0;ea=oa;S(F);ja=null;if(!(!a||a.meta.z!==F)){c=a.meta;b=a.data;if(A&&s&&A.z===c.z){f=A.x-c.x;j=A.y-c.y;a=0;for(d=s.length;a<d;a++)g[a]=s[a][I][0]+f+","+(s[a][I][1]+j)}A=c;s=[];a=0;for(d=b.length;a<d;a++){var e=b[a][I];c=[];var k=void 0;k=void 0;var n=void 0;j=f=0;e=e;k=void 0;n=[e[0],e[1]];for(var o=
void 0,p=[e[0],e[1]],r=2,x=e.length-3;r<x;r+=2){k=[e[r],e[r+1]];o=[e[r+2]||e[0],e[r+3]||e[1]];var y=n;o=o;var t=y[0],u=y[1],v=o[0]-t,G=o[1]-u,fa=void 0;if(v!==0||G!==0){fa=((k[0]-t)*v+(k[1]-u)*G)/(v*v+G*G);if(fa>1){t=o[0];u=o[1]}else if(fa>0){t+=v*fa;u+=G*fa}}t=w(k,[t,u])*2;y=w(y,o);if(t*y>750){p.push(k[0],k[1]);n=k}}if(k[0]!==e[0]||k[1]!==e[1])p.push(e[0],e[1]);e=p;if(e.length<8)f=void 0;else{p=0;for(r=e.length-3;p<r;p+=2){k=e[p];n=e[p+1];f+=k;j+=n}k=(e.length-2)*2;c[I]=e;c[qa]=[f/k<<0,j/k<<0];f=
c}if(f){f[M]=ma(b[a][M],Aa);c=f[I][0]+","+f[I][1];f[ia]=!(g&&~g.indexOf(c));f[X]=[];f[Q]=[];s.push(f)}}K()}}function q(a,d){var b=[],c,g,f,j,e,k,n,o,p=ta-F;c=0;for(g=a.length;c<g;c++){e=a[c];k=e[I];n=new ya(k.length);f=0;for(j=k.length-1;f<j;f+=2){o=k[f+1];var r=ma(1,Ia(0,0.5-Fa(Ga(Ja+za*k[f]/180))/$/2));o={x:(o/360+0.5)*ca<<0,y:r*ca<<0};n[f]=o.x;n[f+1]=o.y}b[c]=[];b[c][M]=ma(e[M]>>p,Aa);b[c][I]=n;b[c][X]=e[X];b[c][ia]=d}return b}function D(a,d){if(typeof a==="object")J(a,!d);else{var b=na.documentElement,
c=na.createElement("script");i.jsonpCallback=function(g){delete i.jsonpCallback;b.removeChild(c);J(g,!d)};b.insertBefore(c,b.lastChild).src=a.replace(/\{callback\}/,"jsonpCallback")}}function E(a,d,b){if(b===undefined)b=[];var c,g,f,j=a[0]?a:a.features,e,k,n,o,p,r=d?1:0,x=d?0:1;if(j){c=0;for(a=j.length;c<a;c++)E(j[c],d,b);return b}if(a.type==="Feature"){g=a.geometry;c=a.properties}if(g.type==="Polygon")e=[g.coordinates];if(g.type==="MultiPolygon")e=g.coordinates;if(e){d=c.height;if(c.color||c.wallColor)o=
H.parse(c.color||c.wallColor);if(c.roofColor)p=H.parse(c.roofColor);c=0;for(a=e.length;c<a;c++){k=e[c][0];j=[];g=n=0;for(f=k.length;g<f;g++){j.push(k[g][r],k[g][x]);n+=d||k[g][2]||0}if(n){g=[];g[M]=n/k.length<<0;k=I;n=void 0;f=void 0;var y=void 0,t=void 0,u=0,v=void 0,G=void 0;v=0;for(G=j.length-3;v<G;v+=2){n=j[v];f=j[v+1];y=j[v+2];t=j[v+3];u+=n*t-y*f}if((u/2>0?"CW":"CCW")==="CW")j=j;else{n=[];for(f=j.length-2;f>=0;f-=2)n.push(j[f],j[f+1]);j=n}g[k]=j;g[X]=[o||null,o?o.adjustLightness(0.8):null,p?
p:o?o.adjustLightness(1.2):null];g[Q]=[];b.push(g)}}}return b}function J(a,d){if(a){ga=E(a,d);ea=0;S(F);A={n:90,w:-180,s:-90,e:180,x:0,y:0,z:F};s=q(ga,true);K()}else{ga=null;R()}}function S(a){var d,b,c,g;F=a;ca=La<<F;c=1-(F-ea)*0.3/(ta-ea);Ba=U.adjustAlpha(c)+"";ua=va.adjustAlpha(c)+"";Ca=ka.adjustAlpha(c)+"";if(s){a=0;for(d=s.length;a<d;a++){g=s[a];g[Q]=[];for(b=0;b<3;b++)if(g[X][b])g[Q][b]=g[X][b].adjustAlpha(c)+""}}}function K(){ha=0;clearInterval(wa);wa=setInterval(function(){ha+=0.1;if(ha>1){clearInterval(wa);
ha=1;for(var a=0,d=s.length;a<d;a++)s[a][ia]=0}R()},33)}function R(){z.clearRect(0,0,T,N);if(A&&s)if(!(F<ea||xa)){var a,d,b,c,g,f,j,e,k=Y-A.x,n=Z-A.y,o=[V+k,W+n],p,r,x,y,t,u;s.sort(function(v,G){return w(G[qa],o)/G[M]-w(v[qa],o)/v[M]});a=0;for(d=s.length;a<d;a++){g=s[a];x=false;f=g[I];p=[];b=0;for(c=f.length-1;b<c;b+=2){p[b]=j=f[b]-k;p[b+1]=e=f[b+1]-n;x||(x=j>0&&j<T&&e>0&&e<N)}if(x){b=g[ia]?g[M]*ha:g[M];f=pa/(pa-b);j=[];r=[];b=0;for(c=p.length-3;b<c;b+=2){e=p[b];x=p[b+1];y=p[b+2];t=p[b+3];u={x:((e-
V)*f+V<<0)+0.5,y:((x-W)*f+W<<0)+0.5};r={x:((y-V)*f+V<<0)+0.5,y:((t-W)*f+W<<0)+0.5};if((y-e)*(u.y-x)>(u.x-e)*(t-x)){r=[y+0.5,t+0.5,e+0.5,x+0.5,u.x,u.y,r.x,r.y];z.fillStyle=e<y&&x<t||e>y&&x>t?g[Q][1]||ua:g[Q][0]||Ba;Da(r)}j[b]=u.x;j[b+1]=u.y}z.fillStyle=g[Q][2]||Ca;if(la)z.strokeStyle=g[Q][1]||ua;Da(j,la)}}}}function Da(a,d){if(a.length){z.beginPath();z.moveTo(a[0],a[1]);for(var b=2,c=a.length;b<c;b+=2)z.lineTo(a[b],a[b+1]);z.closePath();d&&z.stroke();z.fill()}}var T=0,N=0,da=0,sa=0,Y=0,Z=0,F,ca,ja,
B,z,ra,la,U=new H(200,190,180),va=U.adjustLightness(0.8),ka=U.adjustLightness(1.2),Ba=U+"",ua=va+"",Ca=ka+"",ga,A,s,ha=1,wa,ea=oa,ta=20,V,W,xa;this.setStyle=function(a){a=(a=a)||{};la=a.strokeRoofs!==undefined?a.strokeRoofs:la;if(a.color||a.wallColor){U=H.parse(a.color||a.wallColor);va=U.adjustLightness(0.8);ka=U.adjustLightness(1.2)}if(a.roofColor)ka=H.parse(a.roofColor);R();return this};this.geoJSON=function(a,d){D(a,d);return this};this.setCamOffset=function(a,d){V=da+a;W=N+d};this.setMaxZoom=
function(a){ta=a};this.createCanvas=function(a){B=na.createElement("canvas");B.style.webkitTransform="translate3d(0,0,0)";B.style.imageRendering="optimizeSpeed";B.style.position="absolute";B.style.pointerEvents="none";B.style.left=0;B.style.top=0;a.appendChild(B);z=B.getContext("2d");z.lineCap="round";z.lineJoin="round";z.lineWidth=1;try{z.mozImageSmoothingEnabled=false}catch(d){}return B};this.destroyCanvas=function(){B.parentNode.removeChild(B)};this.loadData=l;this.onMoveEnd=function(){var a=C(Y,
Z),d=C(Y+T,Z+N);R();if(A&&(a[aa]>A.n||a[ba]<A.w||d[aa]<A.s||d[ba]>A.e))l()};this.onZoomEnd=function(a){xa=false;S(a.zoom);if(ga){s=q(ga);R()}else{R();l()}};this.onZoomStart=function(){xa=true;R()};this.render=R;this.setOrigin=function(a,d){Y=a;Z=d};this.setSize=function(a,d){T=a;N=d;da=T/2<<0;sa=N/2<<0;V=da;W=N;B.width=T;B.height=N};this.setZoom=S;ra=O};i.OSMBuildings.VERSION="0.1.7a";i.OSMBuildings.ATTRIBUTION='&copy; <a href="http://osmbuildings.org">OSM Buildings</a>'})(this);
L.BuildingsLayer=L.Class.extend({map:null,osmb:null,canvas:null,blockMoveEvent:null,lastX:0,lastY:0,initialize:function(i){L.Util.setOptions(this,i)},onMove:function(){var i=L.DomUtil.getPosition(this.map._mapPane);this.osmb.setCamOffset(this.lastX-i.x,this.lastY-i.y);this.osmb.render()},onMoveEnd:function(){if(this.blockMoveEvent)this.blockMoveEvent=false;else{var i=L.DomUtil.getPosition(this.map._mapPane),w=this.map.getPixelOrigin();this.lastX=i.x;this.lastY=i.y;this.canvas.style.left=-i.x+"px";
this.canvas.style.top=-i.y+"px";this.osmb.setCamOffset(0,0);this.osmb.setSize(this.map._size.x,this.map._size.y);this.osmb.setOrigin(w.x-i.x,w.y-i.y);this.osmb.onMoveEnd()}},onZoomStart:function(){this.osmb.onZoomStart()},onZoomEnd:function(){var i=L.DomUtil.getPosition(this.map._mapPane),w=this.map.getPixelOrigin();this.osmb.setOrigin(w.x-i.x,w.y-i.y);this.osmb.onZoomEnd({zoom:this.map._zoom});this.blockMoveEvent=true},addTo:function(i){i.addLayer(this);return this},onAdd:function(i){this.map=i;
this.osmb=new OSMBuildings(this.options.url);this.canvas=this.osmb.createCanvas(this.map._panes.overlayPane);this.osmb.maxZoom=this.map._layersMaxZoom;i=L.DomUtil.getPosition(this.map._mapPane);var w=this.map.getPixelOrigin();this.osmb.setSize(this.map._size.x,this.map._size.y);this.osmb.setOrigin(w.x-i.x,w.y-i.y);this.osmb.setZoom(this.map._zoom);this.canvas.style.left=-i.x+"px";this.canvas.style.top=-i.y+"px";this.map.on({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd},
this);if(this.map.options.zoomAnimation)this.canvas.className="leaflet-zoom-animated";this.map.attributionControl.addAttribution(OSMBuildings.ATTRIBUTION);this.osmb.loadData();this.osmb.render()},onRemove:function(i){i.attributionControl.removeAttribution(OSMBuildings.ATTRIBUTION);i.off({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd},this);this.canvas=this.osmb.destroyCanvas();this.osmb=this.map=null},geoJSON:function(i,w){return this.osmb.geoJSON(i,w)},
setStyle:function(i){return this.osmb.setStyle(i)}});
