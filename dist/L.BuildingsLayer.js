var OSMBuildings=function(){function e(a,b){var c=a[0]-b[0],f=a[1]-b[1];return c*c+f*f}function H(a){for(var b=0,c=0,f=0,v=a.length-3;f<v;f+=2)b+=a[f],c+=a[f+1];a=(a.length-2)/2;return[b/a<<0,c/a<<0]}function wa(a,b){var c,f,v,e,h=0,j,k;j=0;for(k=a.length-3;j<k;j+=2)c=a[j],f=a[j+1],v=a[j+2],e=a[j+3],h+=c*e-v*f;if((0<h/2?"CW":"CCW")===b)return a;c=[];for(f=a.length-2;0<=f;f-=2)c.push(a[f],a[f+1]);return c}var Ea=Ea||Array,Fa=Fa||Array,h=Math,Na=h.exp,Oa=h.log,Pa=h.sin,Qa=h.cos,xa=h.tan,Ra=h.atan,qa=
h.min,ya=h.max,Ga=h.ceil,Ha=h.floor,Ia=document,S,ca=function(a){var b,c,f;if(0===a.s)b=c=f=a.l;else{f=0.5>a.l?a.l*(1+a.s):a.l+a.s-a.l*a.s;var v=2*a.l-f;a.h/=360;b=T(v,f,a.h+1/3);c=T(v,f,a.h);f=T(v,f,a.h-1/3)}return new E(255*b<<0,255*c<<0,255*f<<0,a.a)},T=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a},E=function(a,b,c,f){this.r=a;this.g=b;this.b=c;this.a=4>arguments.length?1:f},h=E.prototype;h.toString=function(){return"rgba("+[this.r<<0,this.g<<
0,this.b<<0,this.a.toFixed(2)].join()+")"};h.setLightness=function(a){var b=E.toHSLA(this);b.l*=a;b.l=Math.min(1,Math.max(0,b.l));return ca(b)};h.setAlpha=function(a){return new E(this.r,this.g,this.b,this.a*a)};E.parse=function(a){var b;a+="";if(~a.indexOf("#")&&(b=a.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/)))return new E(parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16),b[4]?parseInt(b[4],16)/255:1);if(b=a.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new E(parseInt(b[1],10),
parseInt(b[2],10),parseInt(b[3],10),b[4]?parseFloat(b[5]):1);if(b=a.match(/hsla?\(([\d.]+)\D+([\d.]+)\D+([\d.]+)(\D+([\d.]+))?\)/))return ca({h:parseInt(b[1],10),s:parseFloat(b[2]),l:parseFloat(b[3]),a:b[4]?parseFloat(b[5]):1})};E.toHSLA=function(a){var b=a.r/255,c=a.g/255,f=a.b/255,v=Math.max(b,c,f),e=Math.min(b,c,f),h,j=(v+e)/2,k;if(v===e)h=e=0;else{k=v-e;e=0.5<j?k/(2-v-e):k/(v+e);switch(v){case b:h=(c-f)/k+(c<f?6:0);break;case c:h=(f-b)/k+2;break;case f:h=(b-c)/k+4}h/=6}return{h:360*h,s:e,l:j,
a:a.a}};S=E;var Ja,h=Math,U=h.PI,r=h.sin,y=h.cos,da=h.tan,ea=h.asin,fa=h.atan2,B=U/180,M=23.4397*B;Ja=function(a,b,c){c=B*-c;b*=B;a=a.valueOf()/864E5-0.5+2440588-2451545;var f=B*(357.5291+0.98560028*a),e=B*(1.9148*r(f)+0.02*r(2*f)+3E-4*r(3*f)),e=f+e+102.9372*B+U,f=ea(r(0)*y(M)+y(0)*r(M)*r(e)),e=fa(r(e)*y(M)-da(0)*r(M),y(e));c=B*(280.16+360.9856235*a)-c-e;return{altitude:ea(r(b)*r(f)+y(b)*y(f)*y(c)),azimuth:fa(r(c),y(c)*r(b)-da(f)*y(b))-U/2}};var Ka,N=function(a){var b=parseFloat(a);return~a.indexOf("m")?
b<<0:~a.indexOf("yd")?b*Sa<<0:~a.indexOf("ft")?b*ga<<0:~a.indexOf("'")?(a=a.split("'"),a[0]*ga+a[1]*Ta<<0):b<<0},I=function(a){a=a.toLowerCase();return"#"===a[0]?a:Ua[Va[a]||a]||null},ha=function(a){return(a=a.tags)&&!a.landuse&&(a.building||a["building:part"])&&(!a.layer||0<=a.layer)},W=function(a){if(a){for(var b=[],c,f=0,e=a.length;f<e;f++)c=V[a[f]],b.push(c[0],c[1]);b[b.length-2]!==b[0]&&b[b.length-1]!==b[1]&&b.push(b[0],b[1]);if(!(8>b.length))return b}},ia=function(a){var b=0,c=0;a.height&&(b=
N(a.height));!b&&a["building:height"]&&(b=N(a["building:height"]));!b&&a.levels&&(b=a.levels*O<<0);!b&&a["building:levels"]&&(b=a["building:levels"]*O<<0);a.min_height&&(c=N(a.min_height));!c&&a["building:min_height"]&&(c=N(a["building:min_height"]));!c&&a.min_level&&(c=a.min_level*O<<0);!c&&a["building:min_level"]&&(c=a["building:min_level"]*O<<0);var f,e;a["building:material"]&&(f=I(a["building:material"]));a["building:facade:material"]&&(f=I(a["building:facade:material"]));a["building:cladding"]&&
(f=I(a["building:cladding"]));a["building:color"]&&(f=a["building:color"]);a["building:colour"]&&(f=a["building:colour"]);a["roof:material"]&&(e=I(a["roof:material"]));a["building:roof:material"]&&(e=I(a["building:roof:material"]));a["roof:color"]&&(e=a["roof:color"]);a["roof:colour"]&&(e=a["roof:colour"]);a["building:roof:color"]&&(e=a["building:roof:color"]);a["building:roof:colour"]&&(e=a["building:roof:colour"]);return{height:b,minHeight:c,wallColor:f,roofColor:e}},La=function(a,b,e,f){a={id:a,
footprint:wa(e,"CW"),holes:f};b.height&&(a.height=b.height);b.minHeight&&(a.minHeight=b.minHeight);b.wallColor&&(a.wallColor=b.wallColor);b.roofColor&&(a.roofColor=b.roofColor);f&&(a.holes=f);Y.push(a)},Sa=0.9144,ga=0.3048,Ta=0.0254,O=3,Va={asphalt:"tar_paper",bitumen:"tar_paper",block:"stone",bricks:"brick",glas:"glass",glassfront:"glass",grass:"plants",masonry:"stone",granite:"stone",panels:"panel",paving_stones:"stone",plastered:"plaster",rooftiles:"roof_tiles",roofingfelt:"tar_paper",sandstone:"stone",
sheet:"canvas",sheets:"canvas",shingle:"tar_paper",shingles:"tar_paper",slates:"slate",steel:"metal",tar:"tar_paper",tent:"canvas",thatch:"plants",tile:"roof_tiles",tiles:"roof_tiles"},Ua={brick:"#cc7755",bronze:"#ffeecc",canvas:"#fff8f0",concrete:"#999999",copper:"#a0e0d0",glass:"#e8f8f8",gold:"#ffcc00",plants:"#009933",metal:"#aaaaaa",panel:"#fff8f0",plaster:"#999999",roof_tiles:"#f08060",silver:"#cccccc",slate:"#666666",stone:"#996666",tar_paper:"#333333",wood:"#deb887"},V,P,Y;Ka=function(a){V=
{};P={};Y=[];for(var b,e=0,f=a.length;e<f;e++)switch(b=a[e],b.type){case "node":V[b.id]=[b.lat,b.lon];break;case "way":var h=void 0,m=void 0;if(ha(b))h=ia(b.tags),(m=W(b.nodes))&&La(b.id,h,m);else if(h=b.tags,!h||!h.highway&&!h.railway&&!h.landuse)P[b.id]=b;break;case "relation":var m=b,Q=void 0,j=void 0;b=[];var k=void 0,u=void 0,h=void 0;if(ha(m)&&("multipolygon"===m.tags.type||"building"===m.tags.type)){for(var Q=m.members,u=j=void 0,k=[],z=0,r=Q.length;z<r;z++)j=Q[z],"way"===j.type&&P[j.ref]&&
(!j.role||"outer"===j.role?u=P[j.ref]:("inner"===j.role||"enclave"===j.role)&&k.push(P[j.ref]));Q=u&&u.tags?{outer:u,inner:k}:void 0;if(Q&&(z=ia(m.tags),j=Q.outer))if(k=ia(j.tags),u=W(j.nodes)){m=k;k=z;z=void 0;for(z in k)m[z]||(m[z]=k[z]);k=m;m=0;for(z=Q.inner.length;m<z;m++)(h=W(Q.inner[m].nodes))&&b.push(wa(h,"CCW"));La(j.id,k,u,b.length?b:null)}}}return Y};var ja=Math.PI,Ma=ja/2,Wa=ja/4,Xa=180/ja,Ya=256,Za="latitude",$a="longitude",h=function(){function a(C,a){var d={};C/=B;a/=B;d[Za]=0>=a?90:
1<=a?-90:Xa*(2*Ra(Na(ja*(1-2*a)))-Ma);d[$a]=360*(1===C?1:(C%1+1)%1)-180;return d}function b(C,a,d){function b(a){if("XDomainRequest"in window&&a!==g.readyState&&(g.readyState=a,g.onreadystatechange))g.onreadystatechange()}C=C.replace(/\{ *([\w_]+) *\}/g,function(C,d){return a[d]||C});var g="XDomainRequest"in window?new XDomainRequest:new XMLHttpRequest;g.onerror=function(){g.status=500;g.statusText="Error";b(4)};g.ontimeout=function(){g.status=408;g.statusText="Timeout";b(4)};g.onprogress=function(){b(3)};
g.onload=function(){g.status=200;g.statusText="Ok";b(4)};g.onreadystatechange=function(){4===g.readyState&&g.status&&!(200>g.status||299<g.status)&&d&&g.responseText&&d(JSON.parse(g.responseText))};b(0);g.open("GET",C);b(1);g.send(null);b(2);return g}function c(){ka.render();ra.render();f()}function f(){D.clearRect(0,0,k,u);if(!(y<O||la)){var a,b,d,c,g,l,f,ab=ra.MAX_HEIGHT,Z=[ma+F,na+G],j=F,n=F+k,p=G,t=G+u,s,za,w,x;A.renderItems.sort(function(a,C){return e(C.center,Z)/C.height-e(a.center,Z)/a.height});
a=0;for(b=A.renderItems.length;a<b;a++)if(g=A.renderItems[a],!(g.height<=ab)){l=!1;s=g.footprint;d=0;for(c=s.length-1;d<c;d+=2)l||(l=s[d]>j&&s[d]<n&&s[d+1]>p&&s[d+1]<t);if(l){d=1>g.scale?g.height*g.scale:g.height;l=$/($-d);f=0;g.minHeight&&(d=1>g.scale?g.minHeight*g.scale:g.minHeight,f=$/($-d));w=g.wallColor||P;x=g.altColor||M;s=h(s,l,f,w,x);za=[];if(g.holes){d=0;for(c=g.holes.length;d<c;d++)za[d]=h(g.holes[d],l,f,w,x)}D.fillStyle=g.roofColor||oa;D.strokeStyle=x;m(s,!0,za)}}}}function h(a,b,d,e,g){for(var l=
{x:0,y:0},c={x:0,y:0},f,Z,k=[],n=0,p=a.length-3;n<p;n+=2)l.x=a[n]-F,l.y=a[n+1]-G,c.x=a[n+2]-F,c.y=a[n+3]-G,f=r(l.x,l.y,b),Z=r(c.x,c.y,b),d&&(l=r(l.x,l.y,d),c=r(c.x,c.y,d)),(c.x-l.x)*(f.y-l.y)>(f.x-l.x)*(c.y-l.y)&&(D.fillStyle=l.x<c.x&&l.y<c.y||l.x>c.x&&l.y>c.y?g:e,m([c.x,c.y,l.x,l.y,f.x,f.y,Z.x,Z.y])),k[n]=f.x,k[n+1]=f.y;return k}function m(a,b,d){if(a.length){var c,g,l,e;D.beginPath();D.moveTo(a[0],a[1]);c=2;for(g=a.length;c<g;c+=2)D.lineTo(a[c],a[c+1]);if(d){c=0;for(g=d.length;c<g;c++){a=d[c];D.moveTo(a[0],
a[1]);l=2;for(e=a.length;l<e;l+=2)D.lineTo(a[l],a[l+1])}}D.closePath();b&&D.stroke();D.fill()}}function r(a,b,d){return{x:(a-ma)*d+ma<<0,y:(b-na)*d+na<<0}}function j(a){y=a;B=Ya<<y;a=y;var b=O,d=T;a=qa(ya(a,b),d);J=1-qa(ya(0+0.3*((a-b)/(d-b)),0),0.3);P=R.setAlpha(J)+"";M=I.setAlpha(J)+"";oa=aa.setAlpha(J)+""}var k=0,u=0,z=0,E=0,F=0,G=0,y,B,D,R=new S(200,190,180),I=R.setLightness(0.8),aa=R.setLightness(1.2),P=R+"",M=I+"",oa=aa+"",N,J=1,O=15,T=20,U,ma,na,$,la,V=new Date,ba={},W={add:function(a,b){ba[a]=
{data:b,time:Date.now()}},get:function(a){return ba[a]&&ba[a].data},purge:function(){V.setMinutes(V.getMinutes()-5);for(var a in ba)ba[a].time<V&&delete ba[a]}},A,ia=function(a){return function(b){Y(b,a)}},Y=function(a,b){if(a){var d;if("FeatureCollection"===a.type){d=a.features;var c,g,l,e,f,h,k=[],n,p,t,s,j,w,x,q;c=0;for(g=d.length;c<g;c++)if(n=d[c],"Feature"===n.type&&(p=n.geometry,n=n.properties,"LineString"===p.type&&(w=t.length-1,t[0][0]===t[w][0]&&t[0][1]===t[w][1]&&(t=p.coordinates)),"Polygon"===
p.type&&(t=p.coordinates),"MultiPolygon"===p.type&&(t=p.coordinates[0]),t)){if(n.color||n.wallColor)s=n.color||n.wallColor;n.roofColor&&(j=n.roofColor);p=t[0];q=[];x=n.height;l=w=0;for(e=p.length;l<e;l++)q.push(p[l][1],p[l][0]),w+=x||p[l][2]||0;x=[];l=1;for(e=t.length;l<e;l++){p=t[c];x[l-1]=[];f=0;for(h=p.length;f<h;f++)x[l-1].push(p[f][1],p[f][0])}l={id:n.id||q[0]+","+q[1],footprint:wa(q,"CW")};w&&(l.height=w/p.length<<0);n.minHeight&&(l.minHeight=n.minHeight);s&&(l.wallColor=s);j&&(l.roofColor=
j);x.length&&(l.holes=x);k.push(l)}d=k}else a.osm3s&&(d=Ka(a.elements));b&&W.add(b,d);da(d,!0)}},ca=function(a){for(var b,d,c=new Ea(a.length),g=0,e=a.length-1;g<e;g+=2)b=a[g+1],d=qa(1,ya(0,0.5-Oa(xa(Wa+Ma*a[g]/180))/ja/2)),b=(b/360+0.5)*B<<0,d=d*B<<0,c[g]=b,c[g+1]=d;a=c;c=a.length/2;g=new Fa(c);e=0;b=c-1;var f,h,k,j=[],n=[],p=[];for(g[e]=g[b]=1;b;){f=0;for(d=e+1;d<b;d++){h=a[2*d];var t=a[2*d+1],s=a[2*e],q=a[2*e+1],w=a[2*b],x=a[2*b+1],u=w-s,m=x-q,r=void 0;if(0!==u||0!==m)r=((h-s)*u+(t-q)*m)/(u*u+
m*m),1<r?(s=w,q=x):0<r&&(s+=u*r,q+=m*r);u=h-s;m=t-q;h=u*u+m*m;h>f&&(k=d,f=h)}2<f&&(g[k]=1,j.push(e),n.push(k),j.push(k),n.push(b));e=j.pop();b=n.pop()}for(d=0;d<c;d++)g[d]&&p.push(a[2*d],a[2*d+1]);c=p;if(!(8>c.length))return c},da=function(a,b){var d,e,g,f,h=[],k,j,q,n,p,t,s,u,m=T-y;d=0;for(e=a.length;d<e;d++)if(k=a[d],j=3*(k.height||15)>>m)if(q=3*k.minHeight>>m,!(q>U)&&(n=ca(k.footprint))){s=[];if(k.holes){g=0;for(f=k.holes.length;g<f;g++)(u=ca(k.holes[g]))&&s.push(u)}f=g=null;if(k.wallColor&&(p=
S.parse(k.wallColor)))g=p.setAlpha(J),f=""+g.setLightness(0.8),g=""+g;t=null;if(k.roofColor&&(p=S.parse(k.roofColor)))t=""+p.setAlpha(J);h.push({id:k.id,footprint:n,height:qa(j,U),minHeight:q,wallColor:g,altColor:f,roofColor:t,center:H(n),holes:s.length?s:null})}e=0;for(k=h.length;e<k;e++)d=h[e],sa[d.id]||(d.scale=b?0:1,pa.renderItems.push(h[e]),sa[d.id]=1);N||(N=setInterval(function(){for(var a,b=!1,d=0,e=A.renderItems.length;d<e;d++)a=A.renderItems[d],1>a.scale&&(a.scale+=0.1,1<a.scale&&(a.scale=
1),b=!0);c();b||(clearInterval(N),N=null)},33))},Aa,sa={},pa={renderItems:[],load:function(a){Aa=a||"http://overpass-api.de/api/interpreter?data=[out:json];(way[%22building%22]({s},{w},{n},{e});node(w);way[%22building:part%22=%22yes%22]({s},{w},{n},{e});node(w);relation[%22building%22]({s},{w},{n},{e});way(r);node(w););out;";pa.update()},update:function(){if(Aa&&!(15>y)){var c=a(F,G),e=a(F+k,G+u),d=0.0075*Ga(c.latitude/0.0075),f=0.015*Ga(e.longitude/0.015),e=0.0075*Ha(e.latitude/0.0075),c=0.015*Ha(c.longitude/
0.015);W.purge();pa.renderItems=[];sa={};for(var g,l,h;e<=d;e+=0.0075)for(g=c;g<=f;g+=0.015)h=e+","+g,(l=W.get(h))?da(l):b(Aa,{n:(1E4*(e+0.0075)<<0)/1E4,e:(1E4*(g+0.015)<<0)/1E4,s:(1E4*e<<0)/1E4,w:(1E4*g<<0)/1E4},ia(h))}},set:function(a){pa.renderItems=[];sa={};Y(a)}};A=pa;var ka,ua=function(a,b,d){return{x:a+ta.x*d,y:b+ta.y*d}},q,ea=!0,fa=new S(0,0,0),ga=null,ta={x:0,y:0},Ba={setContext:function(a){q=a;Ba.setDate((new Date).setHours(10))},enable:function(a){ea=!!a},render:function(){var b,c,d,e;
q.clearRect(0,0,k,u);if(ea&&!(y<O||la))if(b=a(F+z,G+E),b=Ja(ga,b.latitude,b.longitude),!(0>=b.altitude)){c=1/xa(b.altitude);d=0.4/c;ta.x=Qa(b.azimuth)*c;ta.y=Pa(b.azimuth)*c;fa.a=d;e=fa+"";var g,f,h,j,m,r,n,p,t,s,v,w,x=[];q.beginPath();b=0;for(c=A.renderItems.length;b<c;b++){f=A.renderItems[b];p=!1;h=f.footprint;n=[];d=0;for(g=h.length-1;d<g;d+=2)n[d]=m=h[d]-F,n[d+1]=r=h[d+1]-G,p||(p=0<m&&m<k&&0<r&&r<u);if(p){h=1>f.scale?f.height*f.scale:f.height;f.minHeight&&(j=1>f.scale?f.minHeight*f.scale:f.minHeight);
m=null;d=0;for(g=n.length-3;d<g;d+=2)r=n[d],t=n[d+1],p=n[d+2],s=n[d+3],v=ua(r,t,h),w=ua(p,s,h),f.minHeight&&(t=ua(r,t,j),s=ua(p,s,j),r=t.x,t=t.y,p=s.x,s=s.y),(p-r)*(v.y-t)>(v.x-r)*(s-t)?(1===m&&q.lineTo(r,t),m=0,d||q.moveTo(r,t),q.lineTo(p,s)):(0===m&&q.lineTo(v.x,v.y),m=1,d||q.moveTo(v.x,v.y),q.lineTo(w.x,w.y));q.closePath();x.push(n)}}q.fillStyle=e;q.fill();q.globalCompositeOperation="destination-out";q.beginPath();b=0;for(c=x.length;b<c;b++){j=x[b];q.moveTo(j[0],j[1]);d=2;for(g=j.length;d<g;d+=
2)q.lineTo(j[d],j[d+1]);q.lineTo(j[0],j[1]);q.closePath()}q.fillStyle="#00ff00";q.fill();q.globalCompositeOperation="source-over"}},setDate:function(a){ga=a;Ba.render()}};ka=Ba;var ra,K,ha={MAX_HEIGHT:8,setContext:function(a){K=a},render:function(){K.clearRect(0,0,k,u);if(!(y<O||la)){var a,b,d,c,e,f,h,j,m;K.beginPath();a=0;for(b=A.renderItems.length;a<b;a++)if(d=A.renderItems[a],!(d.height>ha.MAX_HEIGHT)){m=!1;e=d.footprint;j=[];d=0;for(c=e.length-1;d<c;d+=2)j[d]=f=e[d]-F,j[d+1]=h=e[d+1]-G,m||(m=
0<f&&f<k&&0<h&&h<u);if(m){d=0;for(c=j.length-3;d<c;d+=2)m=j[d],e=j[d+1],d?K.lineTo(m,e):K.moveTo(m,e);K.closePath()}}K.fillStyle=oa;K.strokeStyle=M;K.stroke();K.fill()}}};ra=ha;var Ca,Da=function(){var a=Ia.createElement("CANVAS");a.style.webkitTransform="translate3d(0,0,0)";a.style.imageRendering="optimizeSpeed";a.style.position="absolute";a.style.left=0;a.style.top=0;var b=a.getContext("2d");b.lineCap="round";b.lineJoin="round";b.lineWidth=1;b.mozImageSmoothingEnabled=!1;b.webkitImageSmoothingEnabled=
!1;va.push(a);X.appendChild(a);return b},X=Ia.createElement("DIV");X.style.pointerEvents="none";X.style.position="absolute";X.style.left=0;X.style.top=0;var va=[];ka.setContext(Da());ra.setContext(Da());D=Da();Ca={appendTo:function(a){a.appendChild(X);return X},setSize:function(a,b){for(var d=0,c=va.length;d<c;d++)va[d].width=a,va[d].height=b}};this.setStyle=function(a){a=a||{};if(a.color||a.wallColor)R=S.parse(a.color||a.wallColor),P=R.setAlpha(J)+"",I=R.setLightness(0.8),M=I.setAlpha(J)+"",aa=R.setLightness(1.2),
oa=aa.setAlpha(J)+"";a.roofColor&&(aa=S.parse(a.roofColor),oa=aa.setAlpha(J)+"");void 0!==a.shadows&&ka.enable(a.shadows);c()};this.setCamOffset=function(a,b){ma=z+a;na=u+b};this.setMaxZoom=function(a){T=a};this.setDate=function(a){ka.setDate(a)};this.appendTo=function(a){return Ca.appendTo(a)};this.loadData=function(a){A.load(a)};this.setData=function(a){A.set(a)};this.onMoveEnd=function(){c();A.update()};this.onZoomEnd=function(a){la=!1;j(a.zoom);A.update();c()};this.onZoomStart=function(){la=!0;
c()};this.setOrigin=function(a,b){F=a;G=b};this.setSize=function(a,b){k=a;u=b;z=k/2<<0;E=u/2<<0;ma=z;na=u;$=k/(1.5/(window.devicePixelRatio||1))/xa(45)<<0;Ca.setSize(k,u);U=$-50};this.setZoom=j;this.render=f};h.VERSION="0.1.8a";h.ATTRIBUTION='&copy; <a href="http://osmbuildings.org">OSM Buildings</a>';return h}();
L.BuildingsLayer=L.Class.extend({map:null,osmb:null,container:null,blockMoveEvent:null,lastX:0,lastY:0,initialize:function(e){L.Util.setOptions(this,e)},onMove:function(){var e=L.DomUtil.getPosition(this.map._mapPane);this.osmb.setCamOffset(this.lastX-e.x,this.lastY-e.y);this.osmb.render()},onMoveEnd:function(){if(this.blockMoveEvent)this.blockMoveEvent=!1;else{var e=L.DomUtil.getPosition(this.map._mapPane),H=this.map.getPixelOrigin();this.lastX=e.x;this.lastY=e.y;this.container.style.left=-e.x+"px";
this.container.style.top=-e.y+"px";this.osmb.setCamOffset(0,0);this.osmb.setSize(this.map._size.x,this.map._size.y);this.osmb.setOrigin(H.x-e.x,H.y-e.y);this.osmb.onMoveEnd()}},onZoomStart:function(){this.osmb.onZoomStart()},onZoomEnd:function(){var e=L.DomUtil.getPosition(this.map._mapPane),H=this.map.getPixelOrigin();this.osmb.setOrigin(H.x-e.x,H.y-e.y);this.osmb.onZoomEnd({zoom:this.map._zoom});this.blockMoveEvent=!0},addTo:function(e){e.addLayer(this);return this},onAdd:function(e){this.map=e;
e=this.map._panes.overlayPane;this.osmb?e.appendChild(this.container):(this.osmb=new OSMBuildings,this.container=this.osmb.appendTo(e),this.osmb.maxZoom=this.map._layersMaxZoom);e=L.DomUtil.getPosition(this.map._mapPane);var H=this.map.getPixelOrigin();this.osmb.setSize(this.map._size.x,this.map._size.y);this.osmb.setOrigin(H.x-e.x,H.y-e.y);this.osmb.setZoom(this.map._zoom);this.container.style.left=-e.x+"px";this.container.style.top=-e.y+"px";this.map.on({move:this.onMove,moveend:this.onMoveEnd,
zoomstart:this.onZoomStart,zoomend:this.onZoomEnd},this);this.map.attributionControl.addAttribution(OSMBuildings.ATTRIBUTION);this.osmb.render()},onRemove:function(e){e.attributionControl.removeAttribution(OSMBuildings.ATTRIBUTION);e.off({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd},this);this.container.parentNode.removeChild(this.container)},setStyle:function(e){this.osmb.setStyle(e);return this},setDate:function(e){this.osmb.setDate(e);return this},
load:function(e){this.osmb.loadData(e);return this},geoJSON:function(e){this.osmb.setData(e);return this}});
