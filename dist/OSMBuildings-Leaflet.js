!function(a){"use strict";function b(a,b){var c=a[0]-b[0],d=a[1]-b[1];return c*c+d*d}function c(a){var c=a.length;if(c<8)return!1;var e=d(a),f=e.max[0]-e.min[0],g=e.max[1]-e.min[1],h=f/g;if(h<.85||h>1.15)return!1;for(var i,j=[e.min[0]+f/2,e.min[1]+g/2],k=(f+g)/4,l=k*k,m=0;m<c;m++)if(i=b(a[m],j),i/l<.8||i/l>1.2)return!1;return!0}function d(a){var b=1/0,c=-(1/0),d=1/0,e=-(1/0);return a.forEach(function(a){b=Math.min(b,a[0]),c=Math.max(c,a[0]),d=Math.min(d,a[1]),e=Math.max(e,a[1])}),{min:[b,d],max:[c,e]}}function e(a){var b=d(a);return[b.min[0]+(b.max[0]-b.min[0])/2,b.min[1]+(b.max[1]-b.min[1])/2]}function f(a){var b=180,c=-180;return a.forEach(function(a){b=Math.min(b,a[0]),c=Math.max(c,a[0])}),c-b}function g(a){return a/V*180}function h(a,b){return a/=J,b/=J,[360*(1===a?1:(a%1+1)%1)-180,b<=0?90:b>=1?-90:g(2*Math.atan(Math.exp(V*(1-2*b)))-W)]}function i(a,b){var c=Math.min(1,Math.max(0,.5-Math.log(Math.tan(X+W*b/180))/Math.PI/2)),d=a/360+.5;return[d*J<<0,c*J<<0]}function j(a){for(var b=$+ca,c=_+da,d=0;d<a;d++)if(a[d][0]>ca&&a[d][0]<b&&a[d][1]>da&&a[d][1]<c)return!0;return!1}function k(){P||(P=setInterval(function(){for(var a=oa.items,b=!1,c=0,d=a.length;c<d;c++)a[c].scale<1&&(a[c].scale+=.1,a[c].scale>1&&(a[c].scale=1),b=!0);sa.render(),b||(clearInterval(P),P=null)},33))}function l(a){ca=a.x,da=a.y}function m(a){M=aa+a.x,N=_+a.y,sa.render(!0)}function n(a){$=a.width,_=a.height,aa=$/2<<0,ba=_/2<<0,M=aa,N=_,sa.setSize($,_),K=ma-50}function o(a){I=a,J=Y<<I;var b=h(ca+aa,da+ba),c=i(0,b[1]),d=i(1,b[1]);ka=d[0]-c[0],sa.setOpacity(Math.pow(.95,I-Z)),ha=""+ea,ia=""+fa,ja=""+ga}function p(a){sa.render(),oa.update()}function q(){O=!0}function r(a){O=!1;var b=Math.pow(2,a.zoom-I);return o(a.zoom),I<=Z?void sa.clear():(oa.scale(b),va.render(),ua.render(),ta.render(),void oa.update())}var s=Math,t=(s.exp,s.log,s.sin),u=s.cos,v=s.tan,w=(s.atan,s.atan2),x=s.min,y=s.max,z=s.sqrt,A=s.ceil,B=(s.floor,s.round,s.pow),C=C||Array,D=D||Array,E=/iP(ad|hone|od)/g.test(navigator.userAgent),F=!!~navigator.userAgent.indexOf("Trident"),G=!a.requestAnimationFrame||E||F?function(a){a()}:a.requestAnimationFrame,H=function(){function a(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}function b(a,b){if(void 0!==a)return Math.min(b,Math.max(0,a||0))}var c={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},d=function(a,c,d,e){this.r=b(a,1),this.g=b(c,1),this.b=b(d,1),this.a=b(e,1)||1};return d.parse=function(a){if("string"==typeof a){a=a.toLowerCase(),a=c[a]||a;var b;if(b=a.match(/^#?(\w{2})(\w{2})(\w{2})$/))return new d(parseInt(b[1],16)/255,parseInt(b[2],16)/255,parseInt(b[3],16)/255);if(b=a.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new d(parseFloat(b[1])/255,parseFloat(b[2])/255,parseFloat(b[3])/255,b[4]?parseFloat(b[5]):1)}return new d},d.fromHSL=function(b,c,e,f){if(0===c)return new d(e,e,e,f);var g=e<.5?e*(1+c):e+c-e*c,h=2*e-g;return b/=360,new d(a(h,g,b+1/3),a(h,g,b),a(h,g,b-1/3),f)},d.prototype={toHSL:function(){if(void 0!==this.r&&void 0!==this.g&&void 0!==this.b){var a,b,c=Math.max(this.r,this.g,this.b),d=Math.min(this.r,this.g,this.b),e=(c+d)/2,f=c-d;if(f){switch(b=e>.5?f/(2-c-d):f/(c+d),c){case this.r:a=(this.g-this.b)/f+(this.g<this.b?6:0);break;case this.g:a=(this.b-this.r)/f+2;break;case this.b:a=(this.r-this.g)/f+4}a*=60}else a=b=0;return{h:a,s:b,l:e,a:this.a}}},toString:function(){if(void 0!==this.r&&void 0!==this.g&&void 0!==this.b)return 1===this.a?"#"+((1<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)).toString(16).slice(1,7):"rgba("+[Math.round(255*this.r),Math.round(255*this.g),Math.round(255*this.b),this.a.toFixed(2)].join(",")+")"},toArray:function(){if(void 0!==this.r&&void 0!==this.g&&void 0!==this.b)return[this.r,this.g,this.b]},hue:function(a){var b=this.toHSL();return d.fromHSL(b.h+a,b.s,b.l)},saturation:function(a){var b=this.toHSL();return d.fromHSL(b.h,b.s*a,b.l)},lightness:function(a){var b=this.toHSL();return d.fromHSL(b.h,b.s,b.l*a)},red:function(a){return new d(this.r*a,this.g,this.b,this.a)},green:function(a){return new d(this.r,this.g*a,this.b,this.a)},blue:function(a){return new d(this.r,this.g,this.b*a,this.a)},alpha:function(a){return new d(this.r,this.g,this.b,this.a*a)},copy:function(){return new d(this.r,this.g,this.b,this.a)}},d}();"object"==typeof module&&(module.exports=H);var I,J,K,M,N,O,P,Q=function(){function a(a){return a.valueOf()/s-.5+t}function b(b){return a(b)-u}function c(a,b){return q(m(a)*n(v)-o(b)*m(v),n(a))}function d(a,b){return p(m(b)*n(v)+n(b)*m(v)*m(a))}function e(a,b,c){return q(m(a),n(a)*m(b)-o(c)*n(b))}function f(a,b,c){return p(m(b)*m(c)+n(b)*n(c)*n(a))}function g(a,b){return r*(280.16+360.9856235*a)-b}function h(a){return r*(357.5291+.98560028*a)}function i(a){return r*(1.9148*m(a)+.02*m(2*a)+3e-4*m(3*a))}function j(a,b){var c=102.9372*r;return a+b+c+l}var k=Math,l=k.PI,m=k.sin,n=k.cos,o=k.tan,p=k.asin,q=k.atan2,r=l/180,s=864e5,t=2440588,u=2451545,v=23.4397*r;return function(a,k,m){var n=r*-m,o=r*k,p=b(a),q=h(p),s=i(q),t=j(q,s),u=d(t,0),v=c(t,0),w=g(p,n),x=w-v;return{altitude:f(x,o,u),azimuth:e(x,o,u)-l/2}}}(),R=function(){function a(a){return a=a.toLowerCase(),"#"===a[0]?a:i[j[a]||a]||null}function b(a){var b,c,d,e,f,g,h=0;for(f=0,g=a.length-3;f<g;f+=2)b=a[f],c=a[f+1],d=a[f+2],e=a[f+3],h+=b*e-d*c;return h/2>0?k:l}function c(a,c){var d=b(a);if(d===c)return a;for(var e=[],f=a.length-2;f>=0;f-=2)e.push(a[f],a[f+1]);return e}function d(b){var c={};b=b||{},c.height=b.height||(b.levels?b.levels*h:la),c.minHeight=b.minHeight||(b.minLevel?b.minLevel*h:0);var d=b.material?a(b.material):b.wallColor||b.color;d&&(c.wallColor=d);var e=b.roofMaterial?a(b.roofMaterial):b.roofColor;switch(e&&(c.roofColor=e),b.shape){case"cylinder":case"cone":case"dome":case"sphere":c.shape=b.shape,c.isRotational=!0;break;case"pyramid":c.shape=b.shape}switch(b.roofShape){case"cone":case"dome":c.roofShape=b.roofShape,c.isRotational=!0;break;case"pyramid":c.roofShape=b.roofShape}return c.roofShape&&b.roofHeight?(c.roofHeight=b.roofHeight,c.height=y(0,c.height-c.roofHeight)):c.roofHeight=0,c}function e(a){var b,d,f,g=[];switch(a.type){case"GeometryCollection":for(g=[],b=0,d=a.geometries.length;b<d;b++)(f=e(a.geometries[b]))&&g.push.apply(g,f);return g;case"MultiPolygon":for(g=[],b=0,d=a.coordinates.length;b<d;b++)(f=e({type:"Polygon",coordinates:a.coordinates[b]}))&&g.push.apply(g,f);return g;case"Polygon":var h=a.coordinates.map(function(a,b){return c(a,b?l:k)});return[h]}return[]}function g(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var h=3,i={brick:"#cc7755",bronze:"#ffeecc",canvas:"#fff8f0",concrete:"#999999",copper:"#a0e0d0",glass:"#e8f8f8",gold:"#ffcc00",plants:"#009933",metal:"#aaaaaa",panel:"#fff8f0",plaster:"#999999",roof_tiles:"#f08060",silver:"#cccccc",slate:"#666666",stone:"#996666",tar_paper:"#333333",wood:"#deb887"},j={asphalt:"tar_paper",bitumen:"tar_paper",block:"stone",bricks:"brick",glas:"glass",glassfront:"glass",grass:"plants",masonry:"stone",granite:"stone",panels:"panel",paving_stones:"stone",plastered:"plaster",rooftiles:"roof_tiles",roofingfelt:"tar_paper",sandstone:"stone",sheet:"canvas",sheets:"canvas",shingle:"tar_paper",shingles:"tar_paper",slates:"slate",steel:"metal",tar:"tar_paper",tent:"canvas",thatch:"plants",tile:"roof_tiles",tiles:"roof_tiles"},k="CW",l="CCW";return{read:function(a){if(!a||"FeatureCollection"!==a.type)return[];var b,c,h,i,j,k,l,m,n=a.features,o=[];for(b=0,c=n.length;b<c;b++)if(j=n[b],"Feature"===j.type&&za(j)!==!1)for(l=d(j.properties),k=e(j.geometry),h=0,i=k.length;h<i;h++)m=g(l),m.geometry=k[h],m.isRotational&&(m.radius=f(m.geometry[0])/2),(j.id||j.properties.id)&&(m.id=j.id||j.properties.id),j.properties.relationId&&(m.relationId=j.properties.relationId),o.push(m);return o}}}(),S="0.2.3b",T='&copy; <a href="https://osmbuildings.org">OSM Buildings</a>',U="https://{s}.data.osmbuildings.org/0.2/{k}/tile/{z}/{x}/{y}.json",V=Math.PI,W=V/2,X=V/4,Y=256,Z=15,$=0,_=0,aa=0,ba=0,ca=0,da=0,ea=H.parse("rgba(200, 190, 180)"),fa=ea.lightness(.8),ga=ea.lightness(1.2),ha=""+ea,ia=""+fa,ja=""+ga,ka=0,la=5,ma=450,na=function(){function a(a,f){if(b[a])return void(f&&f(b[a]));var g=new XMLHttpRequest;return g.onreadystatechange=function(){if(4===g.readyState&&!(!g.status||g.status<200||g.status>299)&&f&&g.responseText){var h=g.responseText;for(b[a]=h,c.push({url:a,size:h.length}),d+=h.length,f(h);d>e;){var i=c.shift();d-=i.size,delete b[i.url]}}},g.open("GET",a),g.send(null),g}var b={},c=[],d=0,e=5242880;return{loadJSON:function(b,c){return a(b,function(a){var b;try{b=JSON.parse(a)}catch(d){}c(b)})}}}(),oa={loadedItems:{},items:[],projectGeometry:function(a){return a.map(function(a){return a.map(function(a){return i(a[0],a[1])})})},resetItems:function(){this.items=[],this.loadedItems={},wa.reset()},addRenderItems:function(a,b){for(var c,d,e,f=R.read(a),g=0,h=f.length;g<h;g++)c=f[g],e=c.id||[c.geometry[0][0],c.geometry[0][1],c.height,c.minHeight].join(","),this.loadedItems[e]||(d=this.scaleItem(c))&&(d.scale=b?0:1,this.items.push(d),this.loadedItems[e]=1);k()},scaleGeometry:function(a,b){return a.map(function(a){return a.map(function(a){return[a[0]*b,a[1]*b]})})},scale:function(a){oa.items=oa.items.map(function(b){return b.height*=a,b.minHeight*=a,b.geometry=oa.scaleGeometry(b.geometry,a),b.center.x*=a,b.center.y*=a,b.radius&&(b.radius*=a),b.roofHeight*=a,b})},scaleItem:function(a){var b={},d=6/B(2,I-Z);if(a.id&&(b.id=a.id),b.height=x(a.height/d,K),b.minHeight=isNaN(a.minHeight)?0:a.minHeight/d,!(b.minHeight>K||(b.geometry=oa.projectGeometry(a.geometry),b.geometry[0].length<4))){b.center=e(b.geometry[0]),a.radius&&(b.radius=a.radius*ka),a.shape&&(b.shape=a.shape),a.roofShape&&(b.roofShape=a.roofShape),"cone"!==b.roofShape&&"dome"!==b.roofShape||b.shape||!c(b.geometry[0])||(b.shape="cylinder");var f;if(a.wallColor&&(f=H.parse(a.wallColor))&&(b.altColor=""+f.lightness(.8),b.wallColor=""+f),a.roofColor&&(f=H.parse(a.roofColor))&&(b.roofColor=""+f),a.relationId&&(b.relationId=a.relationId),b.hitColor=wa.idToColor(a.relationId||a.id),b.roofHeight=isNaN(a.roofHeight)?0:a.roofHeight/d,!(b.height+b.roofHeight<=b.minHeight))return b}},set:function(a){this.isStatic=!0,this.resetItems(),this._staticData=a,this.addRenderItems(this._staticData,!0)},load:function(a,b){this.src=a||U.replace("{k}",b||"anonymous"),this.update()},update:function(){function a(a){k.addRenderItems(a)}if(this.resetItems(),!(I<Z)){if(this.isStatic&&this._staticData)return void this.addRenderItems(this._staticData);if(this.src){var b,c,d=16,e=256,f=I>d?e<<I-d:e>>d-I,g=ca/f<<0,h=da/f<<0,i=A((ca+$)/f),j=A((da+_)/f),k=this;for(c=h;c<=j;c++)for(b=g;b<=i;b++)this.loadTile(b,c,d,a)}}},loadTile:function(a,b,c,d){var e="abcd"[(a+b)%4],f=this.src.replace("{s}",e).replace("{x}",a).replace("{y}",b).replace("{z}",c);return na.loadJSON(f,d)}},pa={draw:function(a,b,c,d,e,f,g){var h,i,j=this._extrude(a,b[0],c,d,e,f),k=[];if(b.length>1)for(h=1,i=b.length;h<i;h++)k[h]=this._extrude(a,b[h],c,d,e,f);if(a.fillStyle=g,a.beginPath(),this._ring(a,j),b.length>1)for(h=0,i=k.length;h<i;h++)this._ring(a,k[h]);a.closePath(),a.fill()},_extrude:function(a,b,c,d,e,f){for(var g,h,i=ma/(ma-c),j=ma/(ma-d),k={x:0,y:0},l={x:0,y:0},m=[],n=0,o=b.length-3;n<o;n+=2)k.x=b[n]-ca,k.y=b[n+1]-da,l.x=b[n+2]-ca,l.y=b[n+3]-da,g=ta.project(k,i),h=ta.project(l,i),d&&(k=ta.project(k,j),l=ta.project(l,j)),(l.x-k.x)*(g.y-k.y)>(g.x-k.x)*(l.y-k.y)&&(k.x<l.x&&k.y<l.y||k.x>l.x&&k.y>l.y?a.fillStyle=f:a.fillStyle=e,a.beginPath(),this._ring(a,[l.x,l.y,k.x,k.y,g.x,g.y,h.x,h.y]),a.closePath(),a.fill()),m[n]=g.x,m[n+1]=g.y;return m},_ring:function(a,b){a.moveTo(b[0],b[1]);for(var c=2,d=b.length-1;c<d;c+=2)a.lineTo(b[c],b[c+1])},simplified:function(a,b){if(a.beginPath(),this._ringAbs(a,b[0]),b.length>1)for(var c=1,d=b.length;c<d;c++)this._ringAbs(a,b[c]);a.closePath(),a.fill()},_ringAbs:function(a,b){a.moveTo(b[0]-ca,b[1]-da);for(var c=2,d=b.length-1;c<d;c+=2)a.lineTo(b[c]-ca,b[c+1]-da)},shadow:function(a,b,c,d){for(var e,f,g=null,h={x:0,y:0},i={x:0,y:0},j=0,k=b[0].length-1;j<k;j++)h.x=b[0][j][0]-ca,h.y=b[0][j][1]-da,i.x=b[0][j+1][0]-ca,i.y=b[0][j+1][1]-da,e=va.project(h,c),f=va.project(i,c),d&&(h=va.project(h,d),i=va.project(i,d)),(i.x-h.x)*(e.y-h.y)>(e.x-h.x)*(i.y-h.y)?(1===g&&a.lineTo(h.x,h.y),g=0,j||a.moveTo(h.x,h.y),a.lineTo(i.x,i.y)):(0===g&&a.lineTo(e.x,e.y),g=1,j||a.moveTo(e.x,e.y),a.lineTo(f.x,f.y));if(b.length>1)for(j=1,k=b.length;j<k;j++)this._ringAbs(a,b[j])},hitArea:function(a,b,c,d,e){var f,g,h=null,i={x:0,y:0},j={x:0,y:0},k=ma/(ma-c),l=ma/(ma-d);a.fillStyle=e,a.beginPath();for(var m=0,n=b[0].length-1;m<n;m+=2)i.x=b[0][m][0]-ca,i.y=b[0][m][1]-da,j.x=b[0][m+1][0]-ca,j.y=b[0][m+1][1]-da,f=ta.project(i,k),g=ta.project(j,k),d&&(i=ta.project(i,l),j=ta.project(j,l)),(j.x-i.x)*(f.y-i.y)>(f.x-i.x)*(j.y-i.y)?(1===h&&a.lineTo(i.x,i.y),h=0,m||a.moveTo(i.x,i.y),a.lineTo(j.x,j.y)):(0===h&&a.lineTo(f.x,f.y),h=1,m||a.moveTo(f.x,f.y),a.lineTo(g.x,g.y));a.closePath(),a.fill()}},qa={draw:function(a,b,c,d,e,f,g,h,i){var j,k,l={x:b.x-ca,y:b.y-da},m=ma/(ma-e),n=ma/(ma-f),o=ta.project(l,m);d*=m,f&&(l=ta.project(l,n),c*=n);var p=this._tangents(l,c,o,d);p?(j=w(p[0].y1-l.y,p[0].x1-l.x),k=w(p[1].y1-l.y,p[1].x1-l.x)):(j=1.5*V,k=1.5*V),a.fillStyle=g,a.beginPath(),a.arc(o.x,o.y,d,W,j,!0),a.arc(l.x,l.y,c,j,W),a.closePath(),a.fill(),a.fillStyle=h,a.beginPath(),a.arc(o.x,o.y,d,k,W,!0),a.arc(l.x,l.y,c,W,k),a.closePath(),a.fill(),a.fillStyle=i,this._circle(a,o,d)},simplified:function(a,b,c){this._circle(a,{x:b.x-ca,y:b.y-da},c)},shadow:function(a,b,c,d,e,f){var g,h,i={x:b.x-ca,y:b.y-da},j=va.project(i,e);f&&(i=va.project(i,f));var k=this._tangents(i,c,j,d);k?(g=w(k[0].y1-i.y,k[0].x1-i.x),h=w(k[1].y1-i.y,k[1].x1-i.x),a.moveTo(k[1].x2,k[1].y2),a.arc(j.x,j.y,d,h,g),a.arc(i.x,i.y,c,g,h)):(a.moveTo(i.x+c,i.y),a.arc(i.x,i.y,c,0,2*V))},hitArea:function(a,b,c,d,e,f,g){var h,i,j={x:b.x-ca,y:b.y-da},k=ma/(ma-e),l=ma/(ma-f),m=ta.project(j,k);d*=k,f&&(j=ta.project(j,l),c*=l);var n=this._tangents(j,c,m,d);a.fillStyle=g,a.beginPath(),n?(h=w(n[0].y1-j.y,n[0].x1-j.x),i=w(n[1].y1-j.y,n[1].x1-j.x),a.moveTo(n[1].x2,n[1].y2),a.arc(m.x,m.y,d,i,h),a.arc(j.x,j.y,c,h,i)):(a.moveTo(j.x+c,j.y),a.arc(j.x,j.y,c,0,2*V)),a.closePath(),a.fill()},_circle:function(a,b,c){a.beginPath(),a.arc(b.x,b.y,c,0,2*V),a.fill()},_tangents:function(a,b,c,d){var e=a.x-c.x,f=a.y-c.y,g=b-d,h=e*e+f*f;if(!(h<=g*g)){var i,j,k,l=z(h),m=-e/l,n=-f/l,o=g/l,p=[];i=z(y(0,1-o*o));for(var q=1;q>=-1;q-=2)j=m*o-q*i*n,k=n*o+q*i*m,p.push({x1:a.x+b*j<<0,y1:a.y+b*k<<0,x2:c.x+d*j<<0,y2:c.y+d*k<<0});return p}}},ra={draw:function(a,b,c,d,e,f,g){for(var h={x:c.x-ca,y:c.y-da},i=ma/(ma-d),j=ma/(ma-e),k=ta.project(h,i),l={x:0,y:0},m={x:0,y:0},n=0,o=b.length-3;n<o;n+=2)l.x=b[n]-ca,l.y=b[n+1]-da,m.x=b[n+2]-ca,m.y=b[n+3]-da,e&&(l=ta.project(l,j),m=ta.project(m,j)),(m.x-l.x)*(k.y-l.y)>(k.x-l.x)*(m.y-l.y)&&(l.x<m.x&&l.y<m.y||l.x>m.x&&l.y>m.y?a.fillStyle=g:a.fillStyle=f,a.beginPath(),this._triangle(a,l,m,k),a.closePath(),a.fill())},_triangle:function(a,b,c,d){a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.lineTo(d.x,d.y)},_ring:function(a,b){a.moveTo(b[0]-ca,b[1]-da);for(var c=2,d=b.length-1;c<d;c+=2)a.lineTo(b[c]-ca,b[c+1]-da)},shadow:function(a,b,c,d,e){for(var f={x:0,y:0},g={x:0,y:0},h={x:c.x-ca,y:c.y-da},i=va.project(h,d),j=0,k=b.length-3;j<k;j+=2)f.x=b[j]-ca,f.y=b[j+1]-da,g.x=b[j+2]-ca,g.y=b[j+3]-da,e&&(f=va.project(f,e),g=va.project(g,e)),(g.x-f.x)*(i.y-f.y)>(i.x-f.x)*(g.y-f.y)&&this._triangle(a,f,g,i)},hitArea:function(a,b,c,d,e,f){var g={x:c.x-ca,y:c.y-da},h=ma/(ma-d),i=ma/(ma-e),j=ta.project(g,h),k={x:0,y:0},l={x:0,y:0};a.fillStyle=f,a.beginPath();for(var m=0,n=b.length-3;m<n;m+=2)k.x=b[m]-ca,k.y=b[m+1]-da,l.x=b[m+2]-ca,l.y=b[m+3]-da,e&&(k=ta.project(k,i),l=ta.project(l,i)),(l.x-k.x)*(j.y-k.y)>(j.x-k.x)*(l.y-k.y)&&this._triangle(a,k,l,j);a.closePath(),a.fill()}},sa={container:document.createElement("DIV"),items:[],init:function(){sa.container.className="osmb-container",va.init(sa.createContext(sa.container)),ua.init(sa.createContext(sa.container)),ta.init(sa.createContext(sa.container)),wa.init(sa.createContext())},clear:function(){va.clear(),ua.clear(),ta.clear(),wa.clear()},setOpacity:function(a){va.setOpacity(a),ua.setOpacity(a),ta.setOpacity(a),wa.setOpacity(a)},render:function(a){return I<Z?void sa.clear():void(O||G(function(){a||(va.render(),ua.render()),ta.render()}))},createContext:function(a){var b=document.createElement("CANVAS");b.className="osmb-layer";var c=b.getContext("2d");return c.lineCap="round",c.lineJoin="round",c.lineWidth=1,c.imageSmoothingEnabled=!1,sa.items.push(b),a&&a.appendChild(b),c},appendTo:function(a){a.appendChild(sa.container)},remove:function(){sa.container.parentNode.removeChild(sa.container)},setSize:function(a,b){sa.items.forEach(function(c){c.width=a,c.height=b})},setPosition:function(a,b){sa.container.style.left=a+"px",sa.container.style.top=b+"px"}},ta={context:null,init:function(a){this.context=a},clear:function(){this.context.clearRect(0,0,$,_)},setOpacity:function(a){this.context.canvas.style.opacity=a},project:function(a,b){return{x:(a.x-M)*b+M<<0,y:(a.y-N)*b+N<<0}},render:function(){this.clear();var a,c,d,e,f,g,h=this.context,i={x:M+ca,y:N+da},k=oa.items;k.sort(function(a,c){return a.minHeight-c.minHeight||b(c.center,i)-b(a.center,i)||c.height-a.height});for(var l=0,m=k.length;l<m;l++)if(a=k[l],!ua.isSimple(a)&&j(a.geometry[0])){switch(c=a.scale<1?a.height*a.scale:a.height,d=0,a.minHeight&&(d=a.scale<1?a.minHeight*a.scale:a.minHeight),e=a.wallColor||ha,f=a.altColor||ia,g=a.roofColor||ja,h.strokeStyle=f,a.shape){case"cylinder":qa.draw(h,a.center,a.radius,a.radius,c,d,e,f,g);break;case"cone":qa.draw(h,a.center,a.radius,0,c,d,e,f);break;case"dome":qa.draw(h,a.center,a.radius,a.radius/2,c,d,e,f);break;case"sphere":qa.draw(h,a.center,a.radius,a.radius,c,d,e,f,g);break;case"pyramid":ra.draw(h,a.geometry[0],a.center,c,d,e,f);break;default:pa.draw(h,a.geometry,c,d,e,f,g)}switch(a.roofShape){case"cone":qa.draw(h,a.center,a.radius,0,c+a.roofHeight,c,g,""+H.parse(g).lightness(.9));break;case"dome":qa.draw(h,a.center,a.radius,a.radius/2,c+a.roofHeight,c,g,""+H.parse(g).lightness(.9));break;case"pyramid":ra.draw(h,a.geometry[0],a.center,c+a.roofHeight,c,g,H.parse(g).lightness(.9))}}}},ua={context:null,MAX_ZOOM:16,MAX_HEIGHT:5,init:function(a){this.context=a},clear:function(){this.context.clearRect(0,0,$,_)},setOpacity:function(a){this.context.canvas.style.opacity=a},isSimple:function(a){return I<=ua.MAX_ZOOM&&a.height+a.roofHeight<ua.MAX_HEIGHT},render:function(){this.clear();var a=this.context;if(!(I>ua.MAX_ZOOM))for(var b,c=oa.items,d=0,e=c.length;d<e;d++)if(b=c[d],!(b.height>=ua.MAX_HEIGHT)&&j(b.geometry[0]))switch(a.strokeStyle=b.altColor||ia,a.fillStyle=b.roofColor||ja,b.shape){case"cylinder":case"cone":case"dome":case"sphere":qa.simplified(a,b.center,b.radius);break;default:pa.simplified(a,b.geometry)}}},va={context:null,color:"#666666",blurColor:"#000000",date:new Date,direction:{x:0,y:0},opacity:1,init:function(a){this.context=a},clear:function(){this.context.clearRect(0,0,$,_)},setOpacity:function(a){this.opacity=a},project:function(a,b){return{x:a.x+this.direction.x*b,y:a.y+this.direction.y*b}},render:function(){this.clear();var a,b,c,d,e=this.context;if(a=pixelToGeo(aa+ca,ba+da),b=Q(this.date,a.latitude,a.longitude),!(b.altitude<=0)){c=1/v(b.altitude),d=c<5?.75:1/c*5,this.direction.x=u(b.azimuth)*c,this.direction.y=t(b.azimuth)*c;var f,g,h,i,k,l=oa.items;for(e.canvas.style.opacity=d/(2*this.opacity),e.shadowColor=this.blurColor,e.fillStyle=this.color,e.beginPath(),f=0,g=l.length;f<g;f++)if(h=l[f],j(h.geometry[0])){switch(i=h.scale<1?h.height*h.scale:h.height,k=0,h.minHeight&&(k=h.scale<1?h.minHeight*h.scale:h.minHeight),h.shape){case"cylinder":qa.shadow(e,h.center,h.radius,h.radius,i,k);break;case"cone":qa.shadow(e,h.center,h.radius,0,i,k);break;case"dome":qa.shadow(e,h.center,h.radius,h.radius/2,i,k);break;case"sphere":qa.shadow(e,h.center,h.radius,h.radius,i,k);break;case"pyramid":ra.shadow(e,h.geometry[0],h.center,i,k);break;default:pa.shadow(e,h.geometry,i,k)}switch(h.roofShape){case"cone":qa.shadow(e,h.center,h.radius,0,i+h.roofHeight,i);break;case"dome":qa.shadow(e,h.center,h.radius,h.radius/2,i+h.roofHeight,i);break;case"pyramid":ra.shadow(e,h.geometry[0],h.center,i+h.roofHeight,i)}}e.closePath(),e.fill()}}},wa={context:null,init:function(a){this.context=a},setOpacity:function(a){},clear:function(){},_idMapping:[null],reset:function(){this._idMapping=[null]},render:function(){if(!this._timer){var a=this;this._timer=setTimeout(function(){a._timer=null,a._render()},500)}},_render:function(){this.clear();var a,c,d,e,f=this.context,g={x:M+ca,y:N+da},h=oa.items;h.sort(function(a,c){return a.minHeight-c.minHeight||b(c.center,g)-b(a.center,g)||c.height-a.height});for(var i=0,k=h.length;i<k;i++)if(a=h[i],(e=a.hitColor)&&j(a.geometry[0])){switch(c=a.height,d=0,a.minHeight&&(d=a.minHeight),a.shape){case"cylinder":qa.hitArea(f,a.center,a.radius,a.radius,c,d,e);break;case"cone":qa.hitArea(f,a.center,a.radius,0,c,d,e);break;case"dome":qa.hitArea(f,a.center,a.radius,a.radius/2,c,d,e);break;case"sphere":qa.hitArea(f,a.center,a.radius,a.radius,c,d,e);break;case"pyramid":ra.hitArea(f,a.geometry[0],a.center,c,d,e);break;default:pa.hitArea(f,a.geometry,c,d,e)}switch(a.roofShape){case"cone":qa.hitArea(f,a.center,a.radius,0,c+a.roofHeight,c,e);break;case"dome":qa.hitArea(f,a.center,a.radius,a.radius/2,c+a.roofHeight,c,e);break;case"pyramid":ra.hitArea(f,a.geometry[0],a.center,c+a.roofHeight,c,e)}}$&&_&&(this._imageData=this.context.getImageData(0,0,$,_).data)},getIdFromXY:function(a,b){var c=this._imageData;if(c){var d=4*((0|b)*$+(0|a)),e=c[d]|c[d+1]<<8|c[d+2]<<16;return this._idMapping[e]}},idToColor:function(a){var b=this._idMapping.indexOf(a);b===-1&&(this._idMapping.push(a),b=this._idMapping.length-1);var c=255&b,d=b>>8&255,e=b>>16&255;return"rgb("+[c,d,e].join(",")+")"}},xa=function(a){this.offset={x:0,y:0},sa.init(),a&&a.addLayer(this)},ya=xa.prototype=L.Layer?new L.Layer:{};ya.addTo=function(a){return a.addLayer(this),this},ya.onAdd=function(a){this.map=a,sa.appendTo(a._panes.overlayPane);var b=this.getOffset(),c=a.getPixelOrigin();n({width:a._size.x,height:a._size.y}),l({x:c.x-b.x,y:c.y-b.y}),o(a._zoom),sa.setPosition(-b.x,-b.y),a.on({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd,resize:this.onResize,viewreset:this.onViewReset,click:this.onClick},this),a.options.zoomAnimation&&a.on("zoomanim",this.onZoom,this),a.attributionControl&&a.attributionControl.addAttribution(T),oa.update()},ya.onRemove=function(){var a=this.map;a.attributionControl&&a.attributionControl.removeAttribution(T),a.off({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd,resize:this.onResize,viewreset:this.onViewReset,click:this.onClick},this),a.options.zoomAnimation&&a.off("zoomanim",this.onZoom,this),sa.remove(),a=null},ya.onMove=function(a){var b=this.getOffset();m({x:this.offset.x-b.x,y:this.offset.y-b.y})},ya.onMoveEnd=function(a){if(this.noMoveEnd)return void(this.noMoveEnd=!1);var b=this.map,c=this.getOffset(),d=b.getPixelOrigin();this.offset=c,sa.setPosition(-c.x,-c.y),m({x:0,y:0}),n({width:b._size.x,height:b._size.y}),l({x:d.x-c.x,y:d.y-c.y}),p(a)},ya.onZoomStart=function(a){q(a)},ya.onZoom=function(a){var b=this.map.latLngToContainerPoint(a.center),c=Math.pow(2,a.zoom-I),d=$/2-b.x,e=_/2-b.y,f=$/2,g=_/2;a.zoom>I?(f-=d*c,g-=e*c):(f+=d,g+=e),sa.container.classList.add("zoom-animation"),sa.container.style.transformOrigin=f+"px "+g+"px",sa.container.style.transform="translate3d(0, 0, 0) scale("+c+")"},ya.onZoomEnd=function(a){sa.clear(),sa.container.classList.remove("zoom-animation"),sa.container.style.transform="translate3d(0, 0, 0) scale(1)";var b=this.map,c=this.getOffset(),d=b.getPixelOrigin();l({x:d.x-c.x,y:d.y-c.y}),r({zoom:b._zoom}),this.noMoveEnd=!0},ya.onResize=function(){},ya.onViewReset=function(){var a=this.getOffset();this.offset=a,sa.setPosition(-a.x,-a.y),m({x:0,y:0})},ya.onClick=function(a){var b=wa.getIdFromXY(a.containerPoint.x,a.containerPoint.y);b&&Aa({feature:b,lat:a.latlng.lat,lon:a.latlng.lng})},ya.getOffset=function(){return L.DomUtil.getPosition(this.map._mapPane)},ya.style=function(a){a=a||{};var b;return(b=a.color||a.wallColor)&&(ea=H.parse(b),ha=""+ea,fa=ea.lightness(.8),ia=""+fa,ga=ea.lightness(1.2),ja=""+ga),a.roofColor&&(ga=H.parse(a.roofColor),ja=""+ga),sa.render(),this},ya.date=function(a){return va.date=a,va.render(),this},ya.load=function(a){return oa.load(a),this},ya.set=function(a){return oa.set(a),this};var za=function(){};ya.each=function(a){return za=function(b){return a(b)},this};var Aa=function(){};ya.click=function(a){return Aa=function(b){return a(b)},this},xa.VERSION=S,xa.ATTRIBUTION=T,a.OSMBuildings=xa}(this);