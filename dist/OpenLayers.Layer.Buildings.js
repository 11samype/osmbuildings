var OSMBuildings=function(){function d(a,b){var f=a[0]-b[0],c=a[1]-b[1];return f*f+c*c}function G(a){for(var b=0,f=0,c=0,h=a.length-3;c<h;c+=2)b+=a[c],f+=a[c+1];a=(a.length-2)/2;return[b/a<<0,f/a<<0]}function u(a,b){var f,c,h,d,j=0,l,m;l=0;for(m=a.length-3;l<m;l+=2)f=a[l],c=a[l+1],h=a[l+2],d=a[l+3],j+=f*d-h*c;if((0<j/2?"CW":"CCW")===b)return a;f=[];for(c=a.length-2;0<=c;c-=2)f.push(a[c],a[c+1]);return f}var V=V||Array,Aa=Aa||Array,j=Math,Ja=j.exp,Ka=j.log,La=j.sin,Ma=j.cos,ta=j.tan,Na=j.atan,na=j.min,
ua=j.max,Ba=j.ceil,Ca=j.floor,Da=document,P,$=function(a){var b,f,c;if(0===a.s)b=f=c=a.l;else{c=0.5>a.l?a.l*(1+a.s):a.l+a.s-a.l*a.s;var h=2*a.l-c;a.h/=360;b=Q(h,c,a.h+1/3);f=Q(h,c,a.h);c=Q(h,c,a.h-1/3)}return new D(255*b<<0,255*f<<0,255*c<<0,a.a)},Q=function(a,b,f){0>f&&(f+=1);1<f&&(f-=1);return f<1/6?a+6*(b-a)*f:0.5>f?b:f<2/3?a+6*(b-a)*(2/3-f):a},D=function(a,b,f,c){this.r=a;this.g=b;this.b=f;this.a=4>arguments.length?1:c},j=D.prototype;j.toString=function(){return"rgba("+[this.r<<0,this.g<<0,this.b<<
0,this.a.toFixed(2)].join()+")"};j.setLightness=function(a){var b=D.toHSLA(this);b.l*=a;b.l=Math.min(1,Math.max(0,b.l));return $(b)};j.setAlpha=function(a){return new D(this.r,this.g,this.b,this.a*a)};D.parse=function(a){var b;a+="";if(~a.indexOf("#")&&(b=a.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/)))return new D(parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16),b[4]?parseInt(b[4],16)/255:1);if(b=a.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new D(parseInt(b[1],10),parseInt(b[2],
10),parseInt(b[3],10),b[4]?parseFloat(b[5]):1);if(b=a.match(/hsla?\(([\d.]+)\D+([\d.]+)\D+([\d.]+)(\D+([\d.]+))?\)/))return $({h:parseInt(b[1],10),s:parseFloat(b[2]),l:parseFloat(b[3]),a:b[4]?parseFloat(b[5]):1})};D.toHSLA=function(a){var b=a.r/255,f=a.g/255,c=a.b/255,h=Math.max(b,f,c),d=Math.min(b,f,c),j,l=(h+d)/2,m;if(h===d)j=d=0;else{m=h-d;d=0.5<l?m/(2-h-d):m/(h+d);switch(h){case b:j=(f-c)/m+(f<c?6:0);break;case f:j=(c-b)/m+2;break;case c:j=(b-f)/m+4}j/=6}return{h:360*j,s:d,l:l,a:a.a}};P=D;var Ea,
j=Math,R=j.PI,n=j.sin,v=j.cos,aa=j.tan,ba=j.asin,ca=j.atan2,w=R/180,K=23.4397*w;Ea=function(a,b,f){f=w*-f;b*=w;a=a.valueOf()/864E5-0.5+2440588-2451545;var c=w*(357.5291+0.98560028*a),h=w*(1.9148*n(c)+0.02*n(2*c)+3E-4*n(3*c)),h=c+h+102.9372*w+R,c=ba(n(0)*v(K)+v(0)*n(K)*n(h)),h=ca(n(h)*v(K)-aa(0)*n(K),v(h));f=w*(280.16+360.9856235*a)-f-h;return{altitude:ba(n(b)*n(c)+v(b)*v(c)*v(f)),azimuth:ca(n(f),v(f)*n(b)-aa(c)*v(b))-R/2}};var Fa,L=function(a){var b=parseFloat(a);return~a.indexOf("m")?b<<0:~a.indexOf("yd")?
b*Oa<<0:~a.indexOf("ft")?b*da<<0:~a.indexOf("'")?(a=a.split("'"),a[0]*da+a[1]*Pa<<0):b<<0},H=function(a){a=a.toLowerCase();return"#"===a[0]?a:Qa[Ra[a]||a]||null},ea=function(a){return(a=a.tags)&&!a.landuse&&(a.building||a["building:part"])&&(!a.layer||0<=a.layer)},T=function(a){if(a){for(var b=[],f,c=0,h=a.length;c<h;c++)f=S[a[c]],b.push(f[0],f[1]);b[b.length-2]!==b[0]&&b[b.length-1]!==b[1]&&b.push(b[0],b[1]);if(!(8>b.length))return b}},fa=function(a){var b=0,f=0;a.height&&(b=L(a.height));!b&&a["building:height"]&&
(b=L(a["building:height"]));!b&&a.levels&&(b=a.levels*M<<0);!b&&a["building:levels"]&&(b=a["building:levels"]*M<<0);a.min_height&&(f=L(a.min_height));!f&&a["building:min_height"]&&(f=L(a["building:min_height"]));!f&&a.min_level&&(f=a.min_level*M<<0);!f&&a["building:min_level"]&&(f=a["building:min_level"]*M<<0);var c,h;a["building:material"]&&(c=H(a["building:material"]));a["building:facade:material"]&&(c=H(a["building:facade:material"]));a["building:cladding"]&&(c=H(a["building:cladding"]));a["building:color"]&&
(c=a["building:color"]);a["building:colour"]&&(c=a["building:colour"]);a["roof:material"]&&(h=H(a["roof:material"]));a["building:roof:material"]&&(h=H(a["building:roof:material"]));a["roof:color"]&&(h=a["roof:color"]);a["roof:colour"]&&(h=a["roof:colour"]);a["building:roof:color"]&&(h=a["building:roof:color"]);a["building:roof:colour"]&&(h=a["building:roof:colour"]);return{height:b,minHeight:f,wallColor:c,roofColor:h}},Ga=function(a,b,f,c){a={id:a,footprint:u(f,"CW"),holes:c};b.height&&(a.height=
b.height);b.minHeight&&(a.minHeight=b.minHeight);b.wallColor&&(a.wallColor=b.wallColor);b.roofColor&&(a.roofColor=b.roofColor);c&&(a.holes=c);W.push(a)},Oa=0.9144,da=0.3048,Pa=0.0254,M=3,Ra={asphalt:"tar_paper",bitumen:"tar_paper",block:"stone",bricks:"brick",glas:"glass",glassfront:"glass",grass:"plants",masonry:"stone",granite:"stone",panels:"panel",paving_stones:"stone",plastered:"plaster",rooftiles:"roof_tiles",roofingfelt:"tar_paper",sandstone:"stone",sheet:"canvas",sheets:"canvas",shingle:"tar_paper",
shingles:"tar_paper",slates:"slate",steel:"metal",tar:"tar_paper",tent:"canvas",thatch:"plants",tile:"roof_tiles",tiles:"roof_tiles"},Qa={brick:"#cc7755",bronze:"#ffeecc",canvas:"#fff8f0",concrete:"#999999",copper:"#a0e0d0",glass:"#e8f8f8",gold:"#ffcc00",plants:"#009933",metal:"#aaaaaa",panel:"#fff8f0",plaster:"#999999",roof_tiles:"#f08060",silver:"#cccccc",slate:"#666666",stone:"#996666",tar_paper:"#333333",wood:"#deb887"},S,N,W;Fa=function(a){S={};N={};W=[];for(var b,f=0,c=a.length;f<c;f++)switch(b=
a[f],b.type){case "node":S[b.id]=[b.lat,b.lon];break;case "way":var h=void 0,d=void 0;if(ea(b))h=fa(b.tags),(d=T(b.nodes))&&Ga(b.id,h,d);else if(h=b.tags,!h||!h.highway&&!h.railway&&!h.landuse)N[b.id]=b;break;case "relation":var d=b,j=void 0,l=void 0;b=[];var m=void 0,t=void 0,h=void 0;if(ea(d)&&("multipolygon"===d.tags.type||"building"===d.tags.type)){for(var j=d.members,t=l=void 0,m=[],z=0,n=j.length;z<n;z++)l=j[z],"way"===l.type&&N[l.ref]&&(!l.role||"outer"===l.role?t=N[l.ref]:("inner"===l.role||
"enclave"===l.role)&&m.push(N[l.ref]));j=t&&t.tags?{outer:t,inner:m}:void 0;if(j&&(z=fa(d.tags),l=j.outer))if(m=fa(l.tags),t=T(l.nodes)){d=m;m=z;z=void 0;for(z in m)d[z]||(d[z]=m[z]);m=d;d=0;for(z=j.inner.length;d<z;d++)(h=T(j.inner[d].nodes))&&b.push(u(h,"CCW"));Ga(l.id,m,t,b.length?b:null)}}}return W};var ga=Math.PI,Ha=ga/2,Sa=ga/4,Ta=180/ga,Ua=256,Va="latitude",Wa="longitude",j=function(){function a(B,a){var e={};B/=w;a/=w;e[Va]=0>=a?90:1<=a?-90:Ta*(2*Na(Ja(ga*(1-2*a)))-Ha);e[Wa]=360*(1===B?1:
(B%1+1)%1)-180;return e}function b(B,a,e){function b(a){if("XDomainRequest"in window&&a!==g.readyState&&(g.readyState=a,g.onreadystatechange))g.onreadystatechange()}B=B.replace(/\{ *([\w_]+) *\}/g,function(B,e){return a[e]||B});var g="XDomainRequest"in window?new XDomainRequest:new XMLHttpRequest;g.onerror=function(){g.status=500;g.statusText="Error";b(4)};g.ontimeout=function(){g.status=408;g.statusText="Timeout";b(4)};g.onprogress=function(){b(3)};g.onload=function(){g.status=200;g.statusText="Ok";
b(4)};g.onreadystatechange=function(){4===g.readyState&&g.status&&!(200>g.status||299<g.status)&&e&&g.responseText&&e(JSON.parse(g.responseText))};b(0);g.open("GET",B);b(1);g.send(null);b(2);return g}function f(){ha.render();oa.render();c()}function c(){C.clearRect(0,0,m,t);if(!(v<M||ia)){var a,b,e,f,g,k,c,Xa=oa.MAX_HEIGHT,Ia=[ja+E,ka+F],l=E,p=E+m,q=F,Ya=F+t,s,va,x,y;A.renderItems.sort(function(a,B){return d(B.center,Ia)/B.height-d(a.center,Ia)/a.height});a=0;for(b=A.renderItems.length;a<b;a++)if(g=
A.renderItems[a],!(g.height<=Xa)){k=!1;s=g.footprint;e=0;for(f=s.length-1;e<f;e+=2)k||(k=s[e]>l&&s[e]<p&&s[e+1]>q&&s[e+1]<Ya);if(k){e=1>g.scale?g.height*g.scale:g.height;k=X/(X-e);c=0;g.minHeight&&(e=1>g.scale?g.minHeight*g.scale:g.minHeight,c=X/(X-e));x=g.wallColor||N;y=g.altColor||K;s=h(s,k,c,x,y);va=[];if(g.holes){e=0;for(f=g.holes.length;e<f;e++)va[e]=h(g.holes[e],k,c,x,y)}C.fillStyle=g.roofColor||la;C.strokeStyle=y;j(s,!0,va)}}}}function h(a,b,e,f,g){for(var k={x:0,y:0},c={x:0,y:0},d,h,m=[],
p=0,q=a.length-3;p<q;p+=2)k.x=a[p]-E,k.y=a[p+1]-F,c.x=a[p+2]-E,c.y=a[p+3]-F,d=n(k.x,k.y,b),h=n(c.x,c.y,b),e&&(k=n(k.x,k.y,e),c=n(c.x,c.y,e)),(c.x-k.x)*(d.y-k.y)>(d.x-k.x)*(c.y-k.y)&&(C.fillStyle=k.x<c.x&&k.y<c.y||k.x>c.x&&k.y>c.y?g:f,j([c.x,c.y,k.x,k.y,d.x,d.y,h.x,h.y])),m[p]=d.x,m[p+1]=d.y;return m}function j(a,b,e){if(a.length){var c,g,k,f;C.beginPath();C.moveTo(a[0],a[1]);c=2;for(g=a.length;c<g;c+=2)C.lineTo(a[c],a[c+1]);if(e){c=0;for(g=e.length;c<g;c++){a=e[c];C.moveTo(a[0],a[1]);k=2;for(f=a.length;k<
f;k+=2)C.lineTo(a[k],a[k+1])}}C.closePath();b&&C.stroke();C.fill()}}function n(a,b,e){return{x:(a-ja)*e+ja<<0,y:(b-ka)*e+ka<<0}}function l(a){v=a;w=Ua<<v;a=v;var b=M,e=Q;a=na(ua(a,b),e);I=1-na(ua(0+0.3*((a-b)/(e-b)),0),0.3);N=O.setAlpha(I)+"";K=H.setAlpha(I)+"";la=Y.setAlpha(I)+""}var m=0,t=0,z=0,D=0,E=0,F=0,v,w,C,O=new P(200,190,180),H=O.setLightness(0.8),Y=O.setLightness(1.2),N=O+"",K=H+"",la=Y+"",L,I=1,M=15,Q=20,R,ja,ka,X,ia,S=new Date,Z={},T={add:function(a,b){Z[a]={data:b,time:Date.now()}},get:function(a){return Z[a]&&
Z[a].data},purge:function(){S.setMinutes(S.getMinutes()-5);for(var a in Z)Z[a].time<S&&delete Z[a]}},A,fa=function(a){return function(b){W(b,a)}},W=function(a,b){if(a){var e;if("FeatureCollection"===a.type){e=a.features;var c,g,k,f,d,h,j=[],p,q,m,s,l,x,y,r;c=0;for(g=e.length;c<g;c++)if(p=e[c],"Feature"===p.type&&(q=p.geometry,p=p.properties,"LineString"===q.type&&(x=m.length-1,m[0][0]===m[x][0]&&m[0][1]===m[x][1]&&(m=q.coordinates)),"Polygon"===q.type&&(m=q.coordinates),"MultiPolygon"===q.type&&(m=
q.coordinates[0]),m)){if(p.color||p.wallColor)s=p.color||p.wallColor;p.roofColor&&(l=p.roofColor);q=m[0];r=[];y=p.height;k=x=0;for(f=q.length;k<f;k++)r.push(q[k][1],q[k][0]),x+=y||q[k][2]||0;y=[];k=1;for(f=m.length;k<f;k++){q=m[c];y[k-1]=[];d=0;for(h=q.length;d<h;d++)y[k-1].push(q[d][1],q[d][0])}k={id:p.id||r[0]+","+r[1],footprint:u(r,"CW")};x&&(k.height=x/q.length<<0);p.minHeight&&(k.minHeight=p.minHeight);s&&(k.wallColor=s);l&&(k.roofColor=l);y.length&&(k.holes=y);j.push(k)}e=j}else a.osm3s&&(e=
Fa(a.elements));b&&T.add(b,e);aa(e,!0)}},$=function(a){for(var b,e,c=new V(a.length),g=0,k=a.length-1;g<k;g+=2)b=a[g+1],e=na(1,ua(0,0.5-Ka(ta(Sa+Ha*a[g]/180))/ga/2)),b=(b/360+0.5)*w<<0,e=e*w<<0,c[g]=b,c[g+1]=e;a=c;c=a.length/2;g=new Aa(c);k=0;b=c-1;var f,d,h,j=[],m=[],q=[];for(g[k]=g[b]=1;b;){f=0;for(e=k+1;e<b;e++){d=a[2*e];var l=a[2*e+1],s=a[2*k],r=a[2*k+1],x=a[2*b],y=a[2*b+1],t=x-s,n=y-r,v=void 0;if(0!==t||0!==n)v=((d-s)*t+(l-r)*n)/(t*t+n*n),1<v?(s=x,r=y):0<v&&(s+=t*v,r+=n*v);t=d-s;n=l-r;d=t*t+
n*n;d>f&&(h=e,f=d)}2<f&&(g[h]=1,j.push(k),m.push(h),j.push(h),m.push(b));k=j.pop();b=m.pop()}for(e=0;e<c;e++)g[e]&&q.push(a[2*e],a[2*e+1]);c=q;if(!(8>c.length))return c},aa=function(a,b){var e,c,g,k,d=[],h,j,m,p,q,l,s,r,t=Q-v;e=0;for(c=a.length;e<c;e++)if(h=a[e],j=3*(h.height||15)>>t)if(m=3*h.minHeight>>t,!(m>R)&&(p=$(h.footprint))){s=[];if(h.holes){g=0;for(k=h.holes.length;g<k;g++)(r=$(h.holes[g]))&&s.push(r)}k=g=null;if(h.wallColor&&(q=P.parse(h.wallColor)))g=q.setAlpha(I),k=""+g.setLightness(0.8),
g=""+g;l=null;if(h.roofColor&&(q=P.parse(h.roofColor)))l=""+q.setAlpha(I);d.push({id:h.id,footprint:p,height:na(j,R),minHeight:m,wallColor:g,altColor:k,roofColor:l,center:G(p),holes:s.length?s:null})}c=0;for(h=d.length;c<h;c++)e=d[c],pa[e.id]||(e.scale=b?0:1,ma.renderItems.push(d[c]),pa[e.id]=1);L||(L=setInterval(function(){for(var a,b=!1,e=0,c=A.renderItems.length;e<c;e++)a=A.renderItems[e],1>a.scale&&(a.scale+=0.1,1<a.scale&&(a.scale=1),b=!0);f();b||(clearInterval(L),L=null)},33))},wa,pa={},ma=
{renderItems:[],load:function(a){wa=a||"http://overpass-api.de/api/interpreter?data=[out:json];(way[%22building%22]({s},{w},{n},{e});node(w);way[%22building:part%22=%22yes%22]({s},{w},{n},{e});node(w);relation[%22building%22]({s},{w},{n},{e});way(r);node(w););out;";ma.update()},update:function(){if(wa&&!(15>v)){var c=a(E,F),f=a(E+m,F+t),e=0.0075*Ba(c.latitude/0.0075),d=0.015*Ba(f.longitude/0.015),f=0.0075*Ca(f.latitude/0.0075),c=0.015*Ca(c.longitude/0.015);T.purge();ma.renderItems=[];pa={};for(var g,
k,h;f<=e;f+=0.0075)for(g=c;g<=d;g+=0.015)h=f+","+g,(k=T.get(h))?aa(k):b(wa,{n:(1E4*(f+0.0075)<<0)/1E4,e:(1E4*(g+0.015)<<0)/1E4,s:(1E4*f<<0)/1E4,w:(1E4*g<<0)/1E4},fa(h))}},set:function(a){ma.renderItems=[];pa={};W(a)}};A=ma;var ha,ra=function(a,b,e){return{x:a+qa.x*e,y:b+qa.y*e}},r,ba=!0,ca=new P(0,0,0),da=null,qa={x:0,y:0},xa={setContext:function(a){r=a;xa.setDate((new Date).setHours(10))},enable:function(a){ba=!!a},render:function(){var b,c,e,f;r.clearRect(0,0,m,t);if(ba&&!(v<M||ia))if(b=a(E+z,F+
D),b=Ea(da,b.latitude,b.longitude),!(0>=b.altitude)){c=1/ta(b.altitude);e=0.4/c;qa.x=Ma(b.azimuth)*c;qa.y=La(b.azimuth)*c;ca.a=e;f=ca+"";var g,d,h,j,l,n,p,q,u,s,w,x,y=[];r.beginPath();b=0;for(c=A.renderItems.length;b<c;b++){d=A.renderItems[b];q=!1;h=d.footprint;p=[];e=0;for(g=h.length-1;e<g;e+=2)p[e]=l=h[e]-E,p[e+1]=n=h[e+1]-F,q||(q=0<l&&l<m&&0<n&&n<t);if(q){h=1>d.scale?d.height*d.scale:d.height;d.minHeight&&(j=1>d.scale?d.minHeight*d.scale:d.minHeight);l=null;e=0;for(g=p.length-3;e<g;e+=2)n=p[e],
u=p[e+1],q=p[e+2],s=p[e+3],w=ra(n,u,h),x=ra(q,s,h),d.minHeight&&(u=ra(n,u,j),s=ra(q,s,j),n=u.x,u=u.y,q=s.x,s=s.y),(q-n)*(w.y-u)>(w.x-n)*(s-u)?(1===l&&r.lineTo(n,u),l=0,e||r.moveTo(n,u),r.lineTo(q,s)):(0===l&&r.lineTo(w.x,w.y),l=1,e||r.moveTo(w.x,w.y),r.lineTo(x.x,x.y));r.closePath();y.push(p)}}r.fillStyle=f;r.fill();r.globalCompositeOperation="destination-out";r.beginPath();b=0;for(c=y.length;b<c;b++){j=y[b];r.moveTo(j[0],j[1]);e=2;for(g=j.length;e<g;e+=2)r.lineTo(j[e],j[e+1]);r.lineTo(j[0],j[1]);
r.closePath()}r.fillStyle="#00ff00";r.fill();r.globalCompositeOperation="source-over"}},setDate:function(a){da=a;xa.render()}};ha=xa;var oa,J,ea={MAX_HEIGHT:8,setContext:function(a){J=a},render:function(){J.clearRect(0,0,m,t);if(!(v<M||ia)){var a,b,c,f,d,h,j,l,n;J.beginPath();a=0;for(b=A.renderItems.length;a<b;a++)if(c=A.renderItems[a],!(c.height>ea.MAX_HEIGHT)){n=!1;d=c.footprint;l=[];c=0;for(f=d.length-1;c<f;c+=2)l[c]=h=d[c]-E,l[c+1]=j=d[c+1]-F,n||(n=0<h&&h<m&&0<j&&j<t);if(n){c=0;for(f=l.length-
3;c<f;c+=2)n=l[c],d=l[c+1],c?J.lineTo(n,d):J.moveTo(n,d);J.closePath()}}J.fillStyle=la;J.strokeStyle=K;J.stroke();J.fill()}}};oa=ea;var ya,za=function(){var a=Da.createElement("CANVAS");a.style.webkitTransform="translate3d(0,0,0)";a.style.imageRendering="optimizeSpeed";a.style.position="absolute";a.style.left=0;a.style.top=0;var b=a.getContext("2d");b.lineCap="round";b.lineJoin="round";b.lineWidth=1;b.mozImageSmoothingEnabled=!1;b.webkitImageSmoothingEnabled=!1;sa.push(a);U.appendChild(a);return b},
U=Da.createElement("DIV");U.style.pointerEvents="none";U.style.position="absolute";U.style.left=0;U.style.top=0;var sa=[];ha.setContext(za());oa.setContext(za());C=za();ya={appendTo:function(a){a.appendChild(U);return U},setSize:function(a,b){for(var c=0,d=sa.length;c<d;c++)sa[c].width=a,sa[c].height=b}};this.setStyle=function(a){a=a||{};if(a.color||a.wallColor)O=P.parse(a.color||a.wallColor),N=O.setAlpha(I)+"",H=O.setLightness(0.8),K=H.setAlpha(I)+"",Y=O.setLightness(1.2),la=Y.setAlpha(I)+"";a.roofColor&&
(Y=P.parse(a.roofColor),la=Y.setAlpha(I)+"");void 0!==a.shadows&&ha.enable(a.shadows);f()};this.setCamOffset=function(a,b){ja=z+a;ka=t+b};this.setMaxZoom=function(a){Q=a};this.setDate=function(a){ha.setDate(a)};this.appendTo=function(a){return ya.appendTo(a)};this.loadData=function(a){A.load(a)};this.setData=function(a){A.set(a)};this.onMoveEnd=function(){f();A.update()};this.onZoomEnd=function(a){ia=!1;l(a.zoom);A.update();f()};this.onZoomStart=function(){ia=!0;f()};this.setOrigin=function(a,b){E=
a;F=b};this.setSize=function(a,b){m=a;t=b;z=m/2<<0;D=t/2<<0;ja=z;ka=t;X=m/(1.5/(window.devicePixelRatio||1))/ta(45)<<0;ya.setSize(m,t);R=X-50};this.setZoom=l;this.render=c};j.VERSION="0.1.8a";j.ATTRIBUTION='&copy; <a href="http://osmbuildings.org">OSM Buildings</a>';return j}();
OpenLayers.Layer.Buildings=OpenLayers.Class(OpenLayers.Layer,{CLASS_NAME:"OpenLayers.Layer.Buildings",name:"OSM Buildings",attribution:OSMBuildings.ATTRIBUTION,isBaseLayer:!1,alwaysInRange:!0,dxSum:0,dySum:0,initialize:function(d){d=d||{};d.projection="EPSG:900913";OpenLayers.Layer.prototype.initialize.call(this,this.name,d)},setOrigin:function(){var d=this.map.getLonLatFromPixel(new OpenLayers.Pixel(0,0)),G=this.map.resolution,u=this.maxExtent,V=Math.round((d.lon-u.left)/G),d=Math.round((u.top-d.lat)/
G);this.osmb.setOrigin(V,d)},setMap:function(d){this.map||OpenLayers.Layer.prototype.setMap.call(this,d);this.osmb||(this.osmb=new OSMBuildings,this.container=this.osmb.appendTo(this.div));this.osmb.setSize(this.map.size.w,this.map.size.h);this.osmb.setZoom(this.map.zoom);this.setOrigin()},removeMap:function(d){this.container.parentNode.removeChild(this.container);OpenLayers.Layer.prototype.removeMap.call(this,d)},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.call(this);this.osmb.onResize({width:this.map.size.w,
height:this.map.size.h})},moveTo:function(d,G,u){d=OpenLayers.Layer.prototype.moveTo.call(this,d,G,u);if(!u){u=parseInt(this.map.layerContainerDiv.style.left,10);var V=parseInt(this.map.layerContainerDiv.style.top,10);this.div.style.left=-u+"px";this.div.style.top=-V+"px"}this.setOrigin();this.dySum=this.dxSum=0;this.osmb.setCamOffset(this.dxSum,this.dySum);if(G)this.osmb.onZoomEnd({zoom:this.map.zoom});else this.osmb.onMoveEnd();return d},moveByPx:function(d,G){this.dxSum+=d;this.dySum+=G;var u=
OpenLayers.Layer.prototype.moveByPx.call(this,d,G);this.osmb.setCamOffset(this.dxSum,this.dySum);this.osmb.render();return u},setStyle:function(d){this.osmb.setStyle(d);return this},setDate:function(d){this.osmb.setDate(d);return this},load:function(d){this.osmb.loadData(d);return this},geoJSON:function(d){this.osmb.setData(d);return this}});
