(function(fa){var V=Math.PI,Aa=V/2,Fa=V/4,Ga=180/V,Ha=256,ka=14,la=400,Ba=la-50,W="latitude",X="longitude",J=0,I=1,z=2,ga=3,Ca=Ca||Array,Ia=Math.exp,Ja=Math.log,Ka=Math.tan,La=Math.atan,ma=Math.min,Ma=Math.max,na=fa.document,w=function(){function Y(g,h,k){if(k<0)k+=1;if(k>1)k-=1;if(k<1/6)return g+(h-g)*6*k;if(k<0.5)return h;if(k<2/3)return g+(h-g)*(2/3-k)*6;return g}function E(g,h,k,l){this.r=g;this.g=h;this.b=k;this.a=arguments.length<4?1:l}var Z=E.prototype;Z.toString=function(){return"rgba("+[this.r,
this.g,this.b,this.a.toFixed(2)].join(",")+")"};Z.adjustLightness=function(g){var h=w.toHSLA(this);h.l*=g;h.l=Math.min(1,Math.max(0,h.l));var k,l;if(h.s===0)g=k=l=h.l;else{l=h.l<0.5?h.l*(1+h.s):h.l+h.s-h.l*h.s;var v=2*h.l-l;g=Y(v,l,h.h+1/3);k=Y(v,l,h.h);l=Y(v,l,h.h-1/3)}return new w(~~(g*255),~~(k*255),~~(l*255),h.a)};Z.adjustAlpha=function(g){return new w(this.r,this.g,this.b,this.a*g)};E.parse=function(g){if(~g.indexOf("#")){g=g.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new w(parseInt(g[1],
16),parseInt(g[2],16),parseInt(g[3],16),g[4]?parseInt(g[4],16)/255:1)}if(g=g.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new w(parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10),g[4]?parseFloat(g[5],10):1)};E.toHSLA=function(g){var h=g.r/255,k=g.g/255,l=g.b/255,v=Math.max(h,k,l),x=Math.min(h,k,l),A,$=(v+x)/2,B;if(v===x)A=x=0;else{B=v-x;x=$>0.5?B/(2-v-x):B/(v+x);switch(v){case h:A=(k-l)/B+(k<l?6:0);break;case k:A=(l-h)/B+2;break;case l:A=(h-k)/B+4;break}A/=6}return{h:A,s:x,l:$,
a:g.a}};return E}();fa.OSMBuildings=function(){function Y(a){q=na.createElement("canvas");q.style.webkitTransform="translate3d(0,0,0)";q.style.position="absolute";q.style.pointerEvents="none";q.style.left=0;q.style.top=0;q.style.imageRendering="optimizeSpeed";a.appendChild(q);s=q.getContext("2d");s.lineCap="round";s.lineJoin="round";s.lineWidth=1;try{s.mozImageSmoothingEnabled=false}catch(e){}}function E(a,e){var b={};a/=aa;e/=aa;b[W]=e<=0?90:e>=1?-90:Ga*(2*La(Ia(V*(1-2*e)))-Aa);b[X]=(a===1?1:(a%
1+1)%1)*360-180;return b}function Z(a,e){return a.replace(/\{ *([\w_]+) *\}/g,function(b,d){return e[d]||""})}function g(a,e){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===4)!b.status||b.status<200||b.status>299||b.responseText&&e(JSON.parse(b.responseText))};b.open("GET",a);b.send(null);return b}function h(){if(!(!oa||y<ka)){var a=E(Q-R,S-pa),e=E(Q+K+R,S+C+pa);ha&&ha.abort();ha=g(Z(oa,{w:a[X],n:a[W],e:e[X],s:e[W],z:y}),k)}}function k(a){var e,b,d,c=[],f=0,i=0;ba=ka;ia(y);
ha=null;if(!(!a||a.meta.z!==y)){d=a.meta;b=a.data;if(u&&n&&u.z===d.z){f=u.x-d.x;i=u.y-d.y;a=0;for(e=n.length;a<e;a++)c[a]=n[a][I][0]+f+","+(n[a][I][1]+i)}u=d;n=[];a=0;for(e=b.length;a<e;a++){n[a]=b[a];n[a][J]=ma(n[a][J],Ba);d=n[a][I][0]+","+n[a][I][1];n[a][ga]=!(c&&~c.indexOf(d))}Da()}}function l(a,e){var b=[],d,c,f,i,j,r,p,o,t=qa-y;d=0;for(c=a.length;d<c;d++){j=a[d];r=j[I];p=new Ca(r.length);f=0;for(i=r.length-1;f<i;f+=2){o=r[f+1];var F=ma(1,Ma(0,0.5-Ja(Ka(Fa+Aa*r[f]/180))/V/2));o={x:~~((o/360+0.5)*
aa),y:~~(F*aa)};p[f]=o.x;p[f+1]=o.y}b[d]=[];b[d][J]=ma(j[J]>>t,Ba);b[d][I]=p;b[d][z]=j[z];b[d][ga]=e}return b}function v(a,e){if(typeof a==="object")A(a,!e);else{var b=na.documentElement,d=na.createElement("script");fa.jsonpCallback=function(c){delete fa.jsonpCallback;b.removeChild(d);A(c,!e)};b.insertBefore(d,b.lastChild).src=a.replace(/\{callback\}/,"jsonpCallback")}}function x(a,e,b){if(b===undefined)b=[];var d,c,f,i=a[0]?a:a.features,j,r,p,o,t,F=e?1:0,T=e?0:1;if(i){d=0;for(a=i.length;d<a;d++)x(i[d],
e,b);return b}if(a.type==="Feature"){c=a.geometry;d=a.properties}if(c.type==="Polygon")j=[c.coordinates];if(c.type==="MultiPolygon")j=c.coordinates;if(j){e=d.height;if(d.color||d.wallColor)o=w.parse(d.color||d.wallColor);if(d.roofColor)t=w.parse(d.roofColor);d=0;for(a=j.length;d<a;d++){r=j[d][0];i=[];c=p=0;for(f=r.length;c<f;c++){i.push(r[c][F],r[c][T]);p+=e||r[c][2]||0}if(p){c=[];c[J]=~~(p/r.length);r=I;p=void 0;f=void 0;var M=void 0,D=void 0,U=0,G=void 0,ca=void 0;G=0;for(ca=i.length-3;G<ca;G+=
2){p=i[G];f=i[G+1];M=i[G+2];D=i[G+3];U+=p*D-M*f}if((U/2>0?"CW":"CCW")==="CW")i=i;else{p=[];for(f=i.length-2;f>=0;f-=2)p.push(i[f],i[f+1]);i=p}c[r]=i;if(o||t)c[z]=[o,t];b.push(c)}}}return b}function A(a,e){if(a){da=x(a,e);ba=0;ia(y);u={n:90,w:-180,s:-90,e:180,x:0,y:0,z:y};n=l(da,true);Da()}else{da=null;H()}}function $(a,e){K=a;C=e;R=~~(K/2);pa=~~(C/2);N=R;O=C;q.width=K;q.height=C}function B(a,e){Q=a;S=e}function ia(a){y=a;aa=Ha<<y;P=1-(y-ba)*0.3/(qa-ba)}function Ea(){ra=true;H()}function Da(){ea=0;
clearInterval(sa);sa=setInterval(function(){ea+=0.1;if(ea>1){clearInterval(sa);ea=1;for(var a=0,e=n.length;a<e;a++)n[a][ga]=0}H()},33)}function H(){s.clearRect(0,0,K,C);if(u&&n)if(!(y<ba||ra)){var a,e,b,d,c,f,i,j,r=Q-u.x,p=S-u.y,o,t,F,T,M,D,U,G=ta.adjustAlpha(P)+"",ca=(ua||ta.adjustLightness(1.2)).adjustAlpha(P)+"";if(ja)s.strokeStyle=Na.adjustAlpha(P)+"";a=0;for(e=n.length;a<e;a++){c=n[a];t=false;f=c[I];o=[];b=0;for(d=f.length-1;b<d;b+=2){o[b]=i=f[b]-r;o[b+1]=j=f[b+1]-p;t||(t=i>0&&i<K&&j>0&&j<C)}if(t){s.fillStyle=
c[z]&&c[z][0]?c[z][0].adjustAlpha(P)+"":G;b=c[ga]?c[J]*ea:c[J];f=la/(la-b);i=[];j=[];b=0;for(d=o.length-3;b<d;b+=2){t=o[b];F=o[b+1];T=o[b+2];M=o[b+3];D={x:~~((t-N)*f+N),y:~~((F-O)*f+O)};U={x:~~((T-N)*f+N),y:~~((M-O)*f+O)};if((T-t)*(D.y-F)>(D.x-t)*(M-F)){if(!j.length){j.unshift(F);j.unshift(t);j.push(D.x,D.y)}j.unshift(M);j.unshift(T);j.push(U.x,U.y)}else{va(j);j=[]}i[b]=D.x;i[b+1]=D.y}va(j);s.fillStyle=!c[z]?ca:c[z][1]?c[z][1].adjustAlpha(P)+"":ua?ca:c[z][0].adjustLightness(1.2).adjustAlpha(P)+"";
va(i,ja)}}}}function va(a,e){if(a.length){s.beginPath();s.moveTo(a[0],a[1]);for(var b=2,d=a.length;b<d;b+=2)s.lineTo(a[b],a[b+1]);s.closePath();e&&s.stroke();s.fill()}}var m=this,K=0,C=0,R=0,pa=0,Q=0,S=0,y,aa,ha,q,s,oa,ja,ta=new w(200,190,180),ua=null,Na=new w(145,140,135),da,u,n,P=1,ea=1,sa,ba=ka,qa=20,N,O,ra=false;m.VERSION="0.1.6a";m.render=function(){H();return m};m.setStyle=function(a){a=(a=a)||{};ja=a.strokeRoofs!==undefined?a.strokeRoofs:ja;if(a.color||a.wallColor)ta=w.parse(a.color||a.wallColor);
if(a.roofColor)ua=w.parse(a.roofColor);H();return m};m.setData=function(a,e){console.warn("OSMBuildings.loadData() is deprecated and will be removed soon.\nUse OSMBuildings.loadData({url|object}, isLatLon?) instead.");A(a,e);return m};m.loadData=function(a){oa=a;h();return m};m.geoJSON=function(a,e){v(a,e);return m};var wa,xa,ya,za;m.VERSION+="-leaflet";m.addTo=function(a){a.addLayer(m);return m};m.onAdd=function(a){m.map=a;Y(a._panes.overlayPane);qa=a._layersMaxZoom;$(a._size.x,a._size.y);var e=
a.getPixelOrigin();B(e.x,e.y);ia(a._zoom);var b=0,d=0;wa=function(){var c=L.DomUtil.getPosition(a._mapPane);N=R-(c.x-b);O=C-(c.y-d);H()};xa=function(){if(za)za=false;else{var c=L.DomUtil.getPosition(a._mapPane),f=a.getPixelOrigin();b=c.x;d=c.y;q.style.left=-c.x+"px";q.style.top=-c.y+"px";N=R;O=C;$(a._size.x,a._size.y);B(f.x-c.x,f.y-c.y);c=E(Q,S);f=E(Q+K,S+C);if(u&&(c[W]>u.n||c[X]<u.w||f[W]<u.s||f[X]>u.e))h();H()}};ya=function(){var c=L.DomUtil.getPosition(a._mapPane),f=a.getPixelOrigin();B(f.x-c.x,
f.y-c.y);c={zoom:a._zoom};ra=false;ia(c.zoom);if(da){n=l(da);H()}else h();za=true};a.on({move:wa,moveend:xa,zoomstart:Ea,zoomend:ya});if(a.options.zoomAnimation)q.className="leaflet-zoom-animated";a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');H()};m.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.off({move:wa,moveend:xa,zoomstart:Ea,zoomend:ya});q.parentNode.removeChild(q);
m.map=null};arguments.length&&m.addTo(arguments[0])}})(this);
