var Buildings=function(F){function V(a){g=F.document.createElement("canvas");g.style.webkitTransform="translate3d(0,0,0)";g.style.position="absolute";g.style.pointerEvents="none";g.style.left=0;g.style.top=0;a.appendChild(g);f=g.getContext("2d");f.lineWidth=1;f.lineCap="round";try{f.mozImageSmoothingEnabled=!1}catch(b){}}function s(a,b){var c={},a=a/G,b=b/G;c[k]=0>=b?90:1<=b?-90:W*(2*X(Y(H*(1-2*b)))-Z);c[p]=360*(1===a?1:(a%1+1)%1)-180;return c}function $(a,b){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,d){return b[d]||""})}function aa(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4!==c.readyState||!c.status||200>c.status||299<c.status||c.responseText&&b(JSON.parse(c.responseText))};c.open("GET",a);c.send(null);return c}function M(a){q=a.width;height=a.height;halfWidth=~~(q/2);halfHeight=~~(height/2);w=halfWidth;x=height;g.width=q;g.height=height}function N(a){t=a.x;centerY=a.y}function O(a){r=a.zoom;G=ba<<r;B=1-0.3*(r-C)/(P-C)}function ca(){isZooming=!0;l()}function u(){if(!(r<
C)){var a=s(t-q,centerY-height),b=s(t+q,centerY+height);m&&m.abort();m=aa($(Q,{w:a[p],n:a[k],e:b[p],s:b[k],z:r}),da)}}function da(a){var b,c,d,y=[],f=0,g=0;m=null;if(a&&a.meta.z==r){d=a.meta;c=a.data;if(j&&h&&j.z==d.z){f=j.x-d.x;g=j.y-d.y;a=0;for(b=h.length;a<b;a++)y[a]=h[a][1][0]+f+","+(h[a][1][1]+g)}j=d;h=[];a=0;for(b=c.length;a<b;a++)h[a]=c[a],h[a][0]=ea(h[a][0],fa),d=h[a][1][0]+","+h[a][1][1],y&&-1<~~y.indexOf(d)&&(h[a][2]=1);ga()}}function ga(){v=0;clearInterval(I);I=setInterval(function(){v+=
0.1;if(1<v){clearInterval(I);v=1;for(var a=0,b=h.length;a<b;a++)delete h[a][2]}l()},33)}function l(){var a,b,c,d;f.clearRect(0,0,q,height);if(!(r<C||isZooming)){var y=J(R,B),g=J(S,B),k=J(T,B);f.strokeStyle=k;var p,e,l,n,s=t-halfWidth-j.x,u=centerY-halfHeight-j.y,o,m,i,z,A,D,E,k=0;for(p=h.length;k<p;k++){a=h[k];n=!1;b=a[1];o=new Int32Array(b.length);e=0;for(l=b.length-1;e<l;e+=2)o[e]=c=b[e]-s,o[e+1]=d=b[e+1]-u,!n&&(n=0<c&&c<q&&0<d&&d<height);if(n){f.fillStyle=y;e=a[2]?a[0]:a[0]*v;n=K/(K-e);m=new Int32Array(o.length-
2);i=[];e=0;for(l=o.length-1-2;e<l;e+=2)z=o[e],A=o[e+1],D=o[e+2],E=o[e+3],c=~~((z-w)*n+w),d=~~((A-x)*n+x),a=~~((D-w)*n+w),b=~~((E-x)*n+x),(D-z)*(d-A)>(c-z)*(E-A)?(i.length||(i.unshift(A),i.unshift(z),i.push(c),i.push(d)),i.unshift(E),i.unshift(D),i.push(a),i.push(b)):(L(i),i=[]),m[e]=c,m[e+1]=d;L(i);f.fillStyle=g;L(m,U)}}}}function L(a,b){f.beginPath();f.moveTo(a[0],a[1]);for(var c=2,d=a.length;c<d;c+=2)f.lineTo(a[c],a[c+1]);f.closePath();b&&f.stroke();f.fill()}function J(a,b){var c=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);
return"rgba("+[c[1],c[2],c[3],c[4]?b*c[5]:b].join()+")"}F.Int32Array=F.Int32Array||Array;var Y=Math.exp,X=Math.atan,ea=Math.min,H=Math.PI,Z=H/2,W=180/H,k="latitude",p="longitude",q=height=halfWidth=halfHeight=0,t=centerY=0,r,G,m,g,f,Q,U,R,S,T,j,h,B=1,v=1,I,ba=256,C=14,P,w=halfWidth,x=height,K=400,fa=K-50;isZooming=!1;return{setMap:function(a,b){V(document.querySelector(".leaflet-control-container"));P=17;M({width:b._size.x,height:b._size.y});var c=b._size.divideBy(2);N(b._getTopLeftPoint().add(c));
O({zoom:b._zoom});var d;window.addEventListener("resize",function(){d=setTimeout(function(){clearTimeout(d);M({width:b._size.x,height:b._size.y});l();u()},100)},!1);b.on("move",function(){var a=b._size.divideBy(2),a=b._getTopLeftPoint().add(a);N(a);l()});b.on("moveend",function(){var a=b._size.divideBy(2);b._getTopLeftPoint().add(a);var a=s(t-halfWidth,centerY-halfHeight),c=s(t+halfWidth,centerY+halfHeight);j&&(a[k]>j.n||a[p]<j.w||c[k]<j.s||c[p]>j.e)&&u()});b.on("zoomstart",ca);b.on("zoomend",function(){var a=
{zoom:b._zoom};isZooming=!1;O(a);u()})},render:l,load:function(a,b){Q=a;U=!!b.strokeRoofs;R=b.wallColor||"rgb(200,190,180)";S=b.roofColor||"rgb(250,240,230)";T=b.strokeColor||"rgb(145,140,135)";u()}}}(this);
