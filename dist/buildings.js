var OSMBuildings=function(za){function ra(m,k){var f=m[0]-k[0],b=m[1]-k[1];return Aa(f*f+b*b)}function sa(m){var k,f,b=0,c=0;k=0;for(f=m.length-1;k<f;k+=2){b+=m[k];c+=m[k+1]}return[~~(b/f),~~(c/f)]}function Ba(m,k){return m.replace(/\{ *([\w_]+) *\}/g,function(f,b){return k[b]||""})}function Ca(m,k){var f=new XMLHttpRequest;f.onreadystatechange=function(){if(f.readyState===4)!f.status||f.status<200||f.status>299||f.responseText&&k(JSON.parse(f.responseText))};f.open("GET",m);f.send(null);return f}
function ta(m,k,f){if(f===undefined)f=[];var b,c,e,j=m[0]?m:m.features,g,s,r,o,A=k?1:0,D=k?0:1;if(j){b=0;for(m=j.length;b<m;b++)ta(j[b],k,f);return f}if(m.type==="Feature"){g=m.geometry;b=m.properties}if(g.type==="Polygon")s=[g.coordinates];if(g.type==="MultiPolygon")s=g.coordinates;if(s){k=b.height;j=E.parse(b.color||b.style.fillColor);b=0;for(m=s.length;b<m;b++){r=s[b][0];g=[];c=o=0;for(e=r.length;c<e;c++){g.push(r[c][A],r[c][D]);o+=k||r[c][2]||0}if(o){c=[];c[J]=~~(o/r.length);r=T;o=void 0;e=void 0;
var y=void 0,F=void 0,R=0,w=void 0,G=void 0;w=0;for(G=g.length-3;w<G;w+=2){o=g[w];e=g[w+1];y=g[w+2];F=g[w+3];R+=o*F-y*e}if((R/2>0?"CW":"CCW")==="CW")g=g;else{o=[];for(e=g.length-2;e>=0;e-=2)o.push(g[e],g[e+1]);g=o}c[r]=g;if(j)c[K]=[j,j.adjustLightness(0.2)];f.push(c)}}}return f}var U=Math.PI,ua=U/2,Da=U/4,Ea=180/U,Fa=256,ga=14,ha=400,va=ha-50,V="latitude",W="longitude",J=0,T=1,K=2,M=3,aa=4,wa=wa||Array,Ga=Math.exp,Ha=Math.log,Ia=Math.tan,Ja=Math.atan,ia=Math.min,Ka=Math.max,Aa=Math.sqrt,E=function(){function m(b,
c,e){if(e<0)e+=1;if(e>1)e-=1;if(e<1/6)return b+(c-b)*6*e;if(e<0.5)return c;if(e<2/3)return b+(c-b)*(2/3-e)*6;return b}function k(b,c,e,j){this.r=b;this.g=c;this.b=e;this.a=arguments.length<4?1:j}var f=k.prototype;f.toString=function(){return"rgba("+[this.r,this.g,this.b,this.a].join(",")+")"};f.adjustLightness=function(b){var c=E.toHSLA(this);c.l+=b;c.l=Math.min(1,Math.max(0,c.l));var e,j;if(c.s===0)b=e=j=c.l;else{j=c.l<0.5?c.l*(1+c.s):c.l+c.s-c.l*c.s;var g=2*c.l-j;b=m(g,j,c.h+1/3);e=m(g,j,c.h);j=
m(g,j,c.h-1/3)}return new E(~~(b*255),~~(e*255),~~(j*255),c.a)};f.adjustAlpha=function(b){return new E(this.r,this.g,this.b,this.a*b)};k.parse=function(b){if(~b.indexOf("#")){b=b.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new E(parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16),b[4]?parseInt(b[4],16)/255:1)}if(b=b.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new E(b[1],b[2],b[3],b[4]?b[5]:1)};k.toHSLA=function(b){var c=b.r/255,e=b.g/255,j=b.b/255,g=Math.max(c,e,j),s=Math.min(c,
e,j),r,o=(g+s)/2,A;if(g===s)r=s=0;else{A=g-s;s=o>0.5?A/(2-g-s):A/(g+s);switch(g){case c:r=(e-j)/A+(e<j?6:0);break;case e:r=(j-c)/A+2;break;case j:r=(c-e)/A+4;break}r/=6}return{h:r,s:s,l:o,a:b.a}};return k}();return function(){function m(a){t=za.document.createElement("canvas");t.style.webkitTransform="translate3d(0,0,0)";t.style.position="absolute";t.style.pointerEvents="none";t.style.left=0;t.style.top=0;t.style.imageRendering="optimizeSpeed";a.appendChild(t);v=t.getContext("2d");v.lineCap="round";
v.lineJoin="round";v.lineWidth=1;try{v.mozImageSmoothingEnabled=false}catch(h){}}function k(a,h){var d={};a/=X;h/=X;d[V]=h<=0?90:h>=1?-90:Ea*(2*Ja(Ga(U*(1-2*h)))-ua);d[W]=(a===1?1:(a%1+1)%1)*360-180;return d}function f(){if(!(!ja||B<ga)){var a=k(w-F,G-R),h=k(w+D+F,G+y+R);ba&&ba.abort();ba=Ca(Ba(ja,{w:a[W],n:a[V],e:h[W],s:h[V],z:B}),s)}}function b(a,h){var d=[],l,i,n,z,q,N,O,x,C=ka-B;l=0;for(i=a.length;l<i;l++){q=a[l];N=q[T];O=new wa(N.length);n=0;for(z=N.length-1;n<z;n+=2){x=N[n+1];var P=ia(1,Ka(0,
0.5-Ha(Ia(Da+ua*N[n]/180))/U/2));x={x:~~((x/360+0.5)*X),y:~~(P*X)};O[n]=x.x;O[n+1]=x.y}d[l]=[];d[l][J]=ia(q[J]>>C,va);d[l][T]=O;d[l][K]=q[K];d[l][M]=sa(O);d[l][aa]=h}return d}function c(a,h){D=a;y=h;F=~~(D/2);R=~~(y/2);H=F;I=y;t.width=D;t.height=y}function e(a,h){w=a;G=h}function j(a){B=a;X=Fa<<B;S=1-(B-Y)*0.3/(ka-Y)}function g(){la=true;o()}function s(a){var h,d,l,i=[],n=0,z=0;Y=ga;j(B);ba=null;if(!(!a||a.meta.z!==B)){l=a.meta;d=a.data;if(u&&p&&u.z===l.z){n=u.x-l.x;z=u.y-l.y;a=0;for(h=p.length;a<
h;a++)i[a]=p[a][M][0]+n+","+(p[a][M][1]+z)}u=l;p=[];a=0;for(h=d.length;a<h;a++){p[a]=d[a];p[a][J]=ia(p[a][J],va);p[a][M]=sa(p[a][T]);l=p[a][M].join(",");p[a][aa]=!(i&&~i.indexOf(l))}r()}}function r(){Z=0;clearInterval(ma);ma=setInterval(function(){Z+=0.1;if(Z>1){clearInterval(ma);Z=1;for(var a=0,h=p.length;a<h;a++)p[a][aa]=0}o()},33)}function o(){v.clearRect(0,0,D,y);if(u&&p)if(!(B<Y||la)){var a,h,d,l,i,n,z,q,N=w-u.x,O=G-u.y,x,C,P,ca,da,Q,na,La=ea.adjustAlpha(S),Ma=xa.adjustAlpha(S),ya=[H+u.x,I+u.y];
if(fa)v.strokeStyle=Na.adjustAlpha(S)+"";p.sort(function(Oa,Pa){return ra(Oa[M],ya)-ra(Pa[M],ya)});a=0;for(h=p.length;a<h;a++){i=p[a];C=false;n=i[T];x=[];d=0;for(l=n.length-1;d<l;d+=2){x[d]=z=n[d]-N;x[d+1]=q=n[d+1]-O;C||(C=z>0&&z<D&&q>0&&q<y)}if(C){v.fillStyle=(i[K]?i[K][0].adjustAlpha(S):La)+"";d=i[aa]?i[J]*Z:i[J];n=ha/(ha-d);z=[];q=[];d=0;for(l=x.length-3;d<l;d+=2){C=x[d];P=x[d+1];ca=x[d+2];da=x[d+3];Q={x:~~((C-H)*n+H),y:~~((P-I)*n+I)};na={x:~~((ca-H)*n+H),y:~~((da-I)*n+I)};if((ca-C)*(Q.y-P)>(Q.x-
C)*(da-P)){if(!q.length){q.unshift(P);q.unshift(C);q.push(Q.x,Q.y)}q.unshift(da);q.unshift(ca);q.push(na.x,na.y)}else{A(q);q=[]}z[d]=Q.x;z[d+1]=Q.y}A(q);v.fillStyle=(i[K]?i[K][1].adjustAlpha(S):Ma)+"";A(z,fa)}}}}function A(a,h){if(a.length){v.beginPath();v.moveTo(a[0],a[1]);for(var d=2,l=a.length;d<l;d+=2)v.lineTo(a[d],a[d+1]);v.closePath();h&&v.stroke();v.fill()}}var D=0,y=0,F=0,R=0,w=0,G=0,B,X,ba,t,v,ja,fa,ea=new E(200,190,180),xa=ea.adjustLightness(0.2),Na=new E(145,140,135),$,u,p,S=1,Z=1,ma,Y=
ga,ka=20,H,I,la=false;this.VERSION="0.1.5a";this.render=function(){this.map&&o();return this};this.setStyle=function(a){if(this.map){a=(a=a)||{};fa=a.strokeRoofs!==undefined?a.strokeRoofs:fa;if(a.fillColor){ea=E.parse(a.fillColor);xa=ea.adjustLightness(0.2)}o()}return this};this.setData=function(a,h){if(this.map)if(a){$=ta(a,h);Y=0;j(B);u={n:90,w:-180,s:-90,e:180,x:0,y:0,z:B};p=b($,true);r()}else{$=null;o()}return this};this.loadData=function(a){if(this.map){ja=a;f()}return this};var oa,pa,qa;this.VERSION+=
"-leaflet";this.addTo=function(a){a.addLayer(this);return this};this.onAdd=function(a){this.map=a;m(a._panes.overlayPane);ka=a._layersMaxZoom;c(a._size.x,a._size.y);var h=a.getPixelOrigin();e(h.x,h.y);j(a._zoom);var d=0,l=0;oa=function(){var i=L.DomUtil.getPosition(a._mapPane);H=F-(i.x-d);I=y-(i.y-l);o()};pa=function(){var i=L.DomUtil.getPosition(a._mapPane);d=i.x;l=i.y;t.style.left=-i.x+"px";t.style.top=-i.y+"px";H=F;I=y;c(a._size.x,a._size.y);var n=a.getPixelOrigin();e(n.x-i.x,n.y-i.y);i=k(w,G);
n=k(w+D,G+y);if(u&&(i[V]>u.n||i[W]<u.w||n[V]<u.s||n[W]>u.e))f();o()};qa=function(){var i={zoom:a._zoom};la=false;j(i.zoom);if($){p=b($);o()}else f()};a.on({move:oa,moveend:pa,zoomstart:g,zoomend:qa});if(a.options.zoomAnimation)t.className="leaflet-zoom-animated";a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');o()};this.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');
a.off({move:oa,moveend:pa,zoomstart:g,zoomend:qa});t.parentNode.removeChild(t);this.map=null};arguments.length&&this.addTo(arguments[0])}}(this);
