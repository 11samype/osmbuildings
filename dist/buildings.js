var Buildings=function(T){function U(a){d=T.document.createElement("canvas");d.style.webkitTransform="translate3d(0,0,0)";d.style.position="absolute";d.style.pointerEvents="none";d.style.left=0;d.style.top=0;a.appendChild(d);g=d.getContext("2d");g.lineWidth=1;g.lineCap="round";try{g.mozImageSmoothingEnabled=!1}catch(c){}}function h(a,c){var b={},a=a/p,c=c/p;b[i]=0>=c?90:1<=c?-90:V*(2*W(X(B*(1-2*c)))-Y);b[q]=360*(1===a?1:(a%1+1)%1)-180;return b}function Z(a,c){return a.replace(/\{ *([\w_]+) *\}/g,
function(b,a){return c[a]||""})}function $(a,c){var b=new XMLHttpRequest;b.onreadystatechange=function(){4!==b.readyState||!b.status||200>b.status||299<b.status||b.responseText&&c(JSON.parse(b.responseText))};b.open("GET",a);b.send(null)}function J(a){r=a.width;height=a.height;halfWidth=~~(r/2);halfHeight=~~(height/2);C=halfWidth;D=height;d.width=r;d.height=height}function K(a){s=a.x;centerY=a.y}function L(a){t=a.zoom;p=aa<<t;w=1-0.3*(t-x)/(M-x)}function ba(){isZooming=!0;u()}function j(){if(!(t<
x)){var a=h(s-r,centerY-height),c=h(s+r,centerY+height);$(Z(N,{w:a[q],n:a[i],e:c[q],s:c[i],z:t}),ca)}}function ca(a){a&&a.meta.z==t&&(n=a.meta,y=a.data,u())}function u(){g.clearRect(0,0,r,height);if(!(t<x||isZooming)){var a=E(O,w*z),c=E(P,w*z),b=E(Q,w*z);g.strokeStyle=b;var d,e,A,i,k,f,o,q=s-halfWidth-n.x,u=centerY-halfHeight-n.y,l,m,h,j,v,p;F={};G={};b=0;for(d=y.length;b<d;b++){m=!1;i=y[b][0]*z;k=y[b][1];l=new Int32Array(k.length);e=0;for(A=k.length-1;e<A;e+=2)l[e]=f=k[e]-q,l[e+1]=o=k[e+1]-u,!m&&
(m=0<f&&f<r&&0<o&&o<height);if(m){g.fillStyle=a;k=new Int32Array(l.length-2);f=[];e=0;for(A=l.length-1-2;e<A;e+=2)o=l[e],m=l[e+1],h=l[e+2],j=l[e+3],v=R(o,m,i),p=R(h,j,i),(h-o)*(v.y-m)>(v.x-o)*(j-m)?(f.length||(f.unshift(m),f.unshift(o),f.push(v.x),f.push(v.y)),f.unshift(j),f.unshift(h),f.push(p.x),f.push(p.y)):(H(f),f=[]),k[e]=v.x,k[e+1]=v.y;H(f);g.fillStyle=c;H(k,S)}}}}function H(a,c){g.beginPath();g.moveTo(a[0],a[1]);for(var b=2,d=a.length;b<d;b+=2)g.lineTo(a[b],a[b+1]);g.closePath();c&&g.stroke();
g.fill()}function R(a,c,b){var b=da(b,ea),d=a+","+b,e=c+","+b,b=I/(I-b);return{x:F[d]||(F[d]=~~((a-C)*b+C)),y:G[e]||(G[e]=~~((c-D)*b+D))}}function E(a,c){var b=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);return"rgba("+[b[1],b[2],b[3],b[4]?c*b[5]:c].join()+")"}var X=Math.exp,W=Math.atan,da=Math.min,B=Math.PI,Y=B/2,V=180/B,i="latitude",q="longitude",r=height=halfWidth=halfHeight=0,s=centerY=0,t,p,d,g,N,S,O,P,Q,n,y,w=1,z=1,F={},G={},aa=256,x=14,M,C=halfWidth,D=height,I=400,ea=I-50;isZooming=!1;
return{setMap:function(a,c){U(document.querySelector(".leaflet-control-container"));M=17;J({width:c._size.x,height:c._size.y});var b=c._size.divideBy(2);K(c._getTopLeftPoint().add(b));L({zoom:c._zoom});var d;window.addEventListener("resize",function(){d=setTimeout(function(){clearTimeout(d);J({width:c._size.x,height:c._size.y});u();j()},100)},!1);c.on("move",function(){var a=c._size.divideBy(2),a=c._getTopLeftPoint().add(a);K(a);s=a.x;centerY=a.y;u()});c.on("moveend",function(){var a=c._size.divideBy(2);
c._getTopLeftPoint().add(a);var a=h(s-halfWidth,centerY-halfHeight),b=h(s+halfWidth,centerY+halfHeight);n&&(a[i]>n.n||a[q]<n.w||b[i]<n.s||b[q]>n.e)&&j()});c.on("zoomstart",ba);c.on("zoomend",function(){var a={zoom:c._zoom};isZooming=!1;L(a);j()})},render:u,load:function(a,c){N=a;S=!!c.strokeRoofs;O=c.wallColor||"rgb(200,190,180)";P=c.roofColor||"rgb(250,240,230)";Q=c.strokeColor||"rgb(145,140,135)";j()}}}(this);
