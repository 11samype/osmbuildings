var OSMBuildings=function(ja){var U=Math.PI,ya=U/2,Da=U/4,Ea=180/U,Fa=256,ka=14,la=400,za=la-50,V="latitude",W="longitude",H=0,G=1,I=2,da=3,Aa=Aa||Array,Ga=Math.exp,Ha=Math.log,Ia=Math.tan,Ja=Math.atan,ma=Math.min,Ka=Math.max,na=ja.document,u=function(){function X(f,h,k){if(k<0)k+=1;if(k>1)k-=1;if(k<1/6)return f+(h-f)*6*k;if(k<0.5)return h;if(k<2/3)return f+(h-f)*(2/3-k)*6;return f}function B(f,h,k,m){this.r=f;this.g=h;this.b=k;this.a=arguments.length<4?1:m}var Y=B.prototype;Y.toString=function(){return"rgba("+
[this.r,this.g,this.b,this.a].join(",")+")"};Y.adjustLightness=function(f){var h=u.toHSLA(this);h.l+=f;h.l=Math.min(1,Math.max(0,h.l));var k,m;if(h.s===0)f=k=m=h.l;else{m=h.l<0.5?h.l*(1+h.s):h.l+h.s-h.l*h.s;var v=2*h.l-m;f=X(v,m,h.h+1/3);k=X(v,m,h.h);m=X(v,m,h.h-1/3)}return new u(~~(f*255),~~(k*255),~~(m*255),h.a)};Y.adjustAlpha=function(f){return new u(this.r,this.g,this.b,this.a*f)};B.parse=function(f){if(~f.indexOf("#")){f=f.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new u(parseInt(f[1],
16),parseInt(f[2],16),parseInt(f[3],16),f[4]?parseInt(f[4],16)/255:1)}if(f=f.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new u(parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10),f[4]?parseFloat(f[5],10):1)};B.toHSLA=function(f){var h=f.r/255,k=f.g/255,m=f.b/255,v=Math.max(h,k,m),w=Math.min(h,k,m),y,Z=(v+w)/2,C;if(v===w)y=w=0;else{C=v-w;w=Z>0.5?C/(2-v-w):C/(v+w);switch(v){case h:y=(k-m)/C+(k<m?6:0);break;case k:y=(m-h)/C+2;break;case m:y=(h-k)/C+4;break}y/=6}return{h:y,s:w,l:Z,
a:f.a}};return B}();return function(){function X(a){q=na.createElement("canvas");q.style.webkitTransform="translate3d(0,0,0)";q.style.position="absolute";q.style.pointerEvents="none";q.style.left=0;q.style.top=0;q.style.imageRendering="optimizeSpeed";a.appendChild(q);s=q.getContext("2d");s.lineCap="round";s.lineJoin="round";s.lineWidth=1;try{s.mozImageSmoothingEnabled=false}catch(e){}}function B(a,e){var b={};a/=$;e/=$;b[V]=e<=0?90:e>=1?-90:Ea*(2*Ja(Ga(U*(1-2*e)))-ya);b[W]=(a===1?1:(a%1+1)%1)*360-
180;return b}function Y(a,e){return a.replace(/\{ *([\w_]+) *\}/g,function(b,c){return e[c]||""})}function f(a,e){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===4)!b.status||b.status<200||b.status>299||b.responseText&&e(JSON.parse(b.responseText))};b.open("GET",a);b.send(null);return b}function h(){if(!(!oa||x<ka)){var a=B(O-P,Q-pa),e=B(O+J+P,Q+z+pa);ea&&ea.abort();ea=f(Y(oa,{w:a[W],n:a[V],e:e[W],s:e[V],z:x}),k)}}function k(a){var e,b,c,d=[],g=0,i=0;aa=ka;fa(x);ea=null;
if(!(!a||a.meta.z!==x)){c=a.meta;b=a.data;if(t&&n&&t.z===c.z){g=t.x-c.x;i=t.y-c.y;a=0;for(e=n.length;a<e;a++)d[a]=n[a][G][0]+g+","+(n[a][G][1]+i)}t=c;n=[];a=0;for(e=b.length;a<e;a++){n[a]=b[a];n[a][H]=ma(n[a][H],za);c=n[a][G][0]+","+n[a][G][1];n[a][da]=!(d&&~d.indexOf(c))}Ba()}}function m(a,e){var b=[],c,d,g,i,j,r,o,l,p=qa-x;c=0;for(d=a.length;c<d;c++){j=a[c];r=j[G];o=new Aa(r.length);g=0;for(i=r.length-1;g<i;g+=2){l=r[g+1];var D=ma(1,Ka(0,0.5-Ha(Ia(Da+ya*r[g]/180))/U/2));l={x:~~((l/360+0.5)*$),y:~~(D*
$)};o[g]=l.x;o[g+1]=l.y}b[c]=[];b[c][H]=ma(j[H]>>p,za);b[c][G]=o;b[c][I]=j[I];b[c][da]=e}return b}function v(a,e){if(typeof a==="object")y(a,!e);else{var b=na.documentElement,c=na.createElement("script");ja.jsonpCallback=function(d){delete ja.jsonpCallback;b.removeChild(c);y(d,!e)};b.insertBefore(c,b.lastChild).src=a.replace(/\{callback\}/,"jsonpCallback")}}function w(a,e,b){if(b===undefined)b=[];var c,d,g,i=a[0]?a:a.features,j,r,o,l,p,D=e?1:0,R=e?0:1;if(i){c=0;for(a=i.length;c<a;c++)w(i[c],e,b);
return b}if(a.type==="Feature"){d=a.geometry;c=a.properties}if(d.type==="Polygon")j=[d.coordinates];if(d.type==="MultiPolygon")j=d.coordinates;if(j){e=c.height;if(c.color){l=u.parse(c.color);p=l.adjustLightness(0.2)}else{if(c.wallColor){l=u.parse(c.wallColor);c.roofColor||(p=l.adjustLightness(0.2))}if(c.roofColor)p=u.parse(c.roofColor)}c=0;for(a=j.length;c<a;c++){r=j[c][0];i=[];d=o=0;for(g=r.length;d<g;d++){i.push(r[d][D],r[d][R]);o+=e||r[d][2]||0}if(o){d=[];d[H]=~~(o/r.length);r=G;o=void 0;g=void 0;
var K=void 0,A=void 0,S=0,E=void 0,ga=void 0;E=0;for(ga=i.length-3;E<ga;E+=2){o=i[E];g=i[E+1];K=i[E+2];A=i[E+3];S+=o*A-K*g}if((S/2>0?"CW":"CCW")==="CW")i=i;else{o=[];for(g=i.length-2;g>=0;g-=2)o.push(i[g],i[g+1]);i=o}d[r]=i;if(l||p)d[I]=[l,p];b.push(d)}}}return b}function y(a,e){if(a){ba=w(a,e);aa=0;fa(x);t={n:90,w:-180,s:-90,e:180,x:0,y:0,z:x};n=m(ba,true);Ba()}else{ba=null;F()}}function Z(a,e){J=a;z=e;P=~~(J/2);pa=~~(z/2);M=P;N=z;q.width=J;q.height=z}function C(a,e){O=a;Q=e}function fa(a){x=a;$=
Fa<<x;T=1-(x-aa)*0.3/(qa-aa)}function Ca(){ra=true;F()}function Ba(){ca=0;clearInterval(sa);sa=setInterval(function(){ca+=0.1;if(ca>1){clearInterval(sa);ca=1;for(var a=0,e=n.length;a<e;a++)n[a][da]=0}F()},33)}function F(){s.clearRect(0,0,J,z);if(t&&n)if(!(x<aa||ra)){var a,e,b,c,d,g,i,j,r=O-t.x,o=Q-t.y,l,p,D,R,K,A,S,E=ha.adjustAlpha(T),ga=ta.adjustAlpha(T);if(ia)s.strokeStyle=La.adjustAlpha(T)+"";a=0;for(e=n.length;a<e;a++){d=n[a];p=false;g=d[G];l=[];b=0;for(c=g.length-1;b<c;b+=2){l[b]=i=g[b]-r;l[b+
1]=j=g[b+1]-o;p||(p=i>0&&i<J&&j>0&&j<z)}if(p){s.fillStyle=(d[I]?d[I][0].adjustAlpha(T):E)+"";b=d[da]?d[H]*ca:d[H];g=la/(la-b);i=[];j=[];b=0;for(c=l.length-3;b<c;b+=2){p=l[b];D=l[b+1];R=l[b+2];K=l[b+3];A={x:~~((p-M)*g+M),y:~~((D-N)*g+N)};S={x:~~((R-M)*g+M),y:~~((K-N)*g+N)};if((R-p)*(A.y-D)>(A.x-p)*(K-D)){if(!j.length){j.unshift(D);j.unshift(p);j.push(A.x,A.y)}j.unshift(K);j.unshift(R);j.push(S.x,S.y)}else{ua(j);j=[]}i[b]=A.x;i[b+1]=A.y}ua(j);s.fillStyle=(d[I]?d[I][1].adjustAlpha(T):ga)+"";ua(i,ia)}}}}
function ua(a,e){if(a.length){s.beginPath();s.moveTo(a[0],a[1]);for(var b=2,c=a.length;b<c;b+=2)s.lineTo(a[b],a[b+1]);s.closePath();e&&s.stroke();s.fill()}}var J=0,z=0,P=0,pa=0,O=0,Q=0,x,$,ea,q,s,oa,ia,ha=new u(200,190,180),ta=ha.adjustLightness(0.2),La=new u(145,140,135),ba,t,n,T=1,ca=1,sa,aa=ka,qa=20,M,N,ra=false;this.VERSION="0.1.5a";this.render=function(){F();return this};this.setStyle=function(a){a=(a=a)||{};ia=a.strokeRoofs!==undefined?a.strokeRoofs:ia;if(a.wallColor){ha=u.parse(a.wallColor);
a.roofColor||(ta=ha.adjustLightness(0.2))}if(a.roofColor)ta=u.parse(a.roofColor);F();return this};this.setData=function(a,e){console.warn("OSMBuildings.loadData() is deprecated and will be removed soon.\nUse OSMBuildings.loadData({url|object}, isLatLon?) instead.");y(a,e);return this};this.loadData=function(a){oa=a;h();return this};this.geoJSON=function(a,e){v(a,e);return this};var va,wa,xa;this.VERSION+="-leaflet";this.addTo=function(a){a.addLayer(this);return this};this.onAdd=function(a){this.map=
a;X(a._panes.overlayPane);qa=a._layersMaxZoom;Z(a._size.x,a._size.y);var e=a.getPixelOrigin();C(e.x,e.y);fa(a._zoom);var b=0,c=0;va=function(){var d=L.DomUtil.getPosition(a._mapPane);M=P-(d.x-b);N=z-(d.y-c);F()};wa=function(){var d=L.DomUtil.getPosition(a._mapPane);b=d.x;c=d.y;q.style.left=-d.x+"px";q.style.top=-d.y+"px";M=P;N=z;Z(a._size.x,a._size.y);var g=a.getPixelOrigin();C(g.x-d.x,g.y-d.y);d=B(O,Q);g=B(O+J,Q+z);if(t&&(d[V]>t.n||d[W]<t.w||g[V]<t.s||g[W]>t.e))h();F()};xa=function(){var d={zoom:a._zoom};
ra=false;fa(d.zoom);if(ba){n=m(ba);F()}else h()};a.on({move:va,moveend:wa,zoomstart:Ca,zoomend:xa});if(a.options.zoomAnimation)q.className="leaflet-zoom-animated";a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');F()};this.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.off({move:va,moveend:wa,zoomstart:Ca,zoomend:xa});q.parentNode.removeChild(q);this.map=
null};arguments.length&&this.addTo(arguments[0])}}(this);
