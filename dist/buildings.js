var Buildings=function(D){function Y(a){j=D.document.createElement("canvas");j.style.webkitTransform="translate3d(0,0,0)";j.style.position="absolute";j.style.pointerEvents="none";j.style.left=0;j.style.top=0;a.appendChild(j);h=j.getContext("2d");h.lineWidth=1;h.lineCap="round";try{h.mozImageSmoothingEnabled=!1}catch(b){}}function n(a,b){var c={},a=a/E,b=b/E;c[t]=0>=b?90:1<=b?-90:Z*(2*$(aa(F*(1-2*b)))-ba);c[u]=360*(1===a?1:(a%1+1)%1)-180;return c}function ca(a,b){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,d){return b[d]||""})}function da(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4!==c.readyState||!c.status||200>c.status||299<c.status||c.responseText&&b(JSON.parse(c.responseText))};c.open("GET",a);c.send(null);return c}function O(a){v=a.width;height=a.height;halfWidth=~~(v/2);halfHeight=~~(height/2);G=halfWidth;H=height;j.width=v;j.height=height}function P(a){y=a.x;centerY=a.y}function Q(a){w=a.zoom;E=ea<<w;A=1-0.3*(w-B)/(R-B)}function fa(){isZooming=!0;m()}function r(){if(!(w<
B)){var a=n(y-v,centerY-height),b=n(y+v,centerY+height);C&&C.abort();C=da(ca(S,{w:a[u],n:a[t],e:b[u],s:b[t],z:w}),ga)}}function ga(a){var b,c=[],h=0,e=0;C=null;if(a&&a.meta.z==w){b=a.meta;a=a.data;if(k&&d&&k.z==b.z)for(var h=k.x-b.x,e=k.y-b.y,f=0,l=d.length;f<l;f++)c[f]=d[f][1][0]+h+","+(d[f][1][1]+e);k=b;d=[];f=0;for(l=a.length;f<l;f++)d[f]=a[f],d[f][0]=ha(d[f][0],ia),b=d[f][1][0]+","+d[f][1][1],c&&-1<~~c.indexOf(b)&&(d[f][2]=1,g++);ja()}}function ja(){z=0;clearInterval(I);I=setInterval(function(){z+=
0.1;if(1<z){clearInterval(I);z=1;for(var a=0,b=d.length;a<b;a++)delete d[a][2]}m()},33)}function m(){h.clearRect(0,0,v,height);if(!(w<B||isZooming)){var a=J(T,A),b=J(U,A),c=J(V,A);h.strokeStyle=c;var j,e,f,l,o,i,s,t=y-halfWidth-k.x,u=centerY-halfHeight-k.y,p,q,m,n,x,r;K={};L={};c=0;for(j=d.length;c<j;c++){l=d[c];q=!1;o=l[1];p=new Int32Array(o.length);e=0;for(f=o.length-1;e<f;e+=2)p[e]=i=o[e]-t,p[e+1]=s=o[e+1]-u,!q&&(q=0<i&&i<v&&0<s&&s<height);if(q){h.fillStyle=a;l=l[2]?l[0]:l[0]*z;o=new Int32Array(p.length-
2);i=[];e=0;for(f=p.length-1-2;e<f;e+=2)s=p[e],q=p[e+1],m=p[e+2],n=p[e+3],x=W(s,q,l),r=W(m,n,l),(m-s)*(x.y-q)>(x.x-s)*(n-q)?(i.length||(i.unshift(q),i.unshift(s),i.push(x.x),i.push(x.y)),i.unshift(n),i.unshift(m),i.push(r.x),i.push(r.y)):(M(i),i=[]),o[e]=x.x,o[e+1]=x.y;M(i);h.fillStyle=b;M(o,X)}}}}function M(a,b){h.beginPath();h.moveTo(a[0],a[1]);for(var c=2,d=a.length;c<d;c+=2)h.lineTo(a[c],a[c+1]);h.closePath();b&&h.stroke();h.fill()}function W(a,b,c){var d=a+","+c,e=b+","+c,c=N/(N-c);return{x:K[d]||
(K[d]=~~((a-G)*c+G)),y:L[e]||(L[e]=~~((b-H)*c+H))}}function J(a,b){var c=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);return"rgba("+[c[1],c[2],c[3],c[4]?b*c[5]:b].join()+")"}D.Int32Array=D.Int32Array||Array;var aa=Math.exp,$=Math.atan,ha=Math.min,F=Math.PI,ba=F/2,Z=180/F,t="latitude",u="longitude",v=height=halfWidth=halfHeight=0,y=centerY=0,w,E,C,j,h,S,X,T,U,V,k,d,A=1,z=1,I,K={},L={},ea=256,B=14,R,G=halfWidth,H=height,N=400,ia=N-50;isZooming=!1;return{setMap:function(a,b){Y(document.querySelector(".leaflet-control-container"));
R=17;O({width:b._size.x,height:b._size.y});var c=b._size.divideBy(2);P(b._getTopLeftPoint().add(c));Q({zoom:b._zoom});var d;window.addEventListener("resize",function(){d=setTimeout(function(){clearTimeout(d);O({width:b._size.x,height:b._size.y});m();r()},100)},!1);b.on("move",function(){var a=b._size.divideBy(2),a=b._getTopLeftPoint().add(a);P(a);m()});b.on("moveend",function(){var a=b._size.divideBy(2);b._getTopLeftPoint().add(a);var a=n(y-halfWidth,centerY-halfHeight),c=n(y+halfWidth,centerY+halfHeight);
k&&(a[t]>k.n||a[u]<k.w||c[t]<k.s||c[u]>k.e)&&r()});b.on("zoomstart",fa);b.on("zoomend",function(){var a={zoom:b._zoom};isZooming=!1;Q(a);r()})},render:m,load:function(a,b){S=a;X=!!b.strokeRoofs;T=b.wallColor||"rgb(200,190,180)";U=b.roofColor||"rgb(250,240,230)";V=b.strokeColor||"rgb(145,140,135)";r()}}}(this);
