var OSMBuildings=function(ia){var T=Math.PI,wa=T/2,Ca=T/4,Da=180/T,Ea=256,ja=14,ka=400,xa=ka-50,U="latitude",V="longitude",H=0,G=1,I=2,ca=3,ya=ya||Array,Fa=Math.exp,Ga=Math.log,Ha=Math.tan,Ia=Math.atan,la=Math.min,Ja=Math.max,ma=ia.document,C=function(){function W(g,i,k){if(k<0)k+=1;if(k>1)k-=1;if(k<1/6)return g+(i-g)*6*k;if(k<0.5)return i;if(k<2/3)return g+(i-g)*(2/3-k)*6;return g}function B(g,i,k,m){this.r=g;this.g=i;this.b=k;this.a=arguments.length<4?1:m}var X=B.prototype;X.toString=function(){return"rgba("+
[this.r,this.g,this.b,this.a].join(",")+")"};X.adjustLightness=function(g){var i=C.toHSLA(this);i.l+=g;i.l=Math.min(1,Math.max(0,i.l));var k,m;if(i.s===0)g=k=m=i.l;else{m=i.l<0.5?i.l*(1+i.s):i.l+i.s-i.l*i.s;var u=2*i.l-m;g=W(u,m,i.h+1/3);k=W(u,m,i.h);m=W(u,m,i.h-1/3)}return new C(~~(g*255),~~(k*255),~~(m*255),i.a)};X.adjustAlpha=function(g){return new C(this.r,this.g,this.b,this.a*g)};B.parse=function(g){if(~g.indexOf("#")){g=g.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new C(parseInt(g[1],
16),parseInt(g[2],16),parseInt(g[3],16),g[4]?parseInt(g[4],16)/255:1)}if(g=g.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new C(g[1],g[2],g[3],g[4]?g[5]:1)};B.toHSLA=function(g){var i=g.r/255,k=g.g/255,m=g.b/255,u=Math.max(i,k,m),v=Math.min(i,k,m),y,Y=(u+v)/2,D;if(u===v)y=v=0;else{D=u-v;v=Y>0.5?D/(2-u-v):D/(u+v);switch(u){case i:y=(k-m)/D+(k<m?6:0);break;case k:y=(m-i)/D+2;break;case m:y=(i-k)/D+4;break}y/=6}return{h:y,s:v,l:Y,a:g.a}};return B}();return function(){function W(a){o=
ma.createElement("canvas");o.style.webkitTransform="translate3d(0,0,0)";o.style.position="absolute";o.style.pointerEvents="none";o.style.left=0;o.style.top=0;o.style.imageRendering="optimizeSpeed";a.appendChild(o);p=o.getContext("2d");p.lineCap="round";p.lineJoin="round";p.lineWidth=1;try{p.mozImageSmoothingEnabled=false}catch(c){}}function B(a,c){var b={};a/=Z;c/=Z;b[U]=c<=0?90:c>=1?-90:Da*(2*Ia(Fa(T*(1-2*c)))-wa);b[V]=(a===1?1:(a%1+1)%1)*360-180;return b}function X(a,c){return a.replace(/\{ *([\w_]+) *\}/g,
function(b,d){return c[d]||""})}function g(a,c){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===4)!b.status||b.status<200||b.status>299||b.responseText&&c(JSON.parse(b.responseText))};b.open("GET",a);b.send(null);return b}function i(){if(!(!na||w<ja)){var a=B(P-Q,R-oa),c=B(P+J+Q,R+z+oa);da&&da.abort();da=g(X(na,{w:a[V],n:a[U],e:c[V],s:c[U],z:w}),k)}}function k(a){var c,b,d,e=[],h=0,l=0;$=ja;ea(w);da=null;if(!(!a||a.meta.z!==w)){d=a.meta;b=a.data;if(r&&n&&r.z===d.z){h=r.x-
d.x;l=r.y-d.y;a=0;for(c=n.length;a<c;a++)e[a]=n[a][G][0]+h+","+(n[a][G][1]+l)}r=d;n=[];a=0;for(c=b.length;a<c;a++){n[a]=b[a];n[a][H]=la(n[a][H],xa);d=n[a][G][0]+","+n[a][G][1];n[a][ca]=!(e&&~e.indexOf(d))}za()}}function m(a,c){var b=[],d,e,h,l,f,s,q,j,t=pa-w;d=0;for(e=a.length;d<e;d++){f=a[d];s=f[G];q=new ya(s.length);h=0;for(l=s.length-1;h<l;h+=2){j=s[h+1];var E=la(1,Ja(0,0.5-Ga(Ha(Ca+wa*s[h]/180))/T/2));j={x:~~((j/360+0.5)*Z),y:~~(E*Z)};q[h]=j.x;q[h+1]=j.y}b[d]=[];b[d][H]=la(f[H]>>t,xa);b[d][G]=
q;b[d][I]=f[I];b[d][ca]=c}return b}function u(a,c){if(typeof a==="object")y(a,!c);else{var b=ma.documentElement,d=ma.createElement("script");ia.jsonpCallback=function(e){delete ia.jsonpCallback;b.removeChild(d);y(e,!c)};b.insertBefore(d,b.lastChild).src=a.replace(/\{callback\}/,"jsonpCallback")}}function v(a,c,b){if(b===undefined)b=[];var d,e,h,l=a[0]?a:a.features,f,s,q,j,t=c?1:0,E=c?0:1;if(l){d=0;for(a=l.length;d<a;d++)v(l[d],c,b);return b}if(a.type==="Feature"){f=a.geometry;d=a.properties}if(f.type===
"Polygon")s=[f.coordinates];if(f.type==="MultiPolygon")s=f.coordinates;if(s){c=d.height;l=C.parse(d.color||d.style.fillColor);d=0;for(a=s.length;d<a;d++){q=s[d][0];f=[];e=j=0;for(h=q.length;e<h;e++){f.push(q[e][t],q[e][E]);j+=c||q[e][2]||0}if(j){e=[];e[H]=~~(j/q.length);q=G;j=void 0;h=void 0;var K=void 0,M=void 0,A=0,x=void 0,fa=void 0;x=0;for(fa=f.length-3;x<fa;x+=2){j=f[x];h=f[x+1];K=f[x+2];M=f[x+3];A+=j*M-K*h}if((A/2>0?"CW":"CCW")==="CW")f=f;else{j=[];for(h=f.length-2;h>=0;h-=2)j.push(f[h],f[h+
1]);f=j}e[q]=f;if(l)e[I]=[l,l.adjustLightness(0.2)];b.push(e)}}}return b}function y(a,c){if(a){aa=v(a,c);$=0;ea(w);r={n:90,w:-180,s:-90,e:180,x:0,y:0,z:w};n=m(aa,true);za()}else{aa=null;F()}}function Y(a,c){J=a;z=c;Q=~~(J/2);oa=~~(z/2);N=Q;O=z;o.width=J;o.height=z}function D(a,c){P=a;R=c}function ea(a){w=a;Z=Ea<<w;S=1-(w-$)*0.3/(pa-$)}function Aa(){qa=true;F()}function za(){ba=0;clearInterval(ra);ra=setInterval(function(){ba+=0.1;if(ba>1){clearInterval(ra);ba=1;for(var a=0,c=n.length;a<c;a++)n[a][ca]=
0}F()},33)}function F(){p.clearRect(0,0,J,z);if(r&&n)if(!(w<$||qa)){var a,c,b,d,e,h,l,f,s=P-r.x,q=R-r.y,j,t,E,K,M,A,x,fa=ga.adjustAlpha(S),Ka=Ba.adjustAlpha(S);if(ha)p.strokeStyle=La.adjustAlpha(S)+"";a=0;for(c=n.length;a<c;a++){e=n[a];t=false;h=e[G];j=[];b=0;for(d=h.length-1;b<d;b+=2){j[b]=l=h[b]-s;j[b+1]=f=h[b+1]-q;t||(t=l>0&&l<J&&f>0&&f<z)}if(t){p.fillStyle=(e[I]?e[I][0].adjustAlpha(S):fa)+"";b=e[ca]?e[H]*ba:e[H];h=ka/(ka-b);l=[];f=[];b=0;for(d=j.length-3;b<d;b+=2){t=j[b];E=j[b+1];K=j[b+2];M=j[b+
3];A={x:~~((t-N)*h+N),y:~~((E-O)*h+O)};x={x:~~((K-N)*h+N),y:~~((M-O)*h+O)};if((K-t)*(A.y-E)>(A.x-t)*(M-E)){if(!f.length){f.unshift(E);f.unshift(t);f.push(A.x,A.y)}f.unshift(M);f.unshift(K);f.push(x.x,x.y)}else{sa(f);f=[]}l[b]=A.x;l[b+1]=A.y}sa(f);p.fillStyle=(e[I]?e[I][1].adjustAlpha(S):Ka)+"";sa(l,ha)}}}}function sa(a,c){if(a.length){p.beginPath();p.moveTo(a[0],a[1]);for(var b=2,d=a.length;b<d;b+=2)p.lineTo(a[b],a[b+1]);p.closePath();c&&p.stroke();p.fill()}}var J=0,z=0,Q=0,oa=0,P=0,R=0,w,Z,da,o,
p,na,ha,ga=new C(200,190,180),Ba=ga.adjustLightness(0.2),La=new C(145,140,135),aa,r,n,S=1,ba=1,ra,$=ja,pa=20,N,O,qa=false;this.VERSION="0.1.5a";this.render=function(){F();return this};this.setStyle=function(a){a=(a=a)||{};ha=a.strokeRoofs!==undefined?a.strokeRoofs:ha;if(a.fillColor){ga=C.parse(a.fillColor);Ba=ga.adjustLightness(0.2)}F();return this};this.setData=function(a,c){console.warn("OSMBuildings.loadData() is deprecated and will be removed soon.\nUse OSMBuildings.loadData({url|object}, isLatLon?) instead.");
y(a,c);return this};this.loadData=function(a){na=a;i();return this};this.geoJSON=function(a,c){u(a,c);return this};var ta,ua,va;this.VERSION+="-leaflet";this.addTo=function(a){a.addLayer(this);return this};this.onAdd=function(a){this.map=a;W(a._panes.overlayPane);pa=a._layersMaxZoom;Y(a._size.x,a._size.y);var c=a.getPixelOrigin();D(c.x,c.y);ea(a._zoom);var b=0,d=0;ta=function(){var e=L.DomUtil.getPosition(a._mapPane);N=Q-(e.x-b);O=z-(e.y-d);F()};ua=function(){var e=L.DomUtil.getPosition(a._mapPane);
b=e.x;d=e.y;o.style.left=-e.x+"px";o.style.top=-e.y+"px";N=Q;O=z;Y(a._size.x,a._size.y);var h=a.getPixelOrigin();D(h.x-e.x,h.y-e.y);e=B(P,R);h=B(P+J,R+z);if(r&&(e[U]>r.n||e[V]<r.w||h[U]<r.s||h[V]>r.e))i();F()};va=function(){var e={zoom:a._zoom};qa=false;ea(e.zoom);if(aa){n=m(aa);F()}else i()};a.on({move:ta,moveend:ua,zoomstart:Aa,zoomend:va});if(a.options.zoomAnimation)o.className="leaflet-zoom-animated";a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');
F()};this.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.off({move:ta,moveend:ua,zoomstart:Aa,zoomend:va});o.parentNode.removeChild(o);this.map=null};arguments.length&&this.addTo(arguments[0])}}(this);
