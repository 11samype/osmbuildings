var OSMBuildings=function(va){function wa(n,o){return n.replace(/\{ *([\w_]+) *\}/g,function(k,b){return o[b]||""})}function xa(n,o){var k=new XMLHttpRequest;k.onreadystatechange=function(){if(k.readyState===4)!k.status||k.status<200||k.status>299||k.responseText&&o(JSON.parse(k.responseText))};k.open("GET",n);k.send(null);return k}function ra(n,o,k){if(k===undefined)k=[];var b,c,e,h=n[0]?n:n.features,r,p,l,m,A=o?1:0,C=o?0:1;if(h){b=0;for(n=h.length;b<n;b++)ra(h[b],o,k);return k}if(n.type==="Feature"){r=
n.geometry;b=n.properties}if(r.type==="Polygon"){o=b.height;h=D.parse(b.color||b.style.fillColor);b=0;for(n=r.coordinates.length;b<n;b++){p=r.coordinates[b];l=[];c=m=0;for(e=p.length;c<e;c++){l.push(p[c][A],p[c][C]);m+=o||p[c][2]||0}if(m){c=[];c[I]=~~(m/p.length);p=H;m=void 0;e=void 0;var y=void 0,E=void 0,Q=0,w=void 0,F=void 0;w=0;for(F=l.length-3;w<F;w+=2){m=l[w];e=l[w+1];y=l[w+2];E=l[w+3];Q+=m*E-y*e}if((Q/2>0?"CW":"CCW")==="CW")l=l;else{m=[];for(e=l.length-2;e>=0;e-=2)m.push(l[e],l[e+1]);l=m}c[p]=
l;if(h)c[J]=[h,h.adjustLightness(0.2)];k.push(c)}}}return k}var T=Math.PI,sa=T/2,ya=T/4,za=180/T,Aa=256,ga=14,ha=400,ta=ha-50,U="latitude",V="longitude",I=0,H=1,J=2,$=3,aa=aa||Array,Ba=Math.exp,Ca=Math.log,Da=Math.tan,Ea=Math.atan,ia=Math.min,Fa=Math.max,D=function(){function n(b,c,e){if(e<0)e+=1;if(e>1)e-=1;if(e<1/6)return b+(c-b)*6*e;if(e<0.5)return c;if(e<2/3)return b+(c-b)*(2/3-e)*6;return b}function o(b,c,e,h){this.r=b;this.g=c;this.b=e;this.a=arguments.length<4?1:h}var k=o.prototype;k.toString=
function(){return"rgba("+[this.r,this.g,this.b,this.a].join(",")+")"};k.adjustLightness=function(b){var c=D.toHSLA(this);c.l+=b;c.l=Math.min(1,Math.max(0,c.l));var e,h;if(c.s===0)b=e=h=c.l;else{h=c.l<0.5?c.l*(1+c.s):c.l+c.s-c.l*c.s;var r=2*c.l-h;b=n(r,h,c.h+1/3);e=n(r,h,c.h);h=n(r,h,c.h-1/3)}return new D(~~(b*255),~~(e*255),~~(h*255),c.a)};k.adjustAlpha=function(b){return new D(this.r,this.g,this.b,this.a*b)};o.parse=function(b){if(~b.indexOf("#")){b=b.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new D(parseInt(b[1],
16),parseInt(b[2],16),parseInt(b[3],16),b[4]?parseInt(b[4],16)/255:1)}if(b=b.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new D(b[1],b[2],b[3],b[4]?b[5]:1)};o.toHSLA=function(b){var c=b.r/255,e=b.g/255,h=b.b/255,r=Math.max(c,e,h),p=Math.min(c,e,h),l,m=(r+p)/2,A;if(r===p)l=p=0;else{A=r-p;p=m>0.5?A/(2-r-p):A/(r+p);switch(r){case c:l=(e-h)/A+(e<h?6:0);break;case e:l=(h-c)/A+2;break;case h:l=(c-e)/A+4;break}l/=6}return{h:l,s:p,l:m,a:b.a}};return o}();return function(){function n(a){t=
va.document.createElement("canvas");t.style.webkitTransform="translate3d(0,0,0)";t.style.position="absolute";t.style.pointerEvents="none";t.style.left=0;t.style.top=0;t.style.imageRendering="optimizeSpeed";a.appendChild(t);u=t.getContext("2d");u.lineCap="round";u.lineJoin="round";u.lineWidth=1;try{u.mozImageSmoothingEnabled=false}catch(f){}}function o(a,f){var d={};a/=W;f/=W;d[U]=f<=0?90:f>=1?-90:za*(2*Ea(Ba(T*(1-2*f)))-sa);d[V]=(a===1?1:(a%1+1)%1)*360-180;return d}function k(){if(!(!ja||G<ga)){var a=
o(w-E,F-Q),f=o(w+C+E,F+y+Q);ba&&ba.abort();ba=xa(wa(ja,{w:a[V],n:a[U],e:f[V],s:f[U],z:G}),p)}}function b(a,f){var d=[],i,g,j,z,q,K,R,v,B=ka-G;i=0;for(g=a.length;i<g;i++){q=a[i];K=q[H];R=new aa(K.length);j=0;for(z=K.length-1;j<z;j+=2){v=K[j+1];var M=ia(1,Fa(0,0.5-Ca(Da(ya+sa*K[j]/180))/T/2));v={x:~~((v/360+0.5)*W),y:~~(M*W)};R[j]=v.x;R[j+1]=v.y}d[i]=[];d[i][I]=ia(q[I]>>B,ta);d[i][H]=R;d[i][J]=q[J];d[i][$]=f}return d}function c(a,f){C=a;y=f;E=~~(C/2);Q=~~(y/2);N=E;O=y;t.width=C;t.height=y}function e(a,
f){w=a;F=f}function h(a){G=a;W=Aa<<G;S=1-(G-X)*0.3/(ka-X)}function r(){la=true;m()}function p(a){var f,d,i,g=[],j=0,z=0;X=ga;ba=null;if(!(!a||a.meta.z!==G)){i=a.meta;d=a.data;if(x&&s&&x.z===i.z){j=x.x-i.x;z=x.y-i.y;a=0;for(f=s.length;a<f;a++)g[a]=s[a][H][0]+j+","+(s[a][H][1]+z)}x=i;s=[];a=0;for(f=d.length;a<f;a++){s[a]=d[a];s[a][I]=ia(s[a][I],ta);i=s[a][H][0]+","+s[a][H][1];s[a][$]=!(g&&~g.indexOf(i))}l()}}function l(){Y=0;clearInterval(ma);ma=setInterval(function(){Y+=0.1;if(Y>1){clearInterval(ma);
Y=1;for(var a=0,f=s.length;a<f;a++)s[a][$]=0}m()},33)}function m(){u.clearRect(0,0,C,y);if(x&&s)if(!(G<X||la)){var a,f,d,i,g,j,z,q,K=w-x.x,R=F-x.y,v,B,M,ca,da,P,na,Ga=ea.adjustAlpha(S),Ha=ua.adjustAlpha(S);if(fa)u.strokeStyle=Ia.adjustAlpha(S)+"";a=0;for(f=s.length;a<f;a++){g=s[a];B=false;j=g[H];v=new aa(j.length);d=0;for(i=j.length-1;d<i;d+=2){v[d]=z=j[d]-K;v[d+1]=q=j[d+1]-R;B||(B=z>0&&z<C&&q>0&&q<y)}if(B){u.fillStyle=(g[J]?g[J][0].adjustAlpha(S):Ga)+"";d=g[$]?g[I]*Y:g[I];j=ha/(ha-d);z=new aa(v.length-
2);q=[];d=0;for(i=v.length-3;d<i;d+=2){B=v[d];M=v[d+1];ca=v[d+2];da=v[d+3];P={x:~~((B-N)*j+N),y:~~((M-O)*j+O)};na={x:~~((ca-N)*j+N),y:~~((da-O)*j+O)};if((ca-B)*(P.y-M)>(P.x-B)*(da-M)){if(!q.length){q.unshift(M);q.unshift(B);q.push(P.x,P.y)}q.unshift(da);q.unshift(ca);q.push(na.x,na.y)}else{A(q);q=[]}z[d]=P.x;z[d+1]=P.y}A(q);u.fillStyle=(g[J]?g[J][1].adjustAlpha(S):Ha)+"";A(z,fa)}}}}function A(a,f){if(a.length){u.beginPath();u.moveTo(a[0],a[1]);for(var d=2,i=a.length;d<i;d+=2)u.lineTo(a[d],a[d+1]);
u.closePath();f&&u.stroke();u.fill()}}var C=0,y=0,E=0,Q=0,w=0,F=0,G,W,ba,t,u,ja,fa,ea=new D(200,190,180),ua=ea.adjustLightness(0.2),Ia=new D(145,140,135),Z,x,s,S=1,Y=1,ma,X=ga,ka=20,N,O,la=false;this.VERSION="0.1.5a";this.render=function(){this.map&&m();return this};this.setStyle=function(a){if(this.map){a=(a=a)||{};fa=a.strokeRoofs!==undefined?a.strokeRoofs:fa;if(a.fillColor){ea=D.parse(a.fillColor);ua=ea.adjustLightness(0.2)}m()}return this};this.setData=function(a,f){if(this.map)if(a){Z=ra(a,f);
X=0;x={n:90,w:-180,s:-90,e:180,x:0,y:0,z:G};s=b(Z,true);l()}else{Z=null;m()}return this};this.loadData=function(a){if(this.map){ja=a;k()}return this};var oa,pa,qa;this.VERSION+="-leaflet";this.addTo=function(a){a.addLayer(this);return this};this.onAdd=function(a){this.map=a;n(a._panes.overlayPane);ka=a._layersMaxZoom;c(a._size.x,a._size.y);var f=a.getPixelOrigin();e(f.x,f.y);h(a._zoom);var d=0,i=0;oa=function(){var g=L.DomUtil.getPosition(a._mapPane);N=E-(g.x-d);O=y-(g.y-i);m()};pa=function(){var g=
L.DomUtil.getPosition(a._mapPane);d=g.x;i=g.y;t.style.left=-g.x+"px";t.style.top=-g.y+"px";N=E;O=y;c(a._size.x,a._size.y);var j=a.getPixelOrigin();e(j.x-g.x,j.y-g.y);g=o(w,F);j=o(w+C,F+y);if(x&&(g[U]>x.n||g[V]<x.w||j[U]<x.s||j[V]>x.e))k();m()};qa=function(){var g={zoom:a._zoom};la=false;h(g.zoom);if(Z){s=b(Z);m()}else k()};a.on({move:oa,moveend:pa,zoomstart:r,zoomend:qa});if(a.options.zoomAnimation)t.className="leaflet-zoom-animated";a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');
m()};this.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.off({move:oa,moveend:pa,zoomstart:r,zoomend:qa});t.parentNode.removeChild(t);this.map=null};arguments.length&&this.addTo(arguments[0])}}(this);
