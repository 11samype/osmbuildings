var Buildings=function(C){function V(a){g=C.document.createElement("canvas");g.style.webkitTransform="translate3d(0,0,0)";g.style.position="absolute";g.style.pointerEvents="none";g.style.left=0;g.style.top=0;a.appendChild(g);e=g.getContext("2d");e.lineWidth=1;e.lineCap="round";try{e.mozImageSmoothingEnabled=!1}catch(b){}}function m(a,b){var c={},a=a/D,b=b/D;c[s]=0>=b?90:1<=b?-90:W*(2*X(Y(E*(1-2*b)))-Z);c[t]=360*(1===a?1:(a%1+1)%1)-180;return c}function $(a,b){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,i){return b[i]||""})}function aa(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4!==c.readyState||!c.status||200>c.status||299<c.status||c.responseText&&b(JSON.parse(c.responseText))};c.open("GET",a);c.send(null);return c}function L(a){u=a.width;height=a.height;halfWidth=~~(u/2);halfHeight=~~(height/2);F=halfWidth;G=height;g.width=u;g.height=height}function M(a){x=a.x;centerY=a.y}function N(a){v=a.zoom;D=ba<<v;z=1-0.3*(v-A)/(O-A)}function ca(){isZooming=!0;l()}function q(){if(!(v<
A)){var a=m(x-u,centerY-height),b=m(x+u,centerY+height);B&&B.abort();B=aa($(P,{w:a[t],n:a[s],e:b[t],s:b[s],z:v}),da)}}function da(a){var b,c,i,d=[],e=0,k=0;B=null;if(a&&a.meta.z==v){i=a.meta;c=a.data;if(j&&h&&j.z==i.z){e=j.x-i.x;k=j.y-i.y;a=0;for(b=h.length;a<b;a++)d[a]=h[a][1][0]+e+","+(h[a][1][1]+k)}j=i;h=[];a=0;for(b=c.length;a<b;a++)h[a]=c[a],h[a][0]=ea(h[a][0],fa),i=h[a][1][0]+","+h[a][1][1],d&&-1<~~d.indexOf(i)&&(h[a][2]=1);ga()}}function ga(){y=0;clearInterval(H);H=setInterval(function(){y+=
0.1;if(1<y){clearInterval(H);y=1;for(var a=0,b=h.length;a<b;a++)delete h[a][2]}l()},33)}function l(){e.clearRect(0,0,u,height);if(!(v<A||isZooming)){var a=I(Q,z),b=I(R,z),c=I(S,z);e.strokeStyle=c;var i,d,g,k,n,f,r,s=x-halfWidth-j.x,t=centerY-halfHeight-j.y,o,p,l,m,w,q,c=0;for(i=h.length;c<i;c++){k=h[c];p=!1;n=k[1];o=new Int32Array(n.length);d=0;for(g=n.length-1;d<g;d+=2)o[d]=f=n[d]-s,o[d+1]=r=n[d+1]-t,!p&&(p=0<f&&f<u&&0<r&&r<height);if(p){e.fillStyle=a;k=k[2]?k[0]:k[0]*y;n=new Int32Array(o.length-
2);f=[];d=0;for(g=o.length-1-2;d<g;d+=2)r=o[d],p=o[d+1],l=o[d+2],m=o[d+3],w=T(r,p,k),q=T(l,m,k),(l-r)*(w.y-p)>(w.x-r)*(m-p)?(f.length||(f.unshift(p),f.unshift(r),f.push(w.x),f.push(w.y)),f.unshift(m),f.unshift(l),f.push(q.x),f.push(q.y)):(J(f),f=[]),n[d]=w.x,n[d+1]=w.y;J(f);e.fillStyle=b;J(n,U)}}}}function J(a,b){e.beginPath();e.moveTo(a[0],a[1]);for(var c=2,i=a.length;c<i;c+=2)e.lineTo(a[c],a[c+1]);e.closePath();b&&e.stroke();e.fill()}function T(a,b,c){c=K/(K-c);return{x:~~((a-F)*c+F),y:~~((b-G)*
c+G)}}function I(a,b){var c=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);return"rgba("+[c[1],c[2],c[3],c[4]?b*c[5]:b].join()+")"}C.Int32Array=C.Int32Array||Array;var Y=Math.exp,X=Math.atan,ea=Math.min,E=Math.PI,Z=E/2,W=180/E,s="latitude",t="longitude",u=height=halfWidth=halfHeight=0,x=centerY=0,v,D,B,g,e,P,U,Q,R,S,j,h,z=1,y=1,H,ba=256,A=14,O,F=halfWidth,G=height,K=400,fa=K-50;isZooming=!1;return{setMap:function(a,b){V(document.querySelector(".leaflet-control-container"));O=17;L({width:b._size.x,
height:b._size.y});var c=b._size.divideBy(2);M(b._getTopLeftPoint().add(c));N({zoom:b._zoom});var e;window.addEventListener("resize",function(){e=setTimeout(function(){clearTimeout(e);L({width:b._size.x,height:b._size.y});l();q()},100)},!1);b.on("move",function(){var a=b._size.divideBy(2),a=b._getTopLeftPoint().add(a);M(a);l()});b.on("moveend",function(){var a=b._size.divideBy(2);b._getTopLeftPoint().add(a);var a=m(x-halfWidth,centerY-halfHeight),c=m(x+halfWidth,centerY+halfHeight);j&&(a[s]>j.n||
a[t]<j.w||c[s]<j.s||c[t]>j.e)&&q()});b.on("zoomstart",ca);b.on("zoomend",function(){var a={zoom:b._zoom};isZooming=!1;N(a);q()})},render:l,load:function(a,b){P=a;U=!!b.strokeRoofs;Q=b.wallColor||"rgb(200,190,180)";R=b.roofColor||"rgb(250,240,230)";S=b.strokeColor||"rgb(145,140,135)";q()}}}(this);
