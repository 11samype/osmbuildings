(function(x){function pa(a){n=x.document.createElement("canvas");n.style.webkitTransform="translate3d(0,0,0)";n.style.position="absolute";n.style.pointerEvents="none";n.style.left=0;n.style.top=0;a.appendChild(n);h=n.getContext("2d");h.lineCap="round";h.lineJoin="round";h.lineWidth=1;try{h.mozImageSmoothingEnabled=!1}catch(d){}}function N(a,d){var b={},a=a/V,d=d/V;b[t]=0>=d?90:1<=d?-90:qa*(2*ra(sa(q*(1-2*d)))-ea);b[r]=360*(1===a?1:(a%1+1)%1)-180;return b}function ta(a,d){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,c){return d[c]||""})}function ua(a,d){var b=new XMLHttpRequest;b.onreadystatechange=function(){4!==b.readyState||!b.status||200>b.status||299<b.status||b.responseText&&d(JSON.parse(b.responseText))};b.open("GET",a);b.send(null);return b}function O(){if(W&&!(u<P)){var a=N(E-C,F-y),d=N(E+C,F+y);Q&&Q.abort();Q=ua(ta(W,{w:a[r],n:a[t],e:d[r],s:d[t],z:u}),va)}}function fa(a,d,b){var b=b||[],c=a[0]?a:a.features,f,j,i;if(c){a=0;for(f=c.length;a<f;a++)fa(c[a],d,b);return b}"Feature"===a.type&&(f=
a.geometry,i=a.properties);if("Polygon"==f.type&&i.height){j=f.coordinates[0];c=[];a=0;for(f=j.length;a<f;a++)d?(c.push(j[a][1]),c.push(j[a][0])):(c.push(j[a][0]),c.push(j[a][1]));d=[];d[D]=i.height;a=A;f=c.length;j=-90;for(var s=-180,g=180,m,e,k,l=0;l<f-1;l+=2)if(c[l+1]<g?(g=c[l+1],m=l):c[l+1]>s&&(s=c[l+1],e=l),c[l]>j)j=c[l],k=l;m-=k;e-=k;0>m&&(m+=f);0>e&&(e+=f);if("CW"!==(m>e?"CW":"CCW")){e=[];for(k=c.length-2;0<=k;k-=2)e.push(c[k]),e.push(c[k+1]);c=e}d[a]=c;d[G]=i.color;b.push(d)}return b}function ga(a,
d,b){for(var c,f,j=[],i,s,g,m,e=X-d,k=0,l=a.length;k<l;k++){i=a[k][D];s=a[k][A];g=a[k][G];m=new Int32Array(s.length);for(var h=0,o=s.length-1;h<o;h+=2){c=s[h+1];f=ha<<d;var n=R(1,ia(0,0.5-wa(xa(ya+ea*s[h]/180))/q/2));c=~~((c/360+0.5)*f);f=~~(n*f);m[h]=c;m[h+1]=f}j[k]=[];j[k][D]=R(i>>e,ja);j[k][A]=m;j[k][G]=g;j[k][S]=b}return j}function ka(a,d){C=a;y=d;H=~~(C/2);T=~~(y/2);K=H;L=y;n.width=C;n.height=y}function la(a,d){E=a;F=d}function ma(a){u=a;V=ha<<u;I=1-0.3*(u-P)/(X-P)}function za(){Y=!0;v()}function va(a){var d,
b,c,f=[],j=0,i=0;Q=null;if(a&&a.meta.z===u){c=a.meta;b=a.data;if(o&&g&&o.z===c.z){j=o.x-c.x;i=o.y-c.y;a=0;for(d=g.length;a<d;a++)f[a]=g[a][A][0]+j+","+(g[a][A][1]+i)}o=c;g=[];a=0;for(d=b.length;a<d;a++)g[a]=b[a],g[a][D]=R(g[a][D],ja),c=g[a][A][0]+","+g[a][A][1],g[a][S]=!(f&&~f.indexOf(c));na()}}function na(){J=0;clearInterval(Z);Z=setInterval(function(){J+=0.1;if(1<J){clearInterval(Z);J=1;for(var a=0,d=g.length;a<d;a++)g[a][S]=0}v()},33)}function v(){var a,d,b,c;h.clearRect(0,0,C,y);if(o&&g&&!(u<
P||Y)){var f=M(U,I),j=M(oa,I),i=M(Aa,I),s,n;h.strokeStyle=i;var m,e,k,l,v=E-H-o.x,B=F-T-o.y,z,t,p,q,r,w,x,i=0;for(m=g.length;i<m;i++){a=g[i];a[G]&&(s=M(a[G],I),n=M($(a[G],0.2),I));l=!1;d=a[A];z=new Int32Array(d.length);e=0;for(k=d.length-1;e<k;e+=2)z[e]=b=d[e]-v,z[e+1]=c=d[e+1]-B,l||(l=0<b&&b<C&&0<c&&c<y);if(l){h.fillStyle=s||f;e=a[S]?a[D]*J:a[D];l=aa/(aa-e);t=new Int32Array(z.length-2);p=[];e=0;for(k=z.length-3;e<k;e+=2)q=z[e],r=z[e+1],w=z[e+2],x=z[e+3],b=~~((q-K)*l+K),c=~~((r-L)*l+L),a=~~((w-K)*
l+K),d=~~((x-L)*l+L),(w-q)*(c-r)>(b-q)*(x-r)?(p.length||(p.unshift(r),p.unshift(q),p.push(b),p.push(c)),p.unshift(x),p.unshift(w),p.push(a),p.push(d)):(ba(p),p=[]),t[e]=b,t[e+1]=c;ba(p);h.fillStyle=n||j;ba(t,ca)}}}}function ba(a,d){if(a.length){h.beginPath();h.moveTo(a[0],a[1]);for(var b=2,c=a.length;b<c;b+=2)h.lineTo(a[b],a[b+1]);h.closePath();d&&h.stroke();h.fill()}}function M(a,d){var b=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);return"rgba("+[b[1],b[2],b[3],b[4]?d*b[5]:d].join()+")"}function da(a,
d,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(d-a)*b:0.5>b?d:b<2/3?a+6*(d-a)*(2/3-b):a}function $(a,d){var b,c,f,j=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);b=j[1];c=j[2];var i=j[3];b/=255;c/=255;var i=i/255,g=Math.max(b,c,i),h=Math.min(b,c,i),m;f=(g+h)/2;var e;if(g==h)m=h=0;else{e=g-h;h=0.5<f?e/(2-g-h):e/(g+h);switch(g){case b:m=(c-i)/e+(c<i?6:0);break;case c:m=(i-b)/e+2;break;case i:m=(b-c)/e+4}m/=6}b=m;c=h;f=R(1,ia(0,f+d));0==c?f=c=b=f:(i=0.5>f?f*(1+c):f+c-f*c,g=2*f-i,f=da(g,i,b+1/3),
c=da(g,i,b),b=da(g,i,b-1/3));a={r:~~(255*f),g:~~(255*c),b:~~(255*b)};return"rgba("+[a.r,a.g,a.b,j[4]?j[5]:1].join()+")"}x.Int32Array=x.Int32Array||Array;var sa=Math.exp,wa=Math.log,xa=Math.tan,ra=Math.atan,R=Math.min,ia=Math.max,q=Math.PI,ea=q/2,ya=q/4,qa=180/q,t="latitude",r="longitude",D=0,A=1,G=2,S=3,C=0,y=0,H=0,T=0,E=0,F=0,u,V,Q,n,h,W,ca,U="rgb(200,190,180)",oa=$(U,0.2),Aa="rgb(145,140,135)",w,o,g,I=1,J=1,Z,ha=256,P=14,X,K=H,L=y,aa=400,ja=aa-50,Y=!1,B=x.OSMBuildings=function(a){this.addTo(a)};
B.prototype.VERSION="0.1a";B.prototype.render=function(){if(this.map)return v(),this};B.prototype.setStyle=function(a){if(this.map)return a=a||{},ca=void 0!==a.strokeRoofs?a.strokeRoofs:ca,a.fillColor&&(U=a.fillColor,oa=$(U,0.2)),v(),this};B.prototype.setData=function(a,d){if(this.map)return a?(w=fa(a,d),o={n:90,w:-180,s:-90,e:180,x:0,y:0,z:u},g=ga(w,u,!0),na()):(w=null,v()),this};B.prototype.loadData=function(a){if(this.map)return W=a,O(),this};(function(a){a.VERSION+="-leaflet-patch";a.addTo=function(a){function b(){var b=
a._size.divideBy(2);return a._getTopLeftPoint().add(b)}this.map=a;pa(document.querySelector(".leaflet-container"));X=a._layersMaxZoom;ka(a._size.x,a._size.y);var c=b();la(c.x,c.y);ma(a._zoom);var f;window.addEventListener("resize",function(){f=setTimeout(function(){clearTimeout(f);ka(a._size.x,a._size.y);v();O()},100)},!1);a.on({move:function(){var a=b();la(a.x,a.y);v()},moveend:function(){b();var a=N(E-H,F-T),c=N(E+H,F+T);o&&(a[t]>o.n||a[r]<o.w||c[t]<o.s||c[r]>o.e)&&O()},zoomstart:za,zoomend:function(){var b=
a._zoom;Y=!1;ma(b);w?(g=ga(w,u),v()):O()}});a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');return this};a.removeFrom=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.off({});n.parentNode.removeChild(n);this.map=null;return this}})(B.prototype)})(this);
