(function(x){function ra(a){n=x.document.createElement("canvas");n.style.webkitTransform="translate3d(0,0,0)";n.style.position="absolute";n.style.pointerEvents="none";n.style.left=0;n.style.top=0;a.appendChild(n);g=n.getContext("2d");g.lineCap="round";g.lineJoin="round";g.lineWidth=1;try{g.mozImageSmoothingEnabled=!1}catch(d){}}function O(a,d){var b={},a=a/W,d=d/W;b[u]=0>=d?90:1<=d?-90:sa*(2*ta(ua(q*(1-2*d)))-fa);b[r]=360*(1===a?1:(a%1+1)%1)-180;return b}function ga(a,d){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,c){return d[c]||""})}function va(a,d){var b=new XMLHttpRequest;b.onreadystatechange=function(){4!==b.readyState||!b.status||200>b.status||299<b.status||b.responseText&&d(JSON.parse(b.responseText))};b.open("GET",a);b.send(null);return b}function P(){if(X&&!(v<Q)){var a=O(E-C,F-y),d=O(E+C,F+y);R&&R.abort();R=va(ga(X,{w:a[r],n:a[u],e:d[r],s:d[u],z:v}),wa)}}function ha(a,d,b){var b=b||[],c=a[0]?a:a.features,f,j,i;if(c){a=0;for(f=c.length;a<f;a++)ha(c[a],d,b);return b}"Feature"===a.type&&(f=
a.geometry,i=a.properties);if("Polygon"==f.type&&i.height){j=f.coordinates[0];c=[];a=0;for(f=j.length;a<f;a++)d?(c.push(j[a][1]),c.push(j[a][0])):(c.push(j[a][0]),c.push(j[a][1]));d=[];d[D]=i.height;a=A;f=c.length;j=-90;for(var s=-180,h=180,m,e,k,l=0;l<f-1;l+=2)if(c[l+1]<h?(h=c[l+1],m=l):c[l+1]>s&&(s=c[l+1],e=l),c[l]>j)j=c[l],k=l;m-=k;e-=k;0>m&&(m+=f);0>e&&(e+=f);if("CW"!==(m>e?"CW":"CCW")){e=[];for(k=c.length-2;0<=k;k-=2)e.push(c[k]),e.push(c[k+1]);c=e}d[a]=c;d[G]=i.color;b.push(d)}return b}function ia(a,
d,b){for(var c,f,j=[],i,s,h,m,e=Y-d,k=0,l=a.length;k<l;k++){i=a[k][D];s=a[k][A];h=a[k][G];m=new Int32Array(s.length);for(var g=0,o=s.length-1;g<o;g+=2){c=s[g+1];f=ja<<d;var n=S(1,ka(0,0.5-xa(ya(za+fa*s[g]/180))/q/2));c=~~((c/360+0.5)*f);f=~~(n*f);m[g]=c;m[g+1]=f}j[k]=[];j[k][D]=S(i>>e,la);j[k][A]=m;j[k][G]=h;j[k][T]=b}return j}function ma(a,d){C=a;y=d;H=~~(C/2);U=~~(y/2);K=H;M=y;n.width=C;n.height=y}function na(a,d){E=a;F=d}function oa(a){v=a;W=ja<<v;I=1-0.3*(v-Q)/(Y-Q)}function Aa(){var a=O(E-H,
F-U),d=O(E+H,F+U);o&&(a[u]>o.n||a[r]<o.w||d[u]<o.s||d[r]>o.e)&&P()}function Ba(){Z=!0;t()}function wa(a){var d,b,c,f=[],j=0,i=0;R=null;if(a&&a.meta.z===v){c=a.meta;b=a.data;if(o&&h&&o.z===c.z){j=o.x-c.x;i=o.y-c.y;a=0;for(d=h.length;a<d;a++)f[a]=h[a][A][0]+j+","+(h[a][A][1]+i)}o=c;h=[];a=0;for(d=b.length;a<d;a++)h[a]=b[a],h[a][D]=S(h[a][D],la),c=h[a][A][0]+","+h[a][A][1],h[a][T]=!(f&&~f.indexOf(c));pa()}}function pa(){J=0;clearInterval($);$=setInterval(function(){J+=0.1;if(1<J){clearInterval($);J=
1;for(var a=0,d=h.length;a<d;a++)h[a][T]=0}t()},33)}function t(){var a,d,b,c;g.clearRect(0,0,C,y);if(o&&h&&!(v<Q||Z)){var f=N(V,I),j=N(qa,I),i=N(Ca,I),s,n;g.strokeStyle=i;var m,e,k,l,t=E-H-o.x,B=F-U-o.y,z,u,p,q,r,w,x,i=0;for(m=h.length;i<m;i++){a=h[i];a[G]&&(s=N(a[G],I),n=N(aa(a[G],0.2),I));l=!1;d=a[A];z=new Int32Array(d.length);e=0;for(k=d.length-1;e<k;e+=2)z[e]=b=d[e]-t,z[e+1]=c=d[e+1]-B,l||(l=0<b&&b<C&&0<c&&c<y);if(l){g.fillStyle=s||f;e=a[T]?a[D]*J:a[D];l=ba/(ba-e);u=new Int32Array(z.length-2);
p=[];e=0;for(k=z.length-3;e<k;e+=2)q=z[e],r=z[e+1],w=z[e+2],x=z[e+3],b=~~((q-K)*l+K),c=~~((r-M)*l+M),a=~~((w-K)*l+K),d=~~((x-M)*l+M),(w-q)*(c-r)>(b-q)*(x-r)?(p.length||(p.unshift(r),p.unshift(q),p.push(b),p.push(c)),p.unshift(x),p.unshift(w),p.push(a),p.push(d)):(ca(p),p=[]),u[e]=b,u[e+1]=c;ca(p);g.fillStyle=n||j;ca(u,da)}}}}function ca(a,d){if(a.length){g.beginPath();g.moveTo(a[0],a[1]);for(var b=2,c=a.length;b<c;b+=2)g.lineTo(a[b],a[b+1]);g.closePath();d&&g.stroke();g.fill()}}function N(a,d){var b=
a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);return"rgba("+[b[1],b[2],b[3],b[4]?d*b[5]:d].join()+")"}function ea(a,d,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(d-a)*b:0.5>b?d:b<2/3?a+6*(d-a)*(2/3-b):a}function aa(a,d){var b,c,f,j=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);b=j[1];c=j[2];var i=j[3];b/=255;c/=255;var i=i/255,h=Math.max(b,c,i),g=Math.min(b,c,i),m;f=(h+g)/2;var e;if(h==g)m=g=0;else{e=h-g;g=0.5<f?e/(2-h-g):e/(h+g);switch(h){case b:m=(c-i)/e+(c<i?6:0);break;case c:m=(i-b)/
e+2;break;case i:m=(b-c)/e+4}m/=6}b=m;c=g;f=S(1,ka(0,f+d));0==c?f=c=b=f:(i=0.5>f?f*(1+c):f+c-f*c,h=2*f-i,f=ea(h,i,b+1/3),c=ea(h,i,b),b=ea(h,i,b-1/3));a={r:~~(255*f),g:~~(255*c),b:~~(255*b)};return"rgba("+[a.r,a.g,a.b,j[4]?j[5]:1].join()+")"}x.Int32Array=x.Int32Array||Array;var ua=Math.exp,xa=Math.log,ya=Math.tan,ta=Math.atan,S=Math.min,ka=Math.max,q=Math.PI,fa=q/2,za=q/4,sa=180/q,u="latitude",r="longitude",D=0,A=1,G=2,T=3,C=0,y=0,H=0,U=0,E=0,F=0,v,W,R,n,g,X,da,V="rgb(200,190,180)",qa=aa(V,0.2),Ca=
"rgb(145,140,135)",w,o,h,I=1,J=1,$,ja=256,Q=14,Y,K=H,M=y,ba=400,la=ba-50,Z=!1,B=x.OSMBuildings=function(a){this.addTo(a)};B.prototype.VERSION="0.1a";B.prototype.render=function(){if(this.map)return t(),this};B.prototype.setStyle=function(a){if(this.map)return a=a||{},da=void 0!==a.strokeRoofs?a.strokeRoofs:da,a.fillColor&&(V=a.fillColor,qa=aa(V,0.2)),t(),this};B.prototype.setData=function(a,d){if(this.map)return a?(w=ha(a,d),o={n:90,w:-180,s:-90,e:180,x:0,y:0,z:v},h=ia(w,v,!0),pa()):(w=null,t()),
this};B.prototype.loadData=function(a){if(this.map)return X=a,P(),this};(function(a){ga=L.Util.template;var d;a.VERSION+="-leaflet-patch";a.addTo=function(a){a.addLayer(this);return this};a.onAdd=function(a){function c(){var c=a._size.divideBy(2);return a._getTopLeftPoint().add(c)}this.map=a;ra(document.querySelector(".leaflet-container"));Y=a._layersMaxZoom;ma(a._size.x,a._size.y);var f=c();na(f.x,f.y);oa(a._zoom);var g;window.addEventListener("resize",function(){g=setTimeout(function(){clearTimeout(g);
ma(a._size.x,a._size.y);t();P()},100)},!1);a.on({move:function(){var a=c();na(a.x,a.y);t()},moveend:Aa,zoomstart:Ba,zoomend:function(){var c=a._zoom;Z=!1;oa(c);w?(h=ia(w,v),t()):P()}});d=a.options.inertia;a.options.inertia=!1;a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');t()};a.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.options.inertia=d;a.off({});
n.parentNode.removeChild(n);this.map=null}})(B.prototype)})(this);
