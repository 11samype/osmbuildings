(function(r){function h(a,b,c,d){this.r=a;this.g=b;this.b=c;this.a=4>arguments.length?1:d}function ma(a){l=r.document.createElement("canvas");l.style.webkitTransform="translate3d(0,0,0)";l.style.position="absolute";l.style.pointerEvents="none";l.style.left=0;l.style.top=0;l.style.imageRendering="optimizeSpeed";a.appendChild(l);n=l.getContext("2d");n.lineCap="round";n.lineJoin="round";n.lineWidth=1;try{n.mozImageSmoothingEnabled=!1}catch(b){}}function N(a,b){var c={},a=a/T,b=b/T;c[u]=0>=b?90:1<=b?
-90:na*(2*oa(pa(v*(1-2*b)))-ca);c[z]=360*(1===a?1:(a%1+1)%1)-180;return c}function qa(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,d){return b[d]||""})}function ra(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4!==c.readyState||!c.status||200>c.status||299<c.status||c.responseText&&b(JSON.parse(c.responseText))};c.open("GET",a);c.send(null);return c}function U(){if(V&&!(w<O)){var a=N(H-s,I-W),b=N(H+A+s,I+x+W);P&&P.abort();P=ra(qa(V,{w:a[z],n:a[u],e:b[z],s:b[u],z:w}),sa)}}function da(a,
b,c){var c=c||[],d=a[0]?a:a.features,f,j,e,J=b?1:0,i=b?0:1;if(d){a=0;for(f=d.length;a<f;a++)da(d[a],b,c);return c}"Feature"===a.type&&(f=a.geometry,j=a.properties);if("Polygon"==f.type){d=f.coordinates[0];b=[];a=e=0;for(f=d.length;a<f;a++)b.push(d[a][J]),b.push(d[a][i]),e+=d[a][2]||0;if(e){J=[];J[B]=~~(e/d.length);var i=y,m;a=b.length;f=-90;d=-180;e=180;for(var C,g,k=0;k<a-1;k+=2)if(b[k+1]<e?(e=b[k+1],C=k):b[k+1]>d&&(d=b[k+1],m=k),b[k]>f)f=b[k],g=k;C-=g;m-=g;0>C&&(C+=a);0>m&&(m+=a);if("CW"===(C>m?
"CW":"CCW"))m=b;else{m=[];for(g=b.length-2;0<=g;g-=2)m.push(b[g]),m.push(b[g+1])}J[i]=m;j.color&&(j=h.parse(j.color),J[D]=[j,j.adjustLightness(0.2)]);c.push(J)}}return c}function ea(a,b,c){var d,f,j=[],e,g,i,m,h,l,k,n=X-b;e=0;for(g=a.length;e<g;e++){h=a[e];l=h[y];k=new Int32Array(l.length);i=0;for(m=l.length-1;i<m;i+=2){d=l[i+1];f=fa<<b;var o=Y(1,ta(0,0.5-ua(va(wa+ca*l[i]/180))/v/2));d=~~((d/360+0.5)*f);f=~~(o*f);k[i]=d;k[i+1]=f}j[e]=[];j[e][B]=Y(h[B]>>n,ga);j[e][y]=k;j[e][D]=h[D];j[e][Q]=c}return j}
function ha(a,b){A=a;x=b;s=~~(A/2);W=~~(x/2);E=s;F=x;l.width=A;l.height=x}function ia(a,b){H=a;I=b}function ja(a){w=a;T=fa<<w;K=1-0.3*(w-O)/(X-O)}function xa(){Z=!0;t()}function sa(a){var b,c,d,f=[],j=0,e=0;P=null;if(a&&a.meta.z===w){d=a.meta;c=a.data;if(p&&g&&p.z===d.z){j=p.x-d.x;e=p.y-d.y;a=0;for(b=g.length;a<b;a++)f[a]=g[a][y][0]+j+","+(g[a][y][1]+e)}p=d;g=[];a=0;for(b=c.length;a<b;a++)g[a]=c[a],g[a][B]=Y(g[a][B],ga),d=g[a][y][0]+","+g[a][y][1],g[a][Q]=!(f&&~f.indexOf(d));ka()}}function ka(){M=
0;clearInterval($);$=setInterval(function(){M+=0.1;if(1<M){clearInterval($);M=1;for(var a=0,b=g.length;a<b;a++)g[a][Q]=0}t()},33)}function t(){var a,b,c,d;n.clearRect(0,0,A,x);if(p&&g&&!(w<O||Z)){var f,j,e,h,i,m,l=H-p.x,t=I-p.y,k,s,o,q,r,u,v,z=R.adjustAlpha(K),G=la.adjustAlpha(K);S&&(n.strokeStyle=ya.adjustAlpha(K)+"");f=0;for(j=g.length;f<j;f++){i=g[f];d=!1;a=i[y];k=new Int32Array(a.length);e=0;for(h=a.length-1;e<h;e+=2)k[e]=b=a[e]-l,k[e+1]=c=a[e+1]-t,d||(d=0<b&&b<A&&0<c&&c<x);if(d){n.fillStyle=
(i[D]?i[D][0].adjustAlpha(K):z)+"";e=i[Q]?i[B]*M:i[B];m=aa/(aa-e);s=new Int32Array(k.length-2);o=[];e=0;for(h=k.length-3;e<h;e+=2)q=k[e],r=k[e+1],u=k[e+2],v=k[e+3],c=~~((q-E)*m+E),d=~~((r-F)*m+F),a=~~((u-E)*m+E),b=~~((v-F)*m+F),(u-q)*(d-r)>(c-q)*(v-r)?(o.length||(o.unshift(r),o.unshift(q),o.push(c),o.push(d)),o.unshift(v),o.unshift(u),o.push(a),o.push(b)):(ba(o),o=[]),s[e]=c,s[e+1]=d;ba(o);n.fillStyle=(i[D]?i[D][1].adjustAlpha(K):G)+"";ba(s,S)}}}}function ba(a,b){if(a.length){n.beginPath();n.moveTo(a[0],
a[1]);for(var c=2,d=a.length;c<d;c+=2)n.lineTo(a[c],a[c+1]);n.closePath();b&&n.stroke();n.fill()}}r.Int32Array=r.Int32Array||r.Array;h.prototype.toString=function(){return"rgba("+[this.r,this.g,this.b,this.a].join()+")"};h.prototype.adjustLightness=function(a){var b=h.toHSLA(this);b.l+=a;b.l=Math.min(1,Math.max(0,b.l));return h.toRGB(b)};h.prototype.adjustAlpha=function(a){return new h(this.r,this.g,this.b,this.a*a)};h.parse=function(a){if(~a.indexOf("#"))return a=a.match(/^#?(\w{2})(\w{2})(\w{2})$/),
new h(parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16));a=a.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/);return new h(a[1],a[2],a[3],a[4]?a[5]:1)};h.toHSLA=function(a){var b=a.r/255,c=a.g/255,d=a.b/255,f=Math.max(b,c,d),j=Math.min(b,c,d),e,g=(f+j)/2,i;if(f==j)e=j=0;else{i=f-j;j=0.5<g?i/(2-f-j):i/(f+j);switch(f){case b:e=(c-d)/i+(c<d?6:0);break;case c:e=(d-b)/i+2;break;case d:e=(b-c)/i+4}e/=6}return{h:e,s:j,l:g,a:a.a}};h.toRGB=function(a){var b,c,d;if(0==a.s)b=c=d=a.l;else{d=0.5>a.l?
a.l*(1+a.s):a.l+a.s-a.l*a.s;var f=2*a.l-d;b=h.hueToRGB(f,d,a.h+1/3);c=h.hueToRGB(f,d,a.h);d=h.hueToRGB(f,d,a.h-1/3)}return new h(~~(255*b),~~(255*c),~~(255*d),a.a)};h.hueToRGB=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a};var pa=Math.exp,ua=Math.log,va=Math.tan,oa=Math.atan,Y=Math.min,ta=Math.max,v=Math.PI,ca=v/2,wa=v/4,na=180/v,u="latitude",z="longitude",B=0,y=1,D=2,Q=3,A=0,x=0,s=0,W=0,H=0,I=0,w,T,P,l,n,V,S,R=new h(200,190,180),la=R.adjustLightness(0.2),
ya=new h(145,140,135),G,p,g,K=1,M=1,$,fa=256,O=14,X,E,F,aa=400,ga=aa-50,Z=!1,q=r.OSMBuildings=function(a){this.addTo(a)};q.prototype.VERSION="0.1a";q.prototype.render=function(){this.map&&t();return this};q.prototype.setStyle=function(a){this.map&&(a=a||{},S=void 0!==a.strokeRoofs?a.strokeRoofs:S,a.fillColor&&(R=h.parse(a.fillColor),la=R.adjustLightness(0.2)),t());return this};q.prototype.setData=function(a,b){this.map&&(a?(G=da(a,b),p={n:90,w:-180,s:-90,e:180,x:0,y:0,z:w},g=ea(G,w,!0),ka()):(G=null,
t()));return this};q.prototype.loadData=function(a){this.map&&(V=a,U());return this};(function(a){var b,c,d,f;a.VERSION+="-leaflet";a.addTo=function(a){a.addLayer(this);return this};a.onAdd=function(a){this.map=a;ma(a._panes.overlayPane);X=a._layersMaxZoom;ha(a._size.x,a._size.y);var e=a.getPixelOrigin();ia(e.x,e.y);ja(a._zoom);var h=0,i=0;b=function(){var b=L.DomUtil.getPosition(a._mapPane);E=s-(b.x-h);F=x-(b.y-i);t()};c=function(){var b=L.DomUtil.getPosition(a._mapPane);h=b.x;i=b.y;l.style.left=
-b.x+"px";l.style.top=-b.y+"px";E=s;F=x;ha(a._size.x,a._size.y);var c=a.getPixelOrigin();ia(c.x-b.x,c.y-b.y);b=N(H,I);c=N(H+A,I+x);p&&(b[u]>p.n||b[z]<p.w||c[u]<p.s||c[z]>p.e)&&U();t()};d=xa;f=function(){var b=a._zoom;Z=!1;ja(b);G?(g=ea(G,w),t()):U()};a.on({move:b,moveend:c,zoomstart:d,zoomend:f});a.options.zoomAnimation&&(l.className="leaflet-zoom-animated");a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');t()};a.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');
a.off({move:b,moveend:c,zoomstart:d,zoomend:f});l.parentNode.removeChild(l);this.map=null}})(q.prototype)})(this);
