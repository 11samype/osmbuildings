var OSMBuildings=function(ua){function va(e,f){return e.replace(/\{ *([\w_]+) *\}/g,function(m,b){return f[b]||""})}function wa(e,f){var m=new XMLHttpRequest;m.onreadystatechange=function(){if(m.readyState===4)!m.status||m.status<200||m.status>299||m.responseText&&f(JSON.parse(m.responseText))};m.open("GET",e);m.send(null);return m}function qa(e,f,m){if(m===undefined)m=[];var b=e[0]?e:e.features,c,g,j,o=f?1:0,u=f?0:1;if(b){e=0;for(c=b.length;e<c;e++)qa(b[e],f,m);return m}if(e.type==="Feature"){c=
e.geometry;g=e.properties}if(c.type==="Polygon"){b=c.coordinates[0];f=[];e=j=0;for(c=b.length;e<c;e++){f.push(b[e][o]);f.push(b[e][u]);j+=b[e][2]||0}if(j){o=[];o[E]=~~(j/b.length);u=D;var y=0,p,w;p=0;for(w=f.length-3;p<w;p+=2){e=f[p];c=f[p+1];b=f[p+2];j=f[p+3];y+=e*j-b*c}if((y/2>0?"CW":"CCW")==="CW")f=f;else{e=[];for(c=f.length-2;c>=0;c-=2){e.push(f[c]);e.push(f[c+1])}f=e}o[u]=f;if(g.color){g=B.parse(g.color);o[F]=[g,g.adjustLightness(0.2)]}m.push(o)}}return m}var Y=Y||Array,xa=Math.exp,ya=Math.log,
za=Math.tan,Aa=Math.atan,fa=Math.min,Ba=Math.max,B=function(){function e(b,c,g){if(g<0)g+=1;if(g>1)g-=1;if(g<1/6)return b+(c-b)*6*g;if(g<0.5)return c;if(g<2/3)return b+(c-b)*(2/3-g)*6;return b}function f(b,c,g,j){this.r=b;this.g=c;this.b=g;this.a=arguments.length<4?1:j}var m=f.prototype;m.toString=function(){return"rgba("+[this.r,this.g,this.b,this.a].join(",")+")"};m.adjustLightness=function(b){var c=B.toHSLA(this);c.l+=b;c.l=Math.min(1,Math.max(0,c.l));var g,j;if(c.s===0)b=g=j=c.l;else{j=c.l<0.5?
c.l*(1+c.s):c.l+c.s-c.l*c.s;var o=2*c.l-j;b=e(o,j,c.h+1/3);g=e(o,j,c.h);j=e(o,j,c.h-1/3)}return new B(~~(b*255),~~(g*255),~~(j*255),c.a)};m.adjustAlpha=function(b){return new B(this.r,this.g,this.b,this.a*b)};f.parse=function(b){if(~b.indexOf("#")){b=b.match(/^#?(\w{2})(\w{2})(\w{2})$/);return new B(parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16))}b=b.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/);return new B(b[1],b[2],b[3],b[4]?b[5]:1)};f.toHSLA=function(b){var c=b.r/255,g=b.g/255,
j=b.b/255,o=Math.max(c,g,j),u=Math.min(c,g,j),y,p=(o+u)/2,w;if(o===u)y=u=0;else{w=o-u;u=p>0.5?w/(2-o-u):w/(o+u);switch(o){case c:y=(g-j)/w+(g<j?6:0);break;case g:y=(j-c)/w+2;break;case j:y=(c-g)/w+4;break}y/=6}return{h:y,s:u,l:p,a:b.a}};return f}(),S=Math.PI,ra=S/2,Ca=S/4,Da=180/S,Ea=256,Z=14,ga=400,sa=ga-50,T="latitude",U="longitude",E=0,D=1,F=2,$=3;return function(){function e(a){r=ua.document.createElement("canvas");r.style.webkitTransform="translate3d(0,0,0)";r.style.position="absolute";r.style.pointerEvents=
"none";r.style.left=0;r.style.top=0;r.style.imageRendering="optimizeSpeed";a.appendChild(r);s=r.getContext("2d");s.lineCap="round";s.lineJoin="round";s.lineWidth=1;try{s.mozImageSmoothingEnabled=false}catch(h){}}function f(a,h){var d={};a/=V;h/=V;d[T]=h<=0?90:h>=1?-90:Da*(2*Aa(xa(S*(1-2*h)))-ra);d[U]=(a===1?1:(a%1+1)%1)*360-180;return d}function m(){if(!(!ha||C<Z)){var a=f(N-O,P-ia),h=f(N+G+O,P+A+ia);aa&&aa.abort();aa=wa(va(ha,{w:a[U],n:a[T],e:h[U],s:h[T],z:C}),u)}}function b(a,h){var d=[],k,i,l,
x,n,H,Q,t,z=ja-C;k=0;for(i=a.length;k<i;k++){n=a[k];H=n[D];Q=new Y(H.length);l=0;for(x=H.length-1;l<x;l+=2){t=H[l+1];var I=fa(1,Ba(0,0.5-ya(za(Ca+ra*H[l]/180))/S/2));t={x:~~((t/360+0.5)*V),y:~~(I*V)};Q[l]=t.x;Q[l+1]=t.y}d[k]=[];d[k][E]=fa(n[E]>>z,sa);d[k][D]=Q;d[k][F]=n[F];d[k][$]=h}return d}function c(a,h){G=a;A=h;O=~~(G/2);ia=~~(A/2);J=O;K=A;r.width=G;r.height=A}function g(a,h){N=a;P=h}function j(a){C=a;V=Ea<<C;R=1-(C-Z)*0.3/(ja-Z)}function o(){ka=true;p()}function u(a){var h,d,k,i=[],l=0,x=0;aa=
null;if(!(!a||a.meta.z!==C)){k=a.meta;d=a.data;if(v&&q&&v.z===k.z){l=v.x-k.x;x=v.y-k.y;a=0;for(h=q.length;a<h;a++)i[a]=q[a][D][0]+l+","+(q[a][D][1]+x)}v=k;q=[];a=0;for(h=d.length;a<h;a++){q[a]=d[a];q[a][E]=fa(q[a][E],sa);k=q[a][D][0]+","+q[a][D][1];q[a][$]=!(i&&~i.indexOf(k))}y()}}function y(){W=0;clearInterval(la);la=setInterval(function(){W+=0.1;if(W>1){clearInterval(la);W=1;for(var a=0,h=q.length;a<h;a++)q[a][$]=0}p()},33)}function p(){s.clearRect(0,0,G,A);if(v&&q)if(!(C<Z||ka)){var a,h,d,k,i,
l,x,n,H=N-v.x,Q=P-v.y,t,z,I,ba,ca,M,ma,Fa=da.adjustAlpha(R),Ga=ta.adjustAlpha(R);if(ea)s.strokeStyle=Ha.adjustAlpha(R)+"";a=0;for(h=q.length;a<h;a++){i=q[a];z=false;l=i[D];t=new Y(l.length);d=0;for(k=l.length-1;d<k;d+=2){t[d]=x=l[d]-H;t[d+1]=n=l[d+1]-Q;z||(z=x>0&&x<G&&n>0&&n<A)}if(z){s.fillStyle=(i[F]?i[F][0].adjustAlpha(R):Fa)+"";d=i[$]?i[E]*W:i[E];l=ga/(ga-d);x=new Y(t.length-2);n=[];d=0;for(k=t.length-3;d<k;d+=2){z=t[d];I=t[d+1];ba=t[d+2];ca=t[d+3];M={x:~~((z-J)*l+J),y:~~((I-K)*l+K)};ma={x:~~((ba-
J)*l+J),y:~~((ca-K)*l+K)};if((ba-z)*(M.y-I)>(M.x-z)*(ca-I)){if(!n.length){n.unshift(I);n.unshift(z);n.push(M.x);n.push(M.y)}n.unshift(ca);n.unshift(ba);n.push(ma.x);n.push(ma.y)}else{w(n);n=[]}x[d]=M.x;x[d+1]=M.y}w(n);s.fillStyle=(i[F]?i[F][1].adjustAlpha(R):Ga)+"";w(x,ea)}}}}function w(a,h){if(a.length){s.beginPath();s.moveTo(a[0],a[1]);for(var d=2,k=a.length;d<k;d+=2)s.lineTo(a[d],a[d+1]);s.closePath();h&&s.stroke();s.fill()}}var G=0,A=0,O=0,ia=0,N=0,P=0,C,V,aa,r,s,ha,ea,da=new B(200,190,180),ta=
da.adjustLightness(0.2),Ha=new B(145,140,135),X,v,q,R=1,W=1,la,ja=20,J,K,ka=false;this.VERSION="0.1.5a";this.render=function(){this.map&&p();return this};this.setStyle=function(a){if(this.map){a=(a=a)||{};ea=a.strokeRoofs!==undefined?a.strokeRoofs:ea;if(a.fillColor){da=B.parse(a.fillColor);ta=da.adjustLightness(0.2)}p()}return this};this.setData=function(a,h){if(this.map)if(a){X=qa(a,h);v={n:90,w:-180,s:-90,e:180,x:0,y:0,z:C};q=b(X,true);y()}else{X=null;p()}return this};this.loadData=function(a){if(this.map){ha=
a;m()}return this};var na,oa,pa;this.VERSION+="-leaflet";this.addTo=function(a){a.addLayer(this);return this};this.onAdd=function(a){this.map=a;e(a._panes.overlayPane);ja=a._layersMaxZoom;c(a._size.x,a._size.y);var h=a.getPixelOrigin();g(h.x,h.y);j(a._zoom);var d=0,k=0;na=function(){var i=L.DomUtil.getPosition(a._mapPane);J=O-(i.x-d);K=A-(i.y-k);p()};oa=function(){var i=L.DomUtil.getPosition(a._mapPane);d=i.x;k=i.y;r.style.left=-i.x+"px";r.style.top=-i.y+"px";J=O;K=A;c(a._size.x,a._size.y);var l=
a.getPixelOrigin();g(l.x-i.x,l.y-i.y);i=f(N,P);l=f(N+G,P+A);if(v&&(i[T]>v.n||i[U]<v.w||l[T]<v.s||l[U]>v.e))m();p()};pa=function(){var i={zoom:a._zoom};ka=false;j(i.zoom);if(X){q=b(X);p()}else m()};a.on({move:na,moveend:oa,zoomstart:o,zoomend:pa});if(a.options.zoomAnimation)r.className="leaflet-zoom-animated";a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');p()};this.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');
a.off({move:na,moveend:oa,zoomstart:o,zoomend:pa});r.parentNode.removeChild(r);this.map=null};arguments.length&&this.addTo(arguments[0])}}(this);
