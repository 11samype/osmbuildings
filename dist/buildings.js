(function(s){function qa(a){n=s.document.createElement("canvas");n.style.webkitTransform="translate3d(0,0,0)";n.style.position="absolute";n.style.pointerEvents="none";n.style.left=0;n.style.top=0;a.appendChild(n);g=n.getContext("2d");g.lineCap="round";g.lineJoin="round";g.lineWidth=1;try{g.mozImageSmoothingEnabled=!1}catch(d){}}function O(a,d){var b={},a=a/V,d=d/V;b[t]=0>=d?90:1<=d?-90:ra*(2*sa(ta(v*(1-2*d)))-fa);b[w]=360*(1===a?1:(a%1+1)%1)-180;return b}function ua(a,d){return a.replace(/\{ *([\w_]+) *\}/g,
function(a,c){return d[c]||""})}function va(a,d){var b=new XMLHttpRequest;b.onreadystatechange=function(){4!==b.readyState||!b.status||200>b.status||299<b.status||b.responseText&&d(JSON.parse(b.responseText))};b.open("GET",a);b.send(null);return b}function P(){if(W&&!(x<Q)){var a=O(G-A,H-X),d=O(G+C+A,H+y+X);R&&R.abort();R=va(ua(W,{w:a[w],n:a[t],e:d[w],s:d[t],z:x}),wa)}}function ga(a,d,b){var b=b||[],c=a[0]?a:a.features,f,k,i;if(c){a=0;for(f=c.length;a<f;a++)ga(c[a],d,b);return b}"Feature"===a.type&&
(f=a.geometry,i=a.properties);if("Polygon"==f.type&&i.height){k=f.coordinates[0];c=[];a=0;for(f=k.length;a<f;a++)d?(c.push(k[a][1]),c.push(k[a][0])):(c.push(k[a][0]),c.push(k[a][1]));d=[];d[D]=i.height;a=B;f=c.length;k=-90;for(var m=-180,h=180,p,e,j,l=0;l<f-1;l+=2)if(c[l+1]<h?(h=c[l+1],p=l):c[l+1]>m&&(m=c[l+1],e=l),c[l]>k)k=c[l],j=l;p-=j;e-=j;0>p&&(p+=f);0>e&&(e+=f);if("CW"!==(p>e?"CW":"CCW")){e=[];for(j=c.length-2;0<=j;j-=2)e.push(c[j]),e.push(c[j+1]);c=e}d[a]=c;d[I]=i.color;b.push(d)}return b}function ha(a,
d,b){for(var c,f,k=[],i,m,h,p,e=Y-d,j=0,l=a.length;j<l;j++){i=a[j][D];m=a[j][B];h=a[j][I];p=new Int32Array(m.length);for(var g=0,n=m.length-1;g<n;g+=2){c=m[g+1];f=ia<<d;var o=S(1,ja(0,0.5-xa(ya(za+fa*m[g]/180))/v/2));c=~~((c/360+0.5)*f);f=~~(o*f);p[g]=c;p[g+1]=f}k[j]=[];k[j][D]=S(i>>e,ka);k[j][B]=p;k[j][I]=h;k[j][T]=b}return k}function M(a,d){var b=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);return"rgba("+[b[1],b[2],b[3],b[4]?d*b[5]:d].join()+")"}function Z(a,d,b){0>b&&(b+=1);1<b&&(b-=1);return b<
1/6?a+6*(d-a)*b:0.5>b?d:b<2/3?a+6*(d-a)*(2/3-b):a}function $(a,d){var b,c,f,k=a.match(/rgba?\((\d+),(\d+),(\d+)(,([\d.]+))?\)/);b=k[1];c=k[2];var i=k[3];b/=255;c/=255;var i=i/255,m=Math.max(b,c,i),h=Math.min(b,c,i),g;f=(m+h)/2;var e;if(m==h)g=h=0;else{e=m-h;h=0.5<f?e/(2-m-h):e/(m+h);switch(m){case b:g=(c-i)/e+(c<i?6:0);break;case c:g=(i-b)/e+2;break;case i:g=(b-c)/e+4}g/=6}b=g;c=h;f=S(1,ja(0,f+d));0==c?f=c=b=f:(i=0.5>f?f*(1+c):f+c-f*c,m=2*f-i,f=Z(m,i,b+1/3),c=Z(m,i,b),b=Z(m,i,b-1/3));a={r:~~(255*
f),g:~~(255*c),b:~~(255*b)};return"rgba("+[a.r,a.g,a.b,k[4]?k[5]:1].join()+")"}function la(a,d){C=a;y=d;A=~~(C/2);X=~~(y/2);E=A;F=y;n.width=C;n.height=y}function ma(a,d){G=a;H=d}function na(a){x=a;V=ia<<x;J=1-0.3*(x-Q)/(Y-Q)}function Aa(){aa=!0;r()}function wa(a){var d,b,c,f=[],g=0,i=0;R=null;if(a&&a.meta.z===x){c=a.meta;b=a.data;if(o&&h&&o.z===c.z){g=o.x-c.x;i=o.y-c.y;a=0;for(d=h.length;a<d;a++)f[a]=h[a][B][0]+g+","+(h[a][B][1]+i)}o=c;h=[];a=0;for(d=b.length;a<d;a++)h[a]=b[a],h[a][D]=S(h[a][D],ka),
c=h[a][B][0]+","+h[a][B][1],h[a][T]=!(f&&~f.indexOf(c));oa()}}function oa(){K=0;clearInterval(ba);ba=setInterval(function(){K+=0.1;if(1<K){clearInterval(ba);K=1;for(var a=0,d=h.length;a<d;a++)h[a][T]=0}r()},33)}function r(){var a,d,b,c;g.clearRect(0,0,C,y);if(o&&h&&!(x<Q||aa)){var f=M(U,J),k=M(pa,J),i=M(Ba,J),m,n;g.strokeStyle=i;var p,e,j,l,r=G-o.x,A=H-o.y,z,u,q,s,t,v,w,i=0;for(p=h.length;i<p;i++){a=h[i];a[I]&&(m=M(a[I],J),n=M($(a[I],0.2),J));l=!1;d=a[B];z=new Int32Array(d.length);e=0;for(j=d.length-
1;e<j;e+=2)z[e]=b=d[e]-r,z[e+1]=c=d[e+1]-A,l||(l=0<b&&b<C&&0<c&&c<y);if(l){g.fillStyle=m||f;e=a[T]?a[D]*K:a[D];l=ca/(ca-e);u=new Int32Array(z.length-2);q=[];e=0;for(j=z.length-3;e<j;e+=2)s=z[e],t=z[e+1],v=z[e+2],w=z[e+3],b=~~((s-E)*l+E),c=~~((t-F)*l+F),a=~~((v-E)*l+E),d=~~((w-F)*l+F),(v-s)*(c-t)>(b-s)*(w-t)?(q.length||(q.unshift(t),q.unshift(s),q.push(b),q.push(c)),q.unshift(w),q.unshift(v),q.push(a),q.push(d)):(da(q),q=[]),u[e]=b,u[e+1]=c;da(q);g.fillStyle=n||k;da(u,ea)}}}}function da(a,d){if(a.length){g.beginPath();
g.moveTo(a[0],a[1]);for(var b=2,c=a.length;b<c;b+=2)g.lineTo(a[b],a[b+1]);g.closePath();d&&g.stroke();g.fill()}}s.Int32Array=s.Int32Array||Array;var ta=Math.exp,xa=Math.log,ya=Math.tan,sa=Math.atan,S=Math.min,ja=Math.max,v=Math.PI,fa=v/2,za=v/4,ra=180/v,t="latitude",w="longitude",D=0,B=1,I=2,T=3,C=0,y=0,A=0,X=0,G=0,H=0,x,V,R,n,g,W,ea,U="rgb(200,190,180)",pa=$(U,0.2),Ba="rgb(145,140,135)",N,o,h,J=1,K=1,ba,ia=256,Q=14,Y,E,F,ca=400,ka=ca-50,aa=!1,u=s.OSMBuildings=function(a){this.addTo(a)};u.prototype.VERSION=
"0.1a";u.prototype.render=function(){if(this.map)return r(),this};u.prototype.setStyle=function(a){if(this.map)return a=a||{},ea=void 0!==a.strokeRoofs?a.strokeRoofs:ea,a.fillColor&&(U=a.fillColor,pa=$(U,0.2)),r(),this};u.prototype.setData=function(a,d){if(this.map)return a?(N=ga(a,d),o={n:90,w:-180,s:-90,e:180,x:0,y:0,z:x},h=ha(N,x,!0),oa()):(N=null,r()),this};u.prototype.loadData=function(a){if(this.map)return W=a,P(),this};(function(a){a.VERSION+="-leaflet";a.addTo=function(a){a.addLayer(this);
return this};a.onAdd=function(a){this.map=a;qa(a._panes.overlayPane);Y=a._layersMaxZoom;la(a._size.x,a._size.y);var b=a.getPixelOrigin();ma(b.x,b.y);na(a._zoom);var c;s.addEventListener("resize",function(){c=setTimeout(function(){clearTimeout(c);la(a._size.x,a._size.y);r();P()},100)},!1);var f=0,g=0;a.on({move:function(){var b=L.DomUtil.getPosition(a._mapPane);E=A-(b.x-f);F=y-(b.y-g);r()},moveend:function(){var b=L.DomUtil.getPosition(a._mapPane);f=b.x;g=b.y;n.style.left=-b.x+"px";n.style.top=-b.y+
"px";E=A;F=y;var c=a.getPixelOrigin();ma(c.x-b.x,c.y-b.y);b=O(G,H);c=O(G+C,H+y);o&&(b[t]>o.n||b[w]<o.w||c[t]<o.s||c[w]>o.e)&&P();r()},zoomstart:Aa,zoomend:function(){var b=a._zoom;aa=!1;na(b);N?(h=ha(N,x),r()):P()}});a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');r()};a.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.off({});n.parentNode.removeChild(n);
this.map=null}})(u.prototype)})(this);
