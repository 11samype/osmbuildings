<script>
var layerBuildings = new OSMBuildings(layerMap).loadData('server/?w={w}&n={n}&e={e}&s={s}&z={z}');
L.control.layers({}, { Buildings: layerBuildings }).addTo(layerMap);
</script>



<h2>GeoJSON</h2>

<div id="jsonMap" class="sampleMap"></div>

<link rel="stylesheet" href="<?php echo ROOT?>/js/leaflet.draw/leaflet.draw.css">
<script src="<?php echo ROOT?>/js/leaflet.draw/leaflet.draw.js"></script>

<script>
var jsonMap = createMap('jsonMap', 52.49480, 13.42857, 17);
var B = new OSMBuildings(jsonMap);
var geoJSON = {
    "type": "FeatureCollection",
    "features": []
};

function setColor(el) {
    drawControl.handlers.polygon.options.shapeOptions.color = el.style.backgroundColor;
}

function addPolygon(polygon) {
    var color = drawControl.handlers.polygon.options.shapeOptions.color;
    var height = parseInt(document.getElementById('heightValue').value) || 50;
    var coordinates = [];
    for (var i = 0, il = polygon.length; i < il; i++) {
        coordinates.push([polygon[i].lat, polygon[i].lng, height]);
    }
    coordinates.push([polygon[0].lat, polygon[0].lng, height]);

    var feature = {
        "type": "Feature",
        "geometry": {
            "type": "Polygon",
            "coordinates": [coordinates]
        },
        "properties": { "color": color }
    };

    geoJSON.features.push(feature);
    B.setData(geoJSON);

    jsonCode.innerHTML = 'new OSMBuildings(map)\n\t.setData(' + formatJSON(JSON.stringify(geoJSON)) + ');';
}

function formatJSON(json) {
    var result    = '';
    var pos       = 0;
    var indentStr = '    ';
    var newLine   = '\n';
    var prevChar  = '';
    var outOfQuotes = true;
    for (var i = 0; i <= json.length; ++i) {
        var c = json.substr(i, 1);
        if (c == '"' && prevChar != '\\') outOfQuotes = !outOfQuotes;
        else if ((c == '}' || c == ']') && outOfQuotes) {
            result += newLine;
            --pos;
            for (var j = 0; j < pos; ++j)
                result += indentStr;
        }
        result += c;
        if ((c == ',' || c == '{' || c == '[') && outOfQuotes) {
            result += newLine;
            if (c == '{' || c == '[')        ++pos;
            for (var j = 0; j < pos; ++j)        result += indentStr;
        }
        prevChar = c;
    }
    return result;
}

var drawControl = new L.Control.Draw({
    polygon: { allowIntersection: false },
    polyline: false,
    circle: false,
    rectangle: false,
    marker: false
});

jsonMap.addControl(drawControl);

jsonMap.on('draw:poly-created', function (e) {
    addPolygon(e.poly._latlngs);
});
</script>

<p>Turn Polygons into GeoJSON and make them 3D-ish. Select a color below and enter your desired building height.
Then click the polygon tool (top left) in the map area and create some shape. See yourself..</p>

<p>color: <button class="sampleColor" name="fillColor" style="background:#FADC64" onclick="setColor(this)"></button>
<button class="sampleColor" name="fillColor" style="background:#6464FA" onclick="setColor(this)"></button>
<button class="sampleColor" name="fillColor" style="background:#FA6464" onclick="setColor(this)"></button>
height: <input id="heightValue" type="text" value="50" maxlength="3" size="3"></p>

<p><code id="jsonCode"></code></p>

<script>
var jsonCode = document.getElementById('jsonCode');
jsonCode.innerHTML = 'new OSMBuildings(map)\n\t.setData(' + JSON.stringify(geoJSON) + ');';
</script>
