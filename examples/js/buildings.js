var OSMBuildings=function(ia){var U=Math.PI,za=U/2,Ea=U/4,Fa=180/U,Ga=256,ja=14,ka=400,Aa=ka-50,V="latitude",W="longitude",I=0,H=1,y=2,ea=3,Ba=Ba||Array,Ha=Math.exp,Ia=Math.log,Ja=Math.tan,Ka=Math.atan,la=Math.min,La=Math.max,ma=ia.document,v=function(){function X(g,h,k){if(k<0)k+=1;if(k>1)k-=1;if(k<1/6)return g+(h-g)*6*k;if(k<0.5)return h;if(k<2/3)return g+(h-g)*(2/3-k)*6;return g}function D(g,h,k,l){this.r=g;this.g=h;this.b=k;this.a=arguments.length<4?1:l}var Y=D.prototype;Y.toString=function(){return"rgba("+
[this.r,this.g,this.b,this.a.toFixed(2)].join(",")+")"};Y.adjustLightness=function(g){var h=v.toHSLA(this);h.l*=g;h.l=Math.min(1,Math.max(0,h.l));var k,l;if(h.s===0)g=k=l=h.l;else{l=h.l<0.5?h.l*(1+h.s):h.l+h.s-h.l*h.s;var u=2*h.l-l;g=X(u,l,h.h+1/3);k=X(u,l,h.h);l=X(u,l,h.h-1/3)}return new v(~~(g*255),~~(k*255),~~(l*255),h.a)};Y.adjustAlpha=function(g){return new v(this.r,this.g,this.b,this.a*g)};D.parse=function(g){if(~g.indexOf("#")){g=g.match(/^#?(\w{2})(\w{2})(\w{2})(\w{2})?$/);return new v(parseInt(g[1],
16),parseInt(g[2],16),parseInt(g[3],16),g[4]?parseInt(g[4],16)/255:1)}if(g=g.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))return new v(parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10),g[4]?parseFloat(g[5],10):1)};D.toHSLA=function(g){var h=g.r/255,k=g.g/255,l=g.b/255,u=Math.max(h,k,l),w=Math.min(h,k,l),z,Z=(u+w)/2,A;if(u===w)z=w=0;else{A=u-w;w=Z>0.5?A/(2-u-w):A/(u+w);switch(u){case h:z=(k-l)/A+(k<l?6:0);break;case k:z=(l-h)/A+2;break;case l:z=(h-k)/A+4;break}z/=6}return{h:z,s:w,l:Z,
a:g.a}};return D}();return function(){function X(a){p=ma.createElement("canvas");p.style.webkitTransform="translate3d(0,0,0)";p.style.position="absolute";p.style.pointerEvents="none";p.style.left=0;p.style.top=0;p.style.imageRendering="optimizeSpeed";a.appendChild(p);r=p.getContext("2d");r.lineCap="round";r.lineJoin="round";r.lineWidth=1;try{r.mozImageSmoothingEnabled=false}catch(e){}}function D(a,e){var b={};a/=$;e/=$;b[V]=e<=0?90:e>=1?-90:Fa*(2*Ka(Ha(U*(1-2*e)))-za);b[W]=(a===1?1:(a%1+1)%1)*360-
180;return b}function Y(a,e){return a.replace(/\{ *([\w_]+) *\}/g,function(b,d){return e[d]||""})}function g(a,e){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState===4)!b.status||b.status<200||b.status>299||b.responseText&&e(JSON.parse(b.responseText))};b.open("GET",a);b.send(null);return b}function h(){if(!(!na||x<ja)){var a=D(P-Q,R-oa),e=D(P+J+Q,R+B+oa);fa&&fa.abort();fa=g(Y(na,{w:a[W],n:a[V],e:e[W],s:e[V],z:x}),k)}}function k(a){var e,b,d,c=[],f=0,i=0;aa=ja;ga(x);fa=null;
if(!(!a||a.meta.z!==x)){d=a.meta;b=a.data;if(t&&m&&t.z===d.z){f=t.x-d.x;i=t.y-d.y;a=0;for(e=m.length;a<e;a++)c[a]=m[a][H][0]+f+","+(m[a][H][1]+i)}t=d;m=[];a=0;for(e=b.length;a<e;a++){m[a]=b[a];m[a][I]=la(m[a][I],Aa);d=m[a][H][0]+","+m[a][H][1];m[a][ea]=!(c&&~c.indexOf(d))}Ca()}}function l(a,e){var b=[],d,c,f,i,j,q,o,n,s=pa-x;d=0;for(c=a.length;d<c;d++){j=a[d];q=j[H];o=new Ba(q.length);f=0;for(i=q.length-1;f<i;f+=2){n=q[f+1];var E=la(1,La(0,0.5-Ia(Ja(Ea+za*q[f]/180))/U/2));n={x:~~((n/360+0.5)*$),y:~~(E*
$)};o[f]=n.x;o[f+1]=n.y}b[d]=[];b[d][I]=la(j[I]>>s,Aa);b[d][H]=o;b[d][y]=j[y];b[d][ea]=e}return b}function u(a,e){if(typeof a==="object")z(a,!e);else{var b=ma.documentElement,d=ma.createElement("script");ia.jsonpCallback=function(c){delete ia.jsonpCallback;b.removeChild(d);z(c,!e)};b.insertBefore(d,b.lastChild).src=a.replace(/\{callback\}/,"jsonpCallback")}}function w(a,e,b){if(b===undefined)b=[];var d,c,f,i=a[0]?a:a.features,j,q,o,n,s,E=e?1:0,S=e?0:1;if(i){d=0;for(a=i.length;d<a;d++)w(i[d],e,b);
return b}if(a.type==="Feature"){c=a.geometry;d=a.properties}if(c.type==="Polygon")j=[c.coordinates];if(c.type==="MultiPolygon")j=c.coordinates;if(j){e=d.height;if(d.color||d.wallColor)n=v.parse(d.color||d.wallColor);if(d.roofColor)s=v.parse(d.roofColor);d=0;for(a=j.length;d<a;d++){q=j[d][0];i=[];c=o=0;for(f=q.length;c<f;c++){i.push(q[c][E],q[c][S]);o+=e||q[c][2]||0}if(o){c=[];c[I]=~~(o/q.length);q=H;o=void 0;f=void 0;var K=void 0,C=void 0,T=0,F=void 0,ba=void 0;F=0;for(ba=i.length-3;F<ba;F+=2){o=
i[F];f=i[F+1];K=i[F+2];C=i[F+3];T+=o*C-K*f}if((T/2>0?"CW":"CCW")==="CW")i=i;else{o=[];for(f=i.length-2;f>=0;f-=2)o.push(i[f],i[f+1]);i=o}c[q]=i;if(n||s)c[y]=[n,s];b.push(c)}}}return b}function z(a,e){if(a){ca=w(a,e);aa=0;ga(x);t={n:90,w:-180,s:-90,e:180,x:0,y:0,z:x};m=l(ca,true);Ca()}else{ca=null;G()}}function Z(a,e){J=a;B=e;Q=~~(J/2);oa=~~(B/2);M=Q;N=B;p.width=J;p.height=B}function A(a,e){P=a;R=e}function ga(a){x=a;$=Ga<<x;O=1-(x-aa)*0.3/(pa-aa)}function Da(){qa=true;G()}function Ca(){da=0;clearInterval(ra);
ra=setInterval(function(){da+=0.1;if(da>1){clearInterval(ra);da=1;for(var a=0,e=m.length;a<e;a++)m[a][ea]=0}G()},33)}function G(){r.clearRect(0,0,J,B);if(t&&m)if(!(x<aa||qa)){var a,e,b,d,c,f,i,j,q=P-t.x,o=R-t.y,n,s,E,S,K,C,T,F=sa.adjustAlpha(O)+"",ba=(ta||sa.adjustLightness(1.2)).adjustAlpha(O)+"";if(ha)r.strokeStyle=Ma.adjustAlpha(O)+"";a=0;for(e=m.length;a<e;a++){c=m[a];s=false;f=c[H];n=[];b=0;for(d=f.length-1;b<d;b+=2){n[b]=i=f[b]-q;n[b+1]=j=f[b+1]-o;s||(s=i>0&&i<J&&j>0&&j<B)}if(s){r.fillStyle=
c[y]&&c[y][0]?c[y][0].adjustAlpha(O)+"":F;b=c[ea]?c[I]*da:c[I];f=ka/(ka-b);i=[];j=[];b=0;for(d=n.length-3;b<d;b+=2){s=n[b];E=n[b+1];S=n[b+2];K=n[b+3];C={x:~~((s-M)*f+M),y:~~((E-N)*f+N)};T={x:~~((S-M)*f+M),y:~~((K-N)*f+N)};if((S-s)*(C.y-E)>(C.x-s)*(K-E)){if(!j.length){j.unshift(E);j.unshift(s);j.push(C.x,C.y)}j.unshift(K);j.unshift(S);j.push(T.x,T.y)}else{ua(j);j=[]}i[b]=C.x;i[b+1]=C.y}ua(j);r.fillStyle=!c[y]?ba:c[y][1]?c[y][1].adjustAlpha(O)+"":ta?ba:c[y][0].adjustLightness(1.2).adjustAlpha(O)+"";
ua(i,ha)}}}}function ua(a,e){if(a.length){r.beginPath();r.moveTo(a[0],a[1]);for(var b=2,d=a.length;b<d;b+=2)r.lineTo(a[b],a[b+1]);r.closePath();e&&r.stroke();r.fill()}}var J=0,B=0,Q=0,oa=0,P=0,R=0,x,$,fa,p,r,na,ha,sa=new v(200,190,180),ta=null,Ma=new v(145,140,135),ca,t,m,O=1,da=1,ra,aa=ja,pa=20,M,N,qa=false;this.VERSION="0.1.6a";this.render=function(){G();return this};this.setStyle=function(a){a=(a=a)||{};ha=a.strokeRoofs!==undefined?a.strokeRoofs:ha;if(a.color||a.wallColor)sa=v.parse(a.color||a.wallColor);
if(a.roofColor)ta=v.parse(a.roofColor);G();return this};this.setData=function(a,e){console.warn("OSMBuildings.loadData() is deprecated and will be removed soon.\nUse OSMBuildings.loadData({url|object}, isLatLon?) instead.");z(a,e);return this};this.loadData=function(a){na=a;h();return this};this.geoJSON=function(a,e){u(a,e);return this};var va,wa,xa,ya;this.VERSION+="-leaflet";this.addTo=function(a){a.addLayer(this);return this};this.onAdd=function(a){this.map=a;X(a._panes.overlayPane);pa=a._layersMaxZoom;
Z(a._size.x,a._size.y);var e=a.getPixelOrigin();A(e.x,e.y);ga(a._zoom);var b=0,d=0;va=function(){var c=L.DomUtil.getPosition(a._mapPane);M=Q-(c.x-b);N=B-(c.y-d);G()};wa=function(){if(ya)ya=false;else{var c=L.DomUtil.getPosition(a._mapPane),f=a.getPixelOrigin();b=c.x;d=c.y;p.style.left=-c.x+"px";p.style.top=-c.y+"px";M=Q;N=B;Z(a._size.x,a._size.y);A(f.x-c.x,f.y-c.y);c=D(P,R);f=D(P+J,R+B);if(t&&(c[V]>t.n||c[W]<t.w||f[V]<t.s||f[W]>t.e))h();G()}};xa=function(){var c=L.DomUtil.getPosition(a._mapPane),
f=a.getPixelOrigin();A(f.x-c.x,f.y-c.y);c={zoom:a._zoom};qa=false;ga(c.zoom);if(ca){m=l(ca);G()}else h();ya=true};a.on({move:va,moveend:wa,zoomstart:Da,zoomend:xa});if(a.options.zoomAnimation)p.className="leaflet-zoom-animated";a.attributionControl.addAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');G()};this.onRemove=function(a){a.attributionControl.removeAttribution('Buildings &copy; <a href="http://osmbuildings.org">OSM Buildings</a>');a.off({move:va,moveend:wa,
zoomstart:Da,zoomend:xa});p.parentNode.removeChild(p);this.map=null};arguments.length&&this.addTo(arguments[0])}}(this);
